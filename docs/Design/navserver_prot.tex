%
%
\newcommand{\documentName}{Navigator Protocol v10, v11 and v12}
\documentclass[a4paper]{article}
%
\usepackage{epsfig}
% \usepackage{t1enc}
% \usepackage[swedish]{babel}
\usepackage[T1]{fontenc}              % Swedish letters available
\usepackage[english]{babel}           % English hyphenation, headlines etc.
\usepackage{graphics}                 % Graphics may be included
\usepackage{fancyheadings}            % May use fancy headers and footers
\usepackage{calc}                     % May calculate arithmetic expressions
\usepackage{hangcaption}              % Captions have a hanging format
\usepackage{times}                    % Use a postscript font
% Possible to add an index
\usepackage{makeidx}
% Better pdf
\usepackage[ps2pdf,bookmarks=true,bookmarksnumbered=true,bookmarksopen=true,colorlinks=true,linkcolor=blue]{hyperref}
\hypersetup{
       pdfauthor = {Wayfinder Systems},
       pdftitle = {\documentName},
       pdfsubject = {\documentName},
       pdfkeywords = {Route, Navigation, Server, Client, Wayfinder, Systems },
       pdfcreator = {LaTeX with hyperref package},
       pdfproducer = {dvips + ghostscript}}

\title{Protocol for communication between Navigator Client and Navigator 
 Server v10, v11 and v12}
\author{Wayfinder Systems}

% for colors in tables
\usepackage{colortbl}

% \frenchspacing
\makeindex

\begin{document}
\maketitle
\tableofcontents
\newpage



\section{Introduction}

This document describes the protocol used to communicate
between the Navigator Client and the Navigator Server.

The protocol is request-reply based.

All complex values (16 bit, 32 bit) are considered sent with
the most significant byte first. All data is sent in network order that is.

All coordinates are in WGS-84 Radians * $10^8$.

All strings are zero-byte-terminated and are sent in iso-8859-1 if
protover is 0xa and utf-8 if protover > 0xa.

All headings are in 256 clockwise degrees, with north at 0-degrees.
Any heading value larger than {\tt MAX\_UINT8} == 255 is considered invalid.



\section{Packet format}

The current protocol version, specified in this document, is {\tt 0xa}, 
{\tt 0xb} and {\tt 0xc}. 
The difference between {\tt 0xa} and {\tt 0xb} is that {\tt 0xb} and above
uses utf-8 strings {\tt 0xa} uses iso-8859-1 strings.
The difference between {\tt 0xb} and {\tt 0xc} is that {\tt 0xc} and above
has an flag field first in parameter block {\tt 0xb} and lower doesn't.



\subsection{Requests}
\label{request}

This is how a request sent to the server looks like.

~

\begin{centering}
\begin{tabular}{|l|c|c|l|} \hline
Function        & Offset       & Size    & Description \hfill    \\
                &              & (Bytes) &                       \\\hline
STX             & 0            & 1       & Always 0x02           \\\hline
length          & 1            & 4       & Total package length  \\\hline
protover        & 5            & 1       & Protocol version      \\\hline
type            & 6            & 2       & Message request type  \\\hline
req\_id         & 8            & 1       & Request ID            \\\hline
req\_ver        & 9            & 1       & Request type version  \\\hline
parameter block & 10           & X       & The payload with all
                                           the parameters        \\\hline
crc             & 10 + X == -4 & 4       & CRC of packet         \\\hline
\end{tabular}
\end{centering}
~

Only the first 6 bytes, STX, length and protover, are guaranteed to be the
same in future and past versions.
\begin{description}
   \item[STX] Leading byte which starts all packets.
   \item[length] The length of the packet including the header.
   \item[protover] Protocol version of the packet. This enables
     each side (client and server) to recognize a mismatched connection.
     There is no guarantee that the communication will be backward
     compatible.
   \item[type] Type of Request. This describes the layout of the
     payload data. See below for valid types.
   \item[req\_id] Request ID. Used to associate the requests with
     the reply from the server.
   \item[req\_ver] Request type version. This is the version for the
     specific type of request. 
   \item[parameter block] With the global and request specific parameters.
   \item[crc] Checksum.
     32-bit CRC using the polynomial:
     $x^{32}+x^{26}+x^{23}+x^{22}+x^{16}+x^{12}+x^{11}+x^{10}+x^8+x^7+x^5+
     x^4+x^2+x+1$.
     Using the Posix 1003 specification.
     Calculated over the whole Packet up to but not including the crc bytes.
\end{description}

CRC last. Why? So crc can be calculated as the bytes are sent
and one doesn't need the whole packet in one buffer to calculate it.



\subsection{Replies}

This is how a reply sent from the server looks like.

\begin{centering}
\begin{tabular}{|l|c|c|l|}\hline
Function        & Offset & Size        & Description           \\
                &        & (Bytes)     &                       \\\hline
STX             &  0     & 1           & Always 0x02           \\\hline
length          &  1     & 4           & Packet length         \\\hline
protover        &  5     & 1           & Protocol version      \\\hline
type            &  6     & 2           & Packet message type   \\\hline
req\_id         &  8     & 1           & Request ID            \\\hline
req\_ver        &  9     & 1           & Request type version. \\\hline
status\_code    & 10     & 1           & Typically 0x00        \\\hline
status\_message & 11     & strlen + 1  & Typically ""          \\\hline
parameter block & 11 + strlen + 1 
                         & X           & The payload of 
                                         parameters            \\\hline
crc             & -4     & 4           &                       \\\hline
\end{tabular}
\end{centering}
~\\

All the fields are the same as in~\ref{request}, except for status\_code and
status\_message.


\begin{description}
   \item[status\_code] The status of reply message.  Status codes with
     the highest bit set, codes 0x80 to 0xff, are request specific.
     \begin{description}
     \item[{\tt NAV\_STATUS\_REQUEST\_SPECIFIC\_MASK}] is not a status
       code but a mask to see if a status code is request specific or
       not.  
     \item[{\tt NAV\_STATUS\_EXTENDED\_ERROR}] says that there is an
       Extended error parameter, id 24, in the reply with a larger
       error code.
     \end{description}

\begin{verbatim}
enum ReplyStatus {
   NAV_STATUS_OK                           = 0x00,
   NAV_STATUS_NOT_OK                       = 0x01,
   NAV_STATUS_REQUEST_TIMEOUT              = 0x02,
   NAV_STATUS_PARAM_REQ_NOT_FIRST          = 0x03,
   NAV_STATUS_OUTSIDE_MAP                  = 0x04,
   NAV_STATUS_PROTOVER_NOT_SUPPORTED       = 0x05,
   NAV_STATUS_OUTSIDE_ALLOWED_AREA         = 0x06,
   NAV_STATUS_NO_TRANSACTIONS_LEFT         = 0x07,
   NAV_STATUS_GENERIC_PERMANENT_ERROR      = 0x08,
   NAV_STATUS_GENERIC_TEMPORARY_ERROR      = 0x09,
   NAV_STATUS_SERVER_UPGRADE_IN_PROGRESS   = 0x0a,
   NAV_STATUS_SERVER_OVERLOADED            = 0x0b,
   NAV_STATUS_EXPIRED_USER                 = 0x0c,
   NAV_STATUS_UNAUTHORIZED_USER            = 0x0d,
   NAV_STATUS_REDIRECT                     = 0x0e,
   NAV_STATUS_UPDATE_NEEDED                = 0x0f,
   NAV_STATUS_WF_TYPE_TOO_HIGH_LOW         = 0x10,
   NAV_STATUS_REQ_VER_NOT_SUPPORTED        = 0x11,
   NAV_STATUS_CRC_ERROR                    = 0x12,
   NAV_STATUS_PARAMBLOCK_INVALID           = 0x13,
   NAV_STATUS_UNKNOWN_REQUEST              = 0x14,
   NAV_STATUS_PARAMETER_INVALID            = 0x15,
   NAV_STATUS_MISSING_PARAMETER            = 0x16,
   NAV_STATUS_UNAUTH_OTHER_HAS_LICENCE     = 0x17,
   NAV_STATUS_EXTENDED_ERROR               = 0x18,
      
   NAV_STATUS_REQUEST_SPECIFIC_MASK        = 0x80
};
\end{verbatim}

   \item[status\_message] The status of reply message as string.
\end{description}

The status\_message is a string describing the status in the
language set in the parameters of the request.


\section{Parameter block}

A parameter block is a list of parameters.
Starting from protoVer {\tt 0xc} and up there is an uint32 first in the 
parameter block with flags. The hightest bit indicates if there is another 
uint32 flags field. All flag fields with highest bit set is followed by another flag field. The lowest bit in the flag field is gziped or not. The second lowest bit is if gzip is supported.

\subsection{Parameter representation}

A parameter is described by a tag and an optional value. The 
tag is a 32-bit entity which describes the type of the parameter
and the length of the optional value.

The first 16 bits of the tag are parameter length in bytes.
The last 16 bits of the tag are the ParamID. 


\subsection{Unknown or unspecified parameters}

Unknown parameter types with a valid length are to be ignored.
Since the length is present in the tag the parameter can easily 
be skipped. It is assumed that it is possible to continue in 
degraded mode even though the parameter is not understood.


\subsection{Parameter value types}

There are the following types of parameter values:

\begin{description}
\item[bool] The length may be 0 or 1. If 0 length then value is true. 
  If length is 1 then the value is false if the byte is 0, true if not.
\item[byte] Length of 1, values 0-255 are possible.
\item[uint16] Length of 2, values 0-65535 are possible.
\item[uint32] Length of 4, values 0-4294967295 are possible.
\item[int32] Length of 4, values -2147483648 to 2147483647 are possible.
\item[string] Array of bytes ended by an null-byte, integer value of 0.
  Strings are utf-8 encoded if protover > 0xa else iso-8859-1.
\item[byte array] An array of length bytes.
\item[uint16 array] An array of length$/2$ uint16s.
\item[uint32 array] An array of length$/4$ uint32s.
\item[int32 array]  An array of length$/4$ int32s.
\end{description}


% The Global parameters and Global types sections
\input{serverparams}


\section{Request specific parameters}


The content of the parameter block should contain parameters from a specific
request type. 

Some requests even has their own parameter types that are 
encapsulated in a byte-array-parameter. This is done to save space as 
typed parameter's tag can take up too much space.


\begin{verbatim}
typedef enum RequestType {
  NAV_INVALID               = 0x00,

  // 0x01 - 0x04 Reserved (Used in older protovers)

  NAV_ROUTE_REQ             = 0x05,        
  NAV_ROUTE_REPLY           = 0x06,

  NAV_SEARCH_REQ            = 0x07,         
  NAV_SEARCH_REPLY          = 0x08,

  // 0x09 - 0x0a Reserved (Used in older protovers)

  NAV_REV_GEOCODING_REQ       = 0x0b,
  NAV_REV_GEOCODING_REPLY     = 0x0c,

  // 0x0d - 0x0e Reserved (Used in older protovers)
  // 0x10 - 0x11 Reserved (Used in older protovers)

  NAV_MAP_REQ               = 0x12,
  NAV_MAP_REPLY             = 0x13,

  NAV_FAV_REQ               = 0x14,
  NAV_FAV_REPLY             = 0x15,

  NAV_INFO_REQ              = 0x16,
  NAV_INFO_REPLY            = 0x17,

  NAV_MESSAGE_REQ           = 0x18,
  NAV_MESSAGE_REPLY         = 0x19,

  NAV_UPGRADE_REQ           = 0x1a,
  NAV_UPGRADE_REPLY         = 0x1b,

  NAV_VECTOR_MAP_REQ        = 0x1c,
  NAV_VECTOR_MAP_REPLY      = 0x1d,

  NAV_MULTI_VECTOR_MAP_REQ  = 0x1e,
  NAV_MULTI_VECTOR_MAP_REPLY= 0x1f,

  // 0x20,0x21,0x30-0x33,0x40,0x41 Reserved 
  //                      (Used in older protovers)
  NAV_CELL_REPORT           = 0x22,
  NAV_CELL_CONFIRM          = 0x23,

  NAV_TOP_REGION_REQ        = 0x25,
  NAV_TOP_REGION_REPLY      = 0x26,
  NAV_LATEST_NEWS_REQ       = 0x27,
  NAV_LATEST_NEWS_REPLY     = 0x28,
  NAV_CATEGORIES_REQ        = 0x29,
  NAV_CATEGORIES_REPLY      = 0x2a,
  NAV_CALLCENTER_LIST_REQ   = 0x2b,
  NAV_CALLCENTER_LIST_REPLY = 0x2c,
  NAV_SERVER_LIST_REQ       = 0x2d,
  NAV_SERVER_LIST_REPLY     = 0x2e,
  NAV_NEW_PASSWORD_REQ      = 0x2f,
  NAV_NEW_PASSWORD_REPLY    = 0x30,
  NAV_SERVER_INFO_REQ       = 0x31,
  NAV_SERVER_INFO_REPLY     = 0x32,
  NAV_WHOAMI_REQ            = 0x33,
  NAV_WHOAMI_REPLY          = 0x34,

  NAV_BINARY_TRANSFER_REQ   = 0x35,
  NAV_BINARY_TRANSFER_REPLY = 0x36,
  NAV_NOP_REQ               = 0x37,
  NAV_NOP_REPLY             = 0x38,
  NAV_CHANGED_LICENCE_REQ   = 0x39,
  NAV_CHANGED_LICENCE_REPLY = 0x3a,
  NAV_SERVER_AUTH_BOB_REQ   = 0x3b,
  NAV_SERVER_AUTH_BOB_REPLY = 0x3c,

  NAV_TRACK_REQ             = 0x3d,
  NAV_TRACK_REPLY           = 0x3e,

  NAV_TUNNEL_DATA_REQ       = 0x42,
  NAV_TUNNEL_DATA_REPLY     = 0x43,

  NAV_COMBINED_SEARCH_REQ   = 0x44,
  NAV_COMBINED_SEARCH_REPLY = 0x45,

  NAV_SEARCH_DESC_REQ       = 0x46,
  NAV_SEARCH_DESC_REPLY     = 0x47,

  NAV_CELLID_LOOKUP_REQ     = 0x48,
  NAV_CELLID_LOOKUP_REPLY   = 0x49,

  NAV_GET_KEYED_DATA_REQ    = 0x4a,
  NAV_GET_KEYED_DATA_REPLY  = 0x4b,

  NAV_ECHO_REQ              = 0x4c,
  NAV_ECHO_REPLY            = 0x4d,

  NAV_VERIFY_THIRD_PARTY_TRANSACTION_REQ = 0x4e,
  NAV_VERIFY_THIRD_PARTY_TRANSACTION_REPLY = 0x4f,

  NAV_LOCAL_CATEGORY_TREE_REQ   = 0x50,
  NAV_LOCAL_CATEGORY_TREE_REPLY = 0x51,

  NAV_ONE_SEARCH_REQ        = 0x52,
  NAV_ONE_SEARCH_REPLY      = 0x53,

  NAV_DETAIL_REQ            = 0x54,
  NAV_DETAIL_REPLY          = 0x55

} message_t;
\end{verbatim}



\subsection{NAV\_INVALID}
No such parameter types exist.



\subsection{NAV\_ROUTE\_REQ v.1}

A request for a route, sent from the client to the
server.

\subsubsection{Possible vehicles}
\label{enum:vehicle_t}
\begin{verbatim}
      enum vehicle_t {
         /// Passenger car.
         passengerCar           = 0x01,
         // Pedestrian.
         pedestrian             = 0x02,
         /// Emergency vehicle.
         emergencyVehicle       = 0x03,
         /// Taxi.
         taxi                   = 0x04,
         /// Public bus.
         publicBus              = 0x05,
         // Delivery truck.
         deliveryTruck          = 0x06,
         /// Transport truck.
         transportTruck         = 0x07,
         /// Car with more than 2 passengers.
         highOccupancyVehicle   = 0x08,
         /// Bicycle.
         bicycle                = 0x09,
         /// Public transportation.
         publicTransportation   = 0x0a,
         ///Invalid, server decides
         invalid                = 0xff,
      };
\end{verbatim}

\subsubsection{Data content variants}
\label{enum:contentType}
The different content supported differ in the amount of data
included.
\begin{verbatim}
   enum contentType { 
      ///Preferred by the GPS-less mode. Sends enough 
      ///information that an itinerary can be generated 
      ///by the client.
      slim = 1,
      ///Preferred by the GPS mode. Plenty of coordinates
      ///ensures good route following, distance and time 
      ///to goal calculation, and off track detection.
      full = 2,
   };
\end{verbatim} 

\subsubsection{Reroute reasons}
\begin{verbatim}
enum RerouteReason {
   /**
    * The route was truncated, 
    * the next piece is needed. 
    */
   truncated_route     = 1,
   /** The user went off track and needs a new route.*/
   off_track           = 2,
   /**
    * The route should be updated 
    * with new traffic info. 
    */
   traffic_info_update = 3,
   /** The user requested a reroute. */
   user_request        = 4,
};
\end{verbatim}

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1000} \textbf{Type} int32,int32, uint16 
  \textbf{Name} Origin coord and angle. \textbf{Default value}~-\\
  \index{Origin coord and angle, Parameter}
  \index{1000, ParamID}
  \label{Origin coord and angle}
  \textbf{Description} Array of two int32 and an uint16. Origin coordinate and
  angle. Angle is direction of vehicle at the moment. Is used to calculate
  which side of the road the vehicle is traveling.
\item \textbf{1001} \textbf{Type} int32,int32 \textbf{Name} Dest coord
                 \textbf{Default~value} - \\
  \index{Dest coord, Parameter}
  \index{1001, ParamID}
  \label{Dest coord}
  \textbf{Description} Array of two int32. Destination coordinate.
\item \textbf{1002} \textbf{Type} uint32 \textbf{Name} Time to trunc
                 \textbf{Default~value} MAX\_UINT32 \\
  \index{Time to trunc, Parameter}
  \index{1002, ParamID}
  \label{Time to trunc}
  \textbf{Description} Driving time in reply after which the server may
  truncate route. Is the time in seconds of driving time, before the
  route should be renewed. This can be used to make the most of the
  traffic information in the server. In reality, when the server has
  generated enough route for this amount of driving, it truncates the
  route in the same way that it does when the route is too large for a
  single download.
\item \textbf{1004} \textbf{Type} uint16 \textbf{Name} Current vel 
                 \textbf{Default~value} - \\
  \index{Current vel, Parameter}
  \index{1004, ParamID}
  \label{Current vel}
  \textbf{Description} Current speed in meters/second times 32.
\item \textbf{1005} \textbf{Type} uint32 \textbf{Name} Route flags
                 \textbf{Default~value} - \\
  \index{Route flags, Parameter}
  \index{1005, ParamID}
  \label{Route flags}
  \textbf{Description} Flags field with:\\
    \begin{tabular}{ll}
      LSB & CostA (Distance)               \\
      +1  & CostB (Time)                   \\
      +2  & CostC (Time with disturbances) \\
      +3  & CostD (Not yet defined)        \\
      +4  & Avoidhighway                   \\
      +5  & Avoidtollroads                 \\
      +6  & Abbreviate                     \\
      +7  & AddLandmarks                   \\
      +8 - 15 & content, The degree of data wanted for the route. 
                See \ref{enum:contentType}.    \\
      +16 - 23 & vehicle, The vehicle type to make route for. 
                 See \ref{enum:vehicle_t}.\\
      +24 - 31 & Reserved for future use. \\
    \end{tabular}
\item \textbf{1006} \textbf{Type} string \textbf{Name} Old route id
                 \textbf{Default~value} - \\
  \index{Old route id, Parameter}
  \index{1006, ParamID}
  \label{Old route id}
  \textbf{Description} The route that this is a reroute of.
\item \textbf{1007} \textbf{Type} string \textbf{Name} Search id route origin
                 \textbf{Default~value} - \\
  \index{Search id route origin, Parameter}
  \index{1007, ParamID}
  \label{Search id route origin}
  \textbf{Description} Search id as origin.
\item \textbf{1008} \textbf{Type} string 
                 \textbf{Name} Search id route destination
                 \textbf{Default~value} - \\
  \index{Search id route destination, Parameter}
  \index{1008, ParamID}
  \label{Search id route destination}
  \textbf{Description} Search id as destination.
%\item \textbf{1009} \textbf{Type} bool 
%                 \textbf{Name} Auto dest route destination
%                 \textbf{Default~value} - \\
%  \index{Auto dest route destination, Parameter}
%  \index{1009, ParamID}
%  \label{Auto dest route destination}
%  \textbf{Description} Use auto destination as destination.
\item \textbf{1010} \textbf{Type} uint32 \textbf{Name} Max route size
                 \textbf{Default~value} 14000 \\
  \index{Max route size, Parameter}
  \index{1010, ParamID}
  \label{Max route size}
  \textbf{Description} The maximum size of the reply route data parameter.
\item \textbf{1011} \textbf{Type} int32,int32 \textbf{Name} Origin fav coord
                 \textbf{Default~value} - \\
  \index{Origin fav coord, Parameter}
  \index{1011, ParamID}
  \label{Origin fav coord}
  \textbf{Description} Array of two int32. Favorite coordinate as origin
  coordinate.
\item \textbf{1012} \textbf{Type} int32,int32 \textbf{Name} Dest fav coord
                 \textbf{Default~value} - \\
  \index{Dest fav coord, Parameter}
  \index{1012, ParamID}
  \label{Dest fav coord}
  \textbf{Description} Array of two int32. Favorite coordinate as destination
  coordinate.

\item \textbf{1013} \textbf{Type} uint8 \textbf{Name} Reroute reason
                 \textbf{Default~value} 4 - user\_request \\
  \index{Reroute reason, Parameter}
  \index{RerouteReason, Parameter}
  \index{1013, ParamID}
  \label{Reroute reason}
  \textbf{Description} One uint8 containing a value from the
  RerouteReason enumeration.

\end{list}

\subsection{NAV\_ROUTE\_REQ v.2}

A request for a route with Lanes, Signposts and a Route Color Table.


\subsection{NAV\_ROUTE\_REPLY v.1}

A reply for a route request, sent from the server
to the client.

~

The Route reply has some specific status codes. Note that all these
codes have the highest bit set and {\tt
  NAV\_STATUS\_REQUEST\_SPECIFIC\_MASK} can be used as a bit mask to
detect them.
\begin{verbatim}
enum RouteReplyStatus {
   ROUTE_REPLY_NO_ROUTE_FOUND        = 0x81,
   ROUTE_REPLY_TOO_FAR_FOR_VEHICLE   = 0x82,
   ROUTE_REPLY_PROBLEM_WITH_ORIGIN   = 0x83,
   ROUTE_REPLY_PROBLEM_WITH_DEST     = 0x84,
   ROUTE_REPLY_NO_AUTO_DEST          = 0x85,
   ROUTE_REPLY_NO_ORIGIN             = 0x86,
   ROUTE_REPLY_NO_DESTINATION        = 0x87,
   ROUTE_REPLY_NO_ROUTE_CHANGE       = 0x88,
};
\end{verbatim}

\begin{description}
   \item[{\tt ROUTE\_REPLY\_NO\_ROUTE\_FOUND}] No route could be found to the 
      destination(s) from the origin(s).
   \item[{\tt ROUTE\_REPLY\_TOO\_FAR\_FOR\_VEHICLE}] Route is too far to go
      for the vehicle used. Mostly used for pedestrian routes that are too 
      long.
  \item[{\tt ROUTE\_REPLY\_PROBLEM\_WITH\_ORIGIN}] Can not make out origin.
  \item[{\tt ROUTE\_REPLY\_PROBLEM\_WITH\_DEST}] Can not make out destination.
  \item[{\tt ROUTE\_REPLY\_NO\_AUTO\_DEST}] No auto destination and auto 
      destination used as destination.
  \item[{\tt ROUTE\_REPLY\_NO\_ORIGIN}] No origin in request.
  \item[{\tt ROUTE\_REPLY\_NO\_DESTINATION}] No destination in request.    
  \item[{\tt ROUTE\_REPLY\_NO\_ROUTE\_CHANGE}] When an old route id and
    a reroute reason has been supplied in the request, the server may
    signal this status to tell the client to keep using the old route.
    When this status is set, the server only needs to send the Route
    id parameter (1100). The route id is not strictly needed, but it
    is a good sanity check.
\end{description}

The route reply parameter are:

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1100} \textbf{Type} string \textbf{Name} Route id
                 \textbf{Default~value} - \\
  \index{Route id, Parameter}
  \index{1100, ParamID}
  \label{Route id}
  \textbf{Description} The id of the route can be used in reroutes and 
  image requests.
\item \textbf{1101} \textbf{Type} uint32 \textbf{Name} Truncate dist
                 \textbf{Default~value} - \\
  \index{Truncate dist, Parameter}
  \index{1101, ParamID}
  \label{Truncate dist}
  \textbf{Description} Distance after truncated route.
\item \textbf{1102} \textbf{Type} uint32 \textbf{Name} Dist to WP
                 \textbf{Default~value} - \\
  \index{Dist to WP, Parameter}
  \index{1102, ParamID}
  \label{Dist to WP}
  \textbf{Description} Distance from truncated point to next waypoint 
\item \textbf{1103} \textbf{Type} uint32 \textbf{Name} Phone dist
                 \textbf{Default~value} - \\
  \index{Phone dist, Parameter}
  \index{1103, ParamID}
  \label{Phone dist}
  \textbf{Description} Minimum distance left before trying to download the
  rest of a truncated route.
\item \textbf{1104} \textbf{Type} byte array \textbf{Name} Route string table
                 \textbf{Default~value} - \\
  \index{Route string table, Parameter}
  \index{1104, ParamID}
  \label{Route string table}
  \textbf{Description} The strings used in the route. If more than one
  String table parameter is present the ones following the first must be
  appended to the first byte array. For usage see param 1105 and Navigator 
  route data in navserver\_route\_spec.
\item \textbf{1105} \textbf{Type} byte array \textbf{Name} Route data
                 \textbf{Default~value} - \\
  \index{Route data, Parameter}
  \index{1105, ParamID}
  \label{Route data}
  \textbf{Description} The route data formatted according to the route 
  protocol. If more than one Route data parameter is present the ones
  following the first must be appended to the first byte array.
  The route data used is in Navigator route data, see 
  navserver\_route\_spec document.
\item \textbf{1106} \textbf{Type} 4*int32 \textbf{Name} Route bbox
                 \textbf{Default~value} - \\
  \index{Route bbox, Parameter}
  \index{1106, ParamID}
  \label{Route bbox}
  \textbf{Description} The route's boundingbox.

\item \textbf{1107} \textbf{Type} uint32 
       \textbf{Name} Traffic Information Update Interval
                 \textbf{Default~value} - \\
  \index{Traffic Information Update Interval, Parameter}
  \index{1107, ParamID}
  \label{Traffic Information Update Interval}
  \textbf{Description} The server can signal the lowest allowed
  traffic information update interval - in minutes - to the client
  with this parameter. The server will ignore this parameter if the
  client sends it.

\end{list}

\subsection{NAV\_ROUTE\_REPLY v.2}

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1108} \textbf{Type} byte array
       \textbf{Name} Route Color Table
                 \textbf{Default~value} - \\
  \index{Route Color Table, Parameter}
  \index{1108, ParamID}
  \label{Route Color Table}
  \textbf{Description} A table of any number of RGB byte triplets.
  The order are R(red) byte, G(reen) byte and B(lue) byte repeated until
  the end of param. The order in this list of triplets is the index of the
  colors in the Signposts in the Navigator route data, see 
  navserver\_route\_spec.
\end{list}



\subsection{NAV\_SEARCH\_REQ v.1}

A search request sent from the client to the server.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1200} \textbf{Type} uint16,uint16 
                 \textbf{Name} Search start index
                 \textbf{Default~value} 0,0 \\
  \index{Search start index, Parameter}
  \index{1200, ParamID}
  \label{Search start index}
  \textbf{Description} The index of the first match to send in
  reply, start at zero(0) then increase by nbr search hits. The first uint16
  is for areas and the second is for items.
\item \textbf{1201} \textbf{Type} string \textbf{Name} Search area string
                 \textbf{Default~value} - \\
  \index{Search area string, Parameter}
  \index{1201, ParamID}
  \label{Search area string}
  \textbf{Description} Area name, search string.
\item \textbf{1202} \textbf{Type} string \textbf{Name} Search AreaID
                 \textbf{Default~value} - \\
  \index{Search AreaID, Parameter}
  \index{1202, ParamID}
  \label{Search AreaID}
  \textbf{Description} Id of the area selected. If present then search will be 
  made in this area.
\item \textbf{1203} \textbf{Type} string \textbf{Name} Search item string
                 \textbf{Default~value} - \\
  \index{Search item string, Parameter}
  \index{1203, ParamID}
  \label{Search item string}
  \textbf{Description} Item name, search string.
\item \textbf{1204} \textbf{Type} string \textbf{Name} Search category
                 \textbf{Default~value} - \\
  \index{Search category, Parameter}
  \index{1204, ParamID}
  \label{Search category}
  \textbf{Description} Category ID, search using this category.
\item \textbf{1205} \textbf{Type} uint32 \textbf{Name} TopRegionID
                 \textbf{Default~value} - \\
  \index{TopRegionID, Parameter}
  \index{1205, ParamID}
  \label{search_req:TopRegionID}
  \textbf{Description} Top region ID to search in. Used if no position is 
  given.
\item \textbf{1206} \textbf{Type} int32,int32 \textbf{Name} Search pos coord
                 \textbf{Default~value} - \\
  \index{Search pos coord, Parameter}
  \index{1206, ParamID}
  \label{Search pos coord}
  \textbf{Description} Array of two int32. Position coordinate. This replaces
  TopRegionID and if not present Search area string.
\item \textbf{1207} \textbf{Type} uint16 \textbf{Name} Max Nbr Search Matches
                 \textbf{Default~value} 10 \\
  \index{Max Nbr Search Matches, Parameter}
  \index{1207, ParamID}
  \label{Max Nbr Search Matches}
  \textbf{Description} The reply full limit.
\item \textbf{1208} \textbf{Type} byte,byte \textbf{Name} Search sorting
                 \textbf{Default~value} 4,4 \\
  \index{Search sorting, Parameter}
  \index{1208, ParamID}
  \label{Search sorting}
  \textbf{Description} How the areas, items, should be sorted.\\
  \begin{tabular}{|l|c|p{7cm}|} \hline
    0x00  & No sort         & The result will not be sorted. \\\hline
    0x01  & Alfa sort       & Matches are sorted in alphabetical order.\\\hline
    0x02  & Confidence sort & Matches are sorted by confidence, attempting to
    place the most probable matches on top of the match list. \\\hline
    0x04  & Distance sort   & Matches are sorted by their distance from the
    Search pos coord, falls back to Confidence sort if no or invalid 
    Search pos coord. \\\hline
  \end{tabular}
\end{list}


\subsection{NAV\_SEARCH\_REPLY v.1}

A reply to the search request, sent from the server
to the client. The reply can contain both area and item matches.

Search location type.
\begin{verbatim}
      enum RegionType {
         streetnumber = 0x01,
         address      = 0x02,
         city_part    = 0x03,
         city         = 0x04,
         municipal    = 0x05,
         county       = 0x06,
         state        = 0x07,
         country      = 0x08,
         zipcode      = 0x09,
         zipArea      = 0x0a,
      };
\end{verbatim}
\label{SearchLocationType}

Search Item type.
\begin{verbatim}
      enum SearchItemType {
         street   = 0x01,
         poi      = 0x02,
         misc     = 0x03,
         category = 0x04,
         persons  = 0x05,
      };
\end{verbatim}

Search Item Sub type. The type of poi.
\begin{verbatim}
      enum SearchItemSubType {
         company = 0,

         airport = 1,
         amusementPark = 2,
         atm = 3,
         automobileDealership = 4,
         bank = 5,
         bowlingCentre = 6,
         busStation = 7,
         businessFacility = 8,
         casino = 9,
         cinema = 10,
         cityCentre = 11,
         cityHall = 12,
         communityCentre = 13,
         commuterRailStation = 14,
         courtHouse = 15,
         exhibitionOrConferenceCentre = 16,
         ferryTerminal = 17,
         frontierCrossing = 18,
         golfCourse = 19,
         groceryStore = 20,
         historicalMonument = 21,
         hospital = 22,
         hotel = 23,
         iceSkatingRink = 24,
         library = 25,
         marina = 26,
         motoringOrganisationOffice = 27,
         museum = 28,
         nightlife = 29,
         openParkingArea = 30,
         parkAndRide = 31,
         parkingGarage = 32,
         petrolStation = 33,
         policeStation = 34,
         publicSportAirport = 35,
         railwayStation = 36,
         recreationFacility = 37,
         rentACarFacility = 38,
         restArea = 39,
         restaurant = 40,
         school = 41,
         shoppingCentre = 42,
         skiResort = 43,
         sportsActivity = 44,
         sportsCentre = 45,
         theatre = 46,
         touristAttraction = 47,
         touristOffice = 48,
         university = 49,
         vehicleRepairFacility = 50,
         winery = 51,
         postOffice = 52,
         tramStation = 53,
         multi = 54,
         wcpoiType = 55,
         shop = 56,
         cemetery = 57,
         industrialComplex = 58,
         publicIndividualBuilding = 59,
         otherIndividualBuilding = 60,
         notCategorised = 61,
         unknownType = 62,
         airlineAccess = 63,
         beach = 64,
         campingGround = 65,
         carDealer = 66,
         concertHall = 67,
         tollRoad = 68,
         culturalCentre = 69,
         dentist = 70,
         doctor = 71,
         driveThroughBottleShop = 72,
         embassy = 73,
         entryPoint = 74,
         governmentOffice = 75,
         mountainPass = 76,
         mountainPeak = 77,
         musicCentre = 78,
         opera = 79,
         parkAndRecreationArea = 80,
         pharmacy = 81,
         placeOfWorship = 82,
         rentACarParking = 83,
         restaurantArea = 84,
         scenicView = 85,
         stadium = 86,
         swimmingPool = 87,
         tennisCourt = 88,
         vetrinarian = 89,
         waterSports = 90,
         yachtBasin = 91,
         zoo = 92,
         wlan = 93,
         noType = 94,   // you know what the POI is, but there is no other
                        // appropriate type to use.
         invalidPOIType = 95, // marker for error type
         church = 96,
         mosque = 97,
         synagogue = 98,
         subwayStation = 99,
         cafe = 100,
         hinduTemple = 101,
         buddhistSite = 102,

         invalidItemSubType = 255
      };
\end{verbatim}


\begin{list}{\textbf{ParamID}}{}
\item \textbf{1300} \textbf{Type} uint16, uint16 \textbf{Name} Area nbrs
                 \textbf{Default~value} 0,0 \\
  \index{Area nbrs, Parameter}
  \index{1300, ParamID}
  \label{Area nbrs}
  \textbf{Description} The index of the first area match, the total number
  of area matches for the search.
\item \textbf{1301} \textbf{Type} uint16, uint16 \textbf{Name} Item nbrs
                 \textbf{Default~value} 0,0 \\
  \index{Item nbrs, Parameter}
  \index{1301, ParamID}
  \label{Item nbrs}
  \textbf{Description} The index of the first item match, the total number
  of item matches for the search.
\item \textbf{1302} \textbf{Type} byte array \textbf{Name} Search regions
                 \textbf{Default~value} - \\
  \index{Search regions, Parameter}
  \index{1302, ParamID}
  \label{Search regions}
  \textbf{Description} List of Search regions. The order of the Regions are
  their index that is used in the area matches and the item matches. 
  The region structure is defined as:\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
    Function    & Size    & Description \\
                & (Bytes) & \\\hline
    Type        & 2       & Search location type. \\\hline
    ID          & String  & MC2 internal id of this region.\\\hline
    name        & String  & Name of this region. \\\hline
  \end{tabular}
\item \textbf{1303} \textbf{Type} byte array  \textbf{Name} Area matches
                 \textbf{Default~value} - \\
  \index{Area matches, Parameter}
  \index{1303, ParamID}
  \label{Area matches}
  \textbf{Description} List of Area matches. The area match structure is
  defined as:\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
    Function    & Size    & Description \\
                & (Bytes) &             \\\hline
    Type        & 2       & Search location type.                   \\\hline
    ID          & String  & MC2 internal id of this area match.     \\\hline
    name        & String  & Name of this overview match.            \\\hline
    Nbr regions & 1       & Number of regions for this area match.  \\\hline
    Regions     & X       & Nbr regions region indexes into region table, each 
                            index is a short.                          \\\hline
  \end{tabular}
\item \textbf{1304} \textbf{Type} byte array \textbf{Name} Item matches
                 \textbf{Default~value} - \\
  \index{Item matches, Parameter}
  \index{1304, ParamID}
  \label{Item matches}
  \textbf{Description} List of Item matches. The item match structure is
  defined as:\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
    Function  & Size    & Description \\
              & (Bytes) &             \\\hline
    Type        & 1       & Search Item type.                          \\\hline
    Sub type    & 1       & Search Item sub type.                      \\\hline
    ID          & String  & MC2 internal id of this item match.        \\\hline
    name        & String  & Name of this match.                        \\\hline
    lat         & 4       & Latitude of item.                          \\\hline
    lon         & 4       & Longitude of item.                         \\\hline
    Nbr regions & 1       & Number of regions for this match.          \\\hline
    Regions     & X       & Nbr regions region indexes into region table, each 
                            index is a short.                          \\\hline
  \end{tabular}
\end{list}


\subsection{NAV\_REV\_GEOCODING\_REQ v.1}

A request for looking up geographical information about a position, sent
from client to server. The client may supply a preferred language for the
returned names, see Section \ref{LanguageClient}.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1400} \textbf{Type} int32,int32 \textbf{Name} Lookup position
                 \textbf{Default~value} - \\
  \index{Lookup position, Parameter}
  \index{1400, ParamID}
  \label{Lookup position}
  \textbf{Description} The coordinate to look up.
\end{list}


\subsection{NAV\_REV\_GEOCODING\_REPLY v.1}

A reply to a rev\_geocoding\_request, sent from the server
to the client. The reply may contain zero or all of the following parameters.
Or some of them.
\begin{list}{\textbf{ParamID}}{}
\item \textbf{1500} \textbf{Type} string \textbf{Name} CountryName
                 \textbf{Default~value} - \\
  \index{CountryName, Parameter}
  \index{1500, ParamID}
  \label{CountryName}
  \textbf{Description} Name of the country.
\item \textbf{1501} \textbf{Type} string \textbf{Name} MunicipalName
                 \textbf{Default~value} - \\
  \index{MunicipalName, Parameter}
  \index{1501, ParamID}
  \label{MunicipalName}
  \textbf{Description} Name of municipal.
\item \textbf{1502} \textbf{Type} string \textbf{Name} CityName
                 \textbf{Default~value} - \\
  \index{CityName, Parameter}
  \index{1502, ParamID}
  \label{CityName}
  \textbf{Description} Name of city.
\item \textbf{1503} \textbf{Type} string \textbf{Name} DistrictName
                 \textbf{Default~value} - \\
  \index{DistrictName, Parameter}
  \index{1503, ParamID}
  \label{DistrictName}
  \textbf{Description} Name of city district.
\item \textbf{1504} \textbf{Type} string \textbf{Name} AddressName
                 \textbf{Default~value} - \\
  \index{AddressName, Parameter}
  \index{1504, ParamID}
  \label{AddressName}
  \textbf{Description} Name of street address.
\item \textbf{1505} \textbf{Type} uint32 \textbf{Name} TopRegionID
                 \textbf{Default~value} - \\
  \index{TopRegionID, Parameter}
  \index{1505, ParamID}
  \label{TopRegionID}
  \textbf{Description} The top region id of the position.
\end{list}


\subsection{NAV\_MAP\_REQ v.1}

This request is used to request a map image from the server.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1600} \textbf{Type} int32*4 \textbf{Name} MapBoundingbox
                 \textbf{Default~value} - \\
  \index{MapBoundingbox, Parameter}
  \index{1600, ParamID}
  \label{MapBoundingbox}
  \textbf{Description} The Bounding Box to make map for.
\item \textbf{1601} \textbf{Type} int32,int32 \textbf{Name} MapPosition
                 \textbf{Default~value} - \\
  \index{MapPosition, Parameter}
  \index{1601, ParamID}
  \label{MapPosition}
  \textbf{Description} The current position.
\item \textbf{1602} \textbf{Type} uint16 \textbf{Name} Speed
                 \textbf{Default~value} - \\
  \index{Speed, Parameter}
  \index{1602, ParamID}
  \label{Speed}
  \textbf{Description} The current speed in m/s * 32.
\item \textbf{1603} \textbf{Type} uint16 \textbf{Name} Heading
                 \textbf{Default~value} - \\
  \index{Heading, Parameter}
  \index{1603, ParamID}
  \label{Heading}
  \textbf{Description} The current heading.
\item \textbf{1604} \textbf{Type} uint32 \textbf{Name} Map radius
                 \textbf{Default~value} - \\
  \index{Map radius, Parameter}
  \index{1604, ParamID}
  \label{Map radius}
  \textbf{Description} The desired map radius in m.
\item \textbf{1605} \textbf{Type} string \textbf{Name} Route ID
                 \textbf{Default~value} - \\
  \index{Route ID, Parameter}
  \index{1605, ParamID}
  \label{Route ID}
  \textbf{Description} The route to show's id.
\item \textbf{1606} \textbf{Type} uint16,uint16 \textbf{Name} Image size
                 \textbf{Default~value} - \\
  \index{Image size, Parameter}
  \index{1606, ParamID}
  \label{Image size}
  \textbf{Description} Image width and height. Specifies how large the
  resulting image should be in pixels.
\item \textbf{1607} \textbf{Type} uint16,uint16 \textbf{Name} Viewbox size
                 \textbf{Default~value} - \\
  \index{Viewbox size, Parameter}
  \index{1607, ParamID}
  \label{Viewbox size}
  \textbf{Description} Viewbox width and height. Specifies how large the
  displayed part of the image will be, which could affect name placement
  in the map.
\item \textbf{1608} \textbf{Type} byte \textbf{Name} Image Format
                 \textbf{Default~value} - \\
  \index{Image Format, Parameter}
  \index{1608, ParamID}
  \label{Image Format}
  \textbf{Description} Specifies the desired graphics format.
\begin{verbatim}
   enum imageFormat {
      /// PNG Portable Network Graphics
      PNG  = 0,
      /// Wireless BitMaP
      WBMP = 1,
      /// Joint Pictures Expert Group
      JPEG = 2,
      /// Graphics Interchange Format
      GIF  = 3,

      // The number of image formats, must be last!
      NBR_IMAGE_FORMATS
   };
\end{verbatim}
\item \textbf{1609} \textbf{Type} byte array \textbf{Name} Map Item
                 \textbf{Default~value} - \\
  \index{Map Item, Parameter}
  \index{1609, ParamID}
  \label{Map Item}
  \textbf{Description} Informs the server about items that should be
  indicated in the map.

\begin{tabular}{|l|l|}\hline
Byte offset & PositionItem \\\hline
0           & Type         \\\hline
2           & Latitude     \\
4           &              \\\hline
6           & Longitude    \\
8           &              \\\hline
\end{tabular}

Type is one of the MapItemType enum, and can be used to decide which
symbol to use in the map image.
\begin{verbatim}
enum MapItemType {
  Invalid      = 0,
  Route        = 1, 
  SearchItem   = 2,
  Favorite     = 3,
  UserPosition = 4,
};
\end{verbatim}
\item \textbf{1610} \textbf{Type} byte array \textbf{Name} Extra info
                 \textbf{Default~value} - \\
  \index{Extra info, Parameter}
  \index{1610, ParamID}
  \label{Extra info}
  \textbf{Description} Informs the server about information to include
  in the map.

\begin{tabular}{|l|c|l|}\hline
Function & Size    & Description \\
         & (Bytes) &             \\\hline
Type     & 2       & Describes the content \\\hline
Value    & 4       & Relevant data depending on the type\\\hline
\end{tabular}
\begin{verbatim}
enum MapInfoType{
  Invalid     = 0,
  // Value determines what category, not yet defined
  Category    = 1,
  // If value != 0 then traffic info in map
  TrafficInformation = 2,
  // If value != 0 then draw scale on map
  Ruler       = 3,
  // If value != 0 then draw topographic background
  // on map
  Topographic = 4,
  // Palette and similar info, not yet defined
  MapFormat   = 5,
  // Value is rotation angle
  Rotate      = 6, 
};
\end{verbatim}
\end{list}


~\\
This is the order in which to select the maps's boundingbox.
\begin{enumerate}
\item Boundingbox --  A complete bounding box.
\item VectorBox   --  The bounding box will be calculated from the
  current position, heading, speed and Route ID.
\item RadiusBox   --  The bounding box will contain a circle
  centered on the current position and with the specified map radius.
\item RouteBox    -- The bounding box will contain the entire route
  specified by the Route ID.
\end{enumerate}


\subsection{NAV\_MAP\_REPLY v.1}

These parameters serves a map image to the client.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1700} \textbf{Type} 4*int32 \textbf{Name} MapBoundingbox
                 \textbf{Default~value} - \\
  \index{MapBoundingbox, Parameter}
  \index{1700, ParamID}
  \textbf{Description} The bounding box of the generated map image.
\item \textbf{1701} \textbf{Type} uint16,uint16 \textbf{Name} Image size
                 \textbf{Default~value} - \\
  \index{Image size, Parameter}
  \index{1701, ParamID}
  \textbf{Description} Image width and height in pixels.
\item \textbf{1702} \textbf{Type} uint32,uint32 \textbf{Name} Real world size
                 \textbf{Default~value} - \\
  \index{Real world size, Parameter}
  \index{1702, ParamID}
  \label{Real world size}
  \textbf{Description} Image width and height in meters.
\item \textbf{1703} \textbf{Type} byte \textbf{Name} Image Format
                 \textbf{Default~value} - \\
  \index{Image Format, Parameter}
  \index{1703, ParamID}
  \textbf{Description} Specifies graphics format. See Image Format 
  \ref{Image Format}.
\item \textbf{1704} \textbf{Type} byte array \textbf{Name} Image
                 \textbf{Default~value} - \\
  \index{Image, Parameter}
  \index{1704, ParamID}
  \label{Image}
  \textbf{Description} The image buffer.
\item \textbf{1705} \textbf{Type} int32,int32 \textbf{Name} Checkpoint
                 \textbf{Default~value} - \\
  \index{Checkpoint, Parameter}
  \index{1705, ParamID}
  \label{Checkpoint}
  \textbf{Description} Point where new map is needed. Used when making a
  VectorBox.
\end{list}


\subsection{NAV\_FAV\_REQ v.1}

A request to synchronize favorites from client.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{4800} \textbf{Type} uint32 \textbf{Name} Favflags
                 \textbf{Default~value} - \\
  \index{Favflags, Parameter}
  \index{4800, ParamID}
  \label{Favflags}
  \textbf{Description} Flags field with:\\
  \begin{tabular}{ll}
    LSB & NoSync                         \\
  \end{tabular}
\item \textbf{4801} \textbf{Type} uint32 array \textbf{Name} FavIDSync
                 \textbf{Default~value} - \\
  \index{FavIDSync, Parameter}
  \index{4801, ParamID}
  \label{FavIDSync}
  \textbf{Description} Favorite IDs to sync. IDs of favorites that the client 
  has.
\item \textbf{4802} \textbf{Type} uint32 array \textbf{Name} FavIDDel
                 \textbf{Default~value} - \\
  \index{FavIDDel, Parameter}
  \index{4802, ParamID}
  \label{FavIDDel}
  \textbf{Description} Favorite IDs to delete. IDs of favorites that the client
  has deleted.
\item \textbf{4803} \textbf{Type} byte array \textbf{Name} FavAdd
                 \textbf{Default~value} - \\
  \index{FavAdd, Parameter}
  \index{4803, ParamID}
  \label{FavAdd}
  \textbf{Description} List of favorites to add. See below for declaration of
  favorite.
\end{list}


\label{FavoriteData}
A favorite consists of:\\
\begin{centering}
\begin{tabular}{|l|c|p{7cm}|}
\hline
Function    & Size    & Description                 \\
            & (Bytes) &                              \\\hline
ID          & 4       & The ID.                       \\\hline
lat         & 4       & The latitude.                  \\\hline
lon         & 4       & The longitude.                  \\\hline
name        & string  & String containing the name.      \\\hline
shortName   & string  & String containing the shortName.  \\\hline
description & string  & String containing the description. \\\hline
category    & string  & String containing the category.     \\\hline
mapIconName & string  & String containing the mapIconName.   \\\hline
\end{tabular}
\end{centering}


\subsection{NAV\_FAV\_REQ v.2}
\label{NAV_FAV_REQ_2}

Version two is the same as version one except it adds the following to 
favorites. After the mapIconName this is added: 

~

\begin{centering}
\begin{tabular}{|l|c|p{7cm}|}
\hline
Function    & Size    & Description                    \\
nbrInfos    & 2       & The number of info fields.     \\\hline
            &         & Then nbrInfos info fields   \\\hline
type        & 2       & The AdditionalInfo type of the info field see \ref{additionalinfoenum}. \\\hline
key        & string  & The string key of the info field. \\\hline
value      & string  & The string value of the info field. \\\hline
\end{tabular}
\end{centering}

\subsection{NAV\_FAV\_REPLY v.3}

In version 3 a crc is returned in the reply.

\subsection{NAV\_FAV\_REPLY v.4}

In version 4 the client must support handling the \emph{AdditionalInfoType 
image\_url} and not only handle \emph{url} in a special way.


\subsection{NAV\_FAV\_REPLY v.1}

A reply from server with the changes needed to make the client uptodate with
the server.
\begin{list}{\textbf{ParamID}}{}
\item \textbf{4900} \textbf{Type} byte array \textbf{Name} AddFav
                 \textbf{Default~value} - \\
  \index{AddFav, Parameter}
  \index{4900, ParamID}
  \label{AddFav}
  \textbf{Description} List of favorites to add. See Section 
  \ref{FavoriteData}.
\item \textbf{4901} \textbf{Type} uint32 array \textbf{Name} DelFav
                 \textbf{Default~value} - \\
  \index{DelFav, Parameter}
  \index{4901, ParamID}
  \label{DelFav}
  \textbf{Description} Favorite IDs to delete.
\item \textbf{4902} \textbf{Type} byte array \textbf{Name} AutoFav
                 \textbf{Default~value} - \\
  \index{AutoFav, Parameter}
  \index{4902, ParamID}
  \label{AutoFav}
  \textbf{Description} The auto dest Favorite. See Section \ref{FavoriteData}.
\end{list}

\subsection{NAV\_FAV\_REPLY v.2}

Same as version one but with the same addition to favorite as in
\texttt{NAV\_FAV\_REQ v.2} in section \ref{NAV_FAV_REQ_2}.

\subsection{NAV\_FAV\_REPLY v.3}

Also a crc is sent.
\begin{list}{\textbf{ParamID}}{}
\item \textbf{4903} \textbf{Type} String \textbf{Name} Favorites CRC
                 \textbf{Default~value} - \\
  \index{Favorites CRC, Parameter}
  \index{4903, ParamID}
  \textbf{Description} String that is the crc for the favorites.
\end{list}

\subsection{NAV\_FAV\_REPLY v.4}

In version 4 the client must support handling the \emph{AdditionalInfoType 
image\_url} and not only handle \emph{url} in a special way.

\subsection{NAV\_INFO\_REQ v.1}

A request for additional information about items, sent
from client to server.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{1800} \textbf{Type} string,string \textbf{Name} InfoItemID
                 \textbf{Default~value} - \\
  \index{InfoItemID, Parameter}
  \index{1800, ParamID}
  \label{InfoItemID}
  \textbf{Description} First string is Search item id and second string is
  AdditionalInfo value. The AdditionalInfo is the value from a earlier
  delivered InfoItem with the type {\tt more}, see Section 
  \ref{additionalinfoenum}, or empty string if not to get additional info.
\end{list}

\subsection{NAV\_INFO\_REQ v.2}

In version 2 the client must support handling the \emph{AdditionalInfoType 
image\_url} and not only handle \emph{url} in a special way.


\subsection{NAV\_INFO\_REPLY v.1}

A reply to an info request, sent from the server
to the client. 
\begin{list}{\textbf{ParamID}}{}
\item \textbf{1900} \textbf{Type} byte array \textbf{Name} InfoItems
                 \textbf{Default~value} - \\
  \index{InfoItems, Parameter}
  \index{1900, ParamID}
  \label{InfoItems}
  \textbf{Description} List of InfoItems.\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
    Function & Size    & Description \\
             & (Bytes) & \\\hline
    Item ID  & string  & The MC2 internal id sent in the request.      \\\hline
    nbr tuples& 1      & The number of type-key-value tuples for this 
                         item.\\\hline
    type     & 1       & The type of information, see \ref{additionalinfoenum} 
                         for possible values.                          \\\hline
    content type & 1   & The content type of information, see \ref{additionaldetailcontentenum} 
                         for possible values. The field shall be handled as the 
                         specified content type.                       \\\hline
    Key      & string  & String to be presented as first value or key. \\\hline
    Value    & string  & String to be presented as second value.       \\\hline
  \end{tabular}
\end{list}


\label{additionalinfoenum}
AdditionalInfoType enumeration. All unrecognized types are considered text.

\begin{verbatim}
       enum AdditionalInfoType {
         dontShow     = 0x00,
         text         = 0x01,
         url          = 0x02,
         wap_url      = 0x03,
         email        = 0x04,
         phone_number = 0x05,
         mobile_phone = 0x06,
         fax_number   = 0x07,
         contact_info = 0x08,
         short_info   = 0x09,
         vis_address  = 0x0a,
         vis_house_nbr= 0x0b,
         vis_zip_code = 0x0c,
         vis_complete_zip=0x0d,
         Vis_zip_area = 0x0e,
         vis_full_address=0x0f,
         brandname    = 0x10,
         short_description=0x11,
         long_description=0x12,
         citypart     = 0x13,
         state        = 0x14,
         neighborhood = 0x15,
         open_hours   = 0x16,
         nearest_train= 0x17,
         start_date   = 0x18,
         end_date     = 0x19,
         start_time   = 0x1a,
         end_time     = 0x1b,
         accommodation_type=0x1c,
         check_in     = 0x1d,
         check_out    = 0x1e,
         nbr_of_rooms = 0x1f,
         single_room_from=0x20,
         double_room_from=0x21,
         triple_room_from=0x22,
         suite_from   = 0x23,
         extra_bed_from=0x24,
         weekend_rate = 0x25,
         nonhotel_cost= 0x26,
         breakfast    = 0x27,
         hotel_services=0x28,
         credit_card  = 0x29,
         special_feature=0x2a,
         conferences  = 0x2b,
         average_cost = 0x2c,
         booking_advisable=0x2d,
         admission_charge=0x2e,
         home_delivery= 0x2f,
         disabled_access=0x30,
         takeaway_available=0x31,
         allowed_to_bring_alcohol=0x32,
         type_food    = 0x33,
         decor        = 0x34,
         image_url    = 0x35,
         supplier     = 0x36,
         owner                    = 0x37,
         price_petrol_superplus   = 0x38,
         price_petrol_super       = 0x39,
         price_petrol_normal      = 0x3a,
         price_diesel             = 0x3b,
         price_biodiesel          = 0x3c,
         free_of_charge           = 0x3d,
         tracking_data            = 0x3e,
         post_address             = 0x3f,
         post_zip_area            = 0x40,
         post_zip_code            = 0x41,
         open_for_season          = 0x42,
         ski_mountain_min_max_height = 0x43,
         snow_depth_valley_mountain = 0x44,
         snow_quality             = 0x45,
         lifts_open_total         = 0x46,
         ski_slopes_open_total    = 0x47,
         cross_country_skiing_km  = 0x48,
         glacier_area             = 0x49,
         last_snowfall            = 0x4a,
         special_flag             = 0x4b,
         tele_p_phone_nbr         = 0x4c,

         static_id                = 0x4d,

         has_service              = 0x4e,
         has_carwash              = 0x4f,
         has_24h_self_service_zone= 0x50,
         drive_in                 = 0x51,
         mailbox_collection_time  = 0x52,
         performer                = 0x53,
         booking_url              = 0x54,
         booking_phone_number     = 0x55,
         
         more         = 0xff
       }
\end{verbatim}

The \tt{special\_flag} field means that if you don't find any special 
field you know how to handle, this favorite should not be shown. 
Special fields are like \tt{tracking\_data} which requires a tracking
request to get the latest coordinate for the tracked user.

\subsection{NAV\_INFO\_REPLY v.2}

In version 2 the client must support handling the \emph{AdditionalInfoType 
image\_url} and not only handle \emph{url} in a special way.


\subsection{NAV\_MESSAGE\_REQ v.1}
This message is a request from the client to the server to send a
map, route, itinerary, favorite, or search result to another
terminal, Wayfinder client or not.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{2000} \textbf{Type} byte \textbf{Name} MessageType
                 \textbf{Default~value} - \\
  \index{MessageType, Parameter}
  \index{2000, ParamID}
  \label{MessageType}
  \textbf{Description} The type of message to send. Select one from the
  MessageType enum. Several kinds of Instant Message protocols exist,
  so the protocol must be specified in the receiver string.
\begin{verbatim}
  enum MessageType{
    invalid        = 0,
    HTML-email     = 1,
    non-HTML-email = 2,
    SMS            = 3,
    MMS            = 4,
    FAX            = 6,
    InstantMessage = 5,
  };
\end{verbatim}
\item \textbf{2001} \textbf{Type} byte \textbf{Name} ObjectType
                 \textbf{Default~value} - \\
  \index{ObjectType, Parameter}
  \index{2001, ParamID}
  \label{ObjectType}
  \textbf{Description} The type of object to send. Select one from the
  ObjectType enum.
\begin{verbatim}
  enum ObjectType{
    invalid        = 0,
    Favorite       = 1,
    SearchItem     = 2,
    Route          = 4,
    Map            = 6,
    Position       = 7,
  };
\end{verbatim}
\item \textbf{2002} \textbf{Type} string \textbf{Name} Signature
                 \textbf{Default~value} - \\
  \index{Signature, Parameter}
  \index{2002, ParamID}
  \label{Signature}
  \textbf{Description} Signature at end of message.
\item \textbf{2003} \textbf{Type} string \textbf{Name} Subject
                 \textbf{Default~value} - \\
  \index{Subject, Parameter}
  \index{2003, ParamID}
  \label{Subject}
  \textbf{Description} Subject of message. Used with email and MMS.
\item \textbf{2004} \textbf{Type} string \textbf{Name} EmailReceiver
                 \textbf{Default~value} - \\
  \index{EmailReceiver, Parameter}
  \index{2004, ParamID}
  \label{EmailReceiver}
  \textbf{Description} The receiver email-address. Used with email and MMS.
\item \textbf{2005} \textbf{Type} string \textbf{Name} EmailSender
                 \textbf{Default~value} - \\
  \index{EmailSender, Parameter}
  \index{2005, ParamID}
  \label{EmailSender}
  \textbf{Description} The sender email-address. Used with email and MMS.
\item \textbf{2006} \textbf{Type} string \textbf{Name} PhoneReceiver
                 \textbf{Default~value} - \\
  \index{PhoneReceiver, Parameter}
  \index{2006, ParamID}
  \label{PhoneReceiver}
  \textbf{Description} The phonenumber of the receiver. Used with SMS.
\item \textbf{2007} \textbf{Type} string \textbf{Name} PhoneSender
                 \textbf{Default~value} - \\
  \index{PhoneSender, Parameter}
  \index{2007, ParamID}
  \label{PhoneSender}
  \textbf{Description} The phonenumber of the sender. Used with SMS.
\item \textbf{2008} \textbf{Type} uint32 \textbf{Name} FavoriteID
                 \textbf{Default~value} - \\
  \index{FavoriteID, Parameter}
  \index{2008, ParamID}
  \label{FavoriteID}
  \textbf{Description} The ID of the favorite to show.
\item \textbf{2009} \textbf{Type} string \textbf{Name} SearchItemID
                 \textbf{Default~value} - \\
  \index{SearchItemID, Parameter}
  \index{2009, ParamID}
  \label{SearchItemID}
  \textbf{Description} The ID of the SearchItem to show.
\item \textbf{2010} \textbf{Type} int32,int32 \textbf{Name} Position
                 \textbf{Default~value} - \\
  \index{Position, Parameter}
  \index{2010, ParamID}
  \label{Position}
  \textbf{Description} The position to show.
\item \textbf{2011} \textbf{Type} string \textbf{Name} LocationName
                 \textbf{Default~value} - \\
  \index{LocationName, Parameter}
  \index{2011, ParamID}
  \label{LocationName}
  \textbf{Description} The name of the location, favorite, SearchItem
  or position, to show.
\item \textbf{2012} \textbf{Type} string \textbf{Name} RouteID
                 \textbf{Default~value} - \\
  \index{RouteID, Parameter}
  \index{2012, ParamID}
  \label{RouteID}
  \textbf{Description} The ID of the route to show.
\item \textbf{2013} \textbf{Type} string \textbf{Name} OriginName
                 \textbf{Default~value} - \\
  \index{OriginName, Parameter}
  \index{2013, ParamID}
  \label{OriginName}
  \textbf{Description} The name of the origin. Server will set name of street
  or coordinate of starting position in route if this parameter is not 
  present.
\item \textbf{2014} \textbf{Type} string \textbf{Name} DestinationName
                 \textbf{Default~value} - \\
  \index{DestinationName, Parameter}
  \index{2014, ParamID}
  \label{DestinationName}
  \textbf{Description} The name of the destination. Server will set name of
  street or coordinate of ending position in route if this parameter is not 
  present.
\end{list}

The supported combinations of MessageType and ObjectType are:

~

\begin{tabular}{|l|p{7cm}|} \hline
HTML-email & Favorite, SearchItem, Route, Position                    \\\hline
non-HTML-email & Route                                                \\\hline
SMS & Favorite, SearchItem, Route, Position                           \\\hline
MMS& Favorite, SearchItem, Route, Position                            \\\hline
\end{tabular}

HTML-email and non-HTML-email are sent by the server to the receiver, SMS
and MMS are sent back in the reply.

\subsection{NAV\_MESSAGE\_REPLY v.1}

Acknowledgment reply from the server. If the server is unable or
unwilling to send the message it is included in this reply so that the
client can send it itself.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{2100} \textbf{Type} byte array \textbf{Name} Message buffer
                 \textbf{Default~value} - \\
  \index{Message buffer, Parameter}
  \index{2100, ParamID}
  \label{Message buffer}
  \textbf{Description} Data to send. If more than one
  Message buffer parameter is present the ones following the first must be
  appended to the first byte array.
\end{list}

Message parts are separated by the \emph{separator sequence}: $"\backslash r\backslash n<<<<<<"$

~

In the case that the reply Message buffer contains SMS the SMSes are
separated by the \emph{separator sequence} and there is one
\emph{separator sequence} after the last SMS as well.

~

If the reply Message buffer contains MMS the MMSes are separated by
\emph{separator sequence}s and there is one after the last MMS as
well.  Each MMS has it's own mail header with {\tt From:}, {\tt To:},
{\tt Subject:}, {\tt MIME-Version:}, and {\tt Content-Type:} header
fields.


\subsection{NAV\_UPGRADE\_REQ v.1}
Requests an upgrade from the server.

%XXX: Support Activation codes that requires client to select a top-region.
%     By server returning a top-region-list to select among.
%     Server sends error and client goes to a page, ac as param.
%     In future maybe a list of regionIDs and names to client.
%
%     No need to enter phone-number? Especially if re-activating.


\begin{list}{\textbf{ParamID}}{}
\item \textbf{2200} \textbf{Type} string \textbf{Name} ActivationCode
                 \textbf{Default~value} - \\
  \index{ActivationCode, Parameter}
  \index{2200, ParamID}
  \label{ActivationCode}
  \textbf{Description} The activation code to use.
\item \textbf{2201} \textbf{Type} string \textbf{Name} PhoneNumber
                 \textbf{Default~value} - \\
  \index{PhoneNumber, Parameter}
  \index{2201, ParamID}
  \label{PhoneNumber}
  \textbf{Description} The user's phone number.
\item \textbf{2202} \textbf{Type} uint32 \textbf{Name} TopRegionID
                 \textbf{Default~value} - \\
  \index{TopRegionID, Parameter}
  \index{2202, ParamID}
  \label{upgrade_req:TopRegionID}
  \textbf{Description} The selected top region id in client. Not used.
\item \textbf{2203} \textbf{Type} string \textbf{Name} Email
                 \textbf{Default~value} - \\
  \index{Email, Parameter}
  \index{2203, ParamID}
  \label{Email}
  \textbf{Description} The user's email address.
\item \textbf{2204} \textbf{Type} string \textbf{Name} Name
                 \textbf{Default~value} - \\
  \index{Name, Parameter}
  \index{2204, ParamID}
  \label{Name}
  \textbf{Description} The user's name.
\item \textbf{2205} \textbf{Type} string \textbf{Name} Options
                 \textbf{Default~value} - \\
  \index{Name, Parameter}
  \index{2205, ParamID}
  \label{Options}
  \textbf{Description} The options the user has checked. A semicolon 
  separated list of options selected. ``opt\_in\_prod\_info=1'' is ok to 
  send information in email to client.
\end{list}

Params 2200,2201 and 2202 is sent together and 2203 and 2204 is sent together.

\subsection{NAV\_UPGRADE\_REQ v.2}

In version 2 paramID 2202 is supported.


\subsection{NAV\_UPGRADE\_REPLY v.1}

Replies to a client whether the upgrade was approved, or if not what
was wrong with it.

If the status is ok and all boolean parameters in the message are set to 
true, the licence was approved.



\begin{list}{\textbf{ParamID}}{}
\item \textbf{2300} \textbf{Type} byte \textbf{Name} TopRegionOK
                 \textbf{Default~value} - \\
  \index{TopRegionOK, Parameter}
  \index{2300, ParamID}
  \label{TopRegionOK}
  \textbf{Description} If the selected TopRegion is ok.
\item \textbf{2301} \textbf{Type} byte \textbf{Name} ActivationCodeOK
                 \textbf{Default~value} - \\
  \index{ActivationCodeOK, Parameter}
  \index{2301, ParamID}
  \label{ActivationCodeOK}
  \textbf{Description} If the activation code is ok.
\item \textbf{2302} \textbf{Type} byte \textbf{Name} PhonenumberOK
                 \textbf{Default~value} - \\
  \index{phonenumberOK, Parameter}
  \index{2302, ParamID}
  \label{phonenumberOK}
  \textbf{Description} If the phone number is ok.
\item \textbf{2303} \textbf{Type} byte \textbf{Name} userWFType
                 \textbf{Default~value} - \\
  \index{userWFType, Parameter}
  \index{2303, ParamID}
  \label{userWFType}
  \textbf{Description} The WFST after the upgrade.
\item \textbf{2304} \textbf{Type} uint32 array \textbf{Name} CenterPoint
                 \textbf{Default~value} - \\
  \index{CenterPoint, Parameter}
  \index{2304, ParamID}
  \label{CenterPoint}
  \textbf{Description} The center point, lat, lon, for the user's regions, 
    and a scale.
\item \textbf{2305} \textbf{Type} byte \textbf{Name} EmailOK
                 \textbf{Default~value} - \\
  \index{EmailOK, Parameter}
  \index{2305, ParamID}
  \label{EmailOK}
  \textbf{Description} If the email address is ok.
\item \textbf{2306} \textbf{Type} byte \textbf{Name} NameOK
                 \textbf{Default~value} - \\
  \index{NameOK, Parameter}
  \index{2306, ParamID}
  \label{NameOK}
  \textbf{Description} If the name is ok.
\end{list}

\subsection{NAV\_UPGRADE\_REPLY v.2}

In version 2 a new requestspecific errorcode:
\begin{verbatim}
      /**
       * Some upgrade specific status codes.
       */
      enum UpgradeStatus {
         UPGRADE_MUST_CHOOSE_REGION      = 0xF1,
      };
\end{verbatim}


\subsection{NAV\_VECTOR\_MAP\_REQ v.1}

This packet is use to request a vector map chunk according to some
arcane, unknown standards.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{2400} \textbf{Type} string \textbf{Name} VectorMapRequest
                 \textbf{Default~value} - \\
  \index{VectorMapRequest, Parameter}
  \index{2400, ParamID}
  \label{VectorMapRequest}
  \textbf{Description} The Request string.
\end{list}


\subsection{NAV\_VECTOR\_MAP\_REPLY v.1}

This packet is use to deliver a vector map chunk from the server.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{2500} \textbf{Type} string \textbf{Name} VectorMapRequest
                 \textbf{Default~value} - \\
  \index{VectorMapRequest, Parameter}
  \index{2500, ParamID}
  \textbf{Description} The Request string.
\item \textbf{2501} \textbf{Type} byte array \textbf{Name} VectorMapData
                 \textbf{Default~value} - \\
  \index{VectorMapData, Parameter}
  \index{2501, ParamID}
  \label{VectorMapData}
  \textbf{Description} The reply data.
\end{list}


\subsection{NAV\_MULTI\_VECTOR\_MAP\_REQ v.1}

This request is for multiple vector maps from the server limited by total size.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{4600} \textbf{Type} uint32 \textbf{Name} Start offset
                 \textbf{Default~value} 0 \\
  \index{Start offset, Parameter}
  \index{4600, ParamID}
  \label{Start offset}
  \textbf{Description} Start offset.
\item \textbf{4601} \textbf{Type} uint32 \textbf{Name} Max size
                 \textbf{Default~value} 2048 \\
  \index{Max size, Parameter}
  \index{4601, ParamID}
  \label{Max size}
  \textbf{Description} Maximum number of bytes in reply.
\item \textbf{4602} \textbf{Type} byte array \textbf{Name} Request strings
                 \textbf{Default~value} - \\
  \index{Request strings, Parameter}
  \index{4602, ParamID}
  \label{Request strings}
  \textbf{Description} Zero terminated specstrings.
\end{list}


\subsection{NAV\_MULTI\_VECTOR\_MAP\_REPLY v.1}

This reply has multiple vector maps from the server.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{4700} \textbf{Type} byte array \textbf{Name} Data
                 \textbf{Default~value} - \\
  \index{Data, Parameter}
  \index{4700, ParamID}
  \textbf{Description} Blob of data.
\end{list}


\subsection{NAV\_BINARY\_TRANSFER\_REQ v.1}

Request to transfer some data from client and get it at the server end.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{2600} \textbf{Type} byte \textbf{Name} Save as
                 \textbf{Default~value} - \\
  \index{Save as, Parameter}
  \index{2600, ParamID}
  \label{Save as}
  \textbf{Description} 0 print. 1 save as file. 2 save over socket.
\item \textbf{2601} \textbf{Type} string \textbf{Name} Filename
                 \textbf{Default~value} - \\
  \index{Filename, Parameter}
  \index{2601, ParamID}
  \label{Filename}
  \textbf{Description} The save-as file name.
\item \textbf{2602} \textbf{Type} string \textbf{Name} Hostname
                 \textbf{Default~value} - \\
  \index{Hostname, Parameter}
  \index{2602, ParamID}
  \label{Hostname}
  \textbf{Description} The host:port to connect to.
\item \textbf{2603} \textbf{Type} byte array \textbf{Name} Data
                 \textbf{Default~value} - \\
  \index{Data, Parameter}
  \index{2603, ParamID}
  \textbf{Description} The stuff to save. If more than one
  parameter is present the ones following the first must be
  appended to the first byte array.
\end{list}
 

\subsection{NAV\_BINARY\_TRANSFER\_REPLY v.1}

Reply to transfer some data to client.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{2700} \textbf{Type} byte \textbf{Name} Destination
                 \textbf{Default~value} - \\
  \index{Destination, Parameter}
  \index{2700, ParamID}
  \label{binary_rep:Destination}
  \textbf{Description} 0 send this reply to GUI.
\item \textbf{2701} \textbf{Type} byte array \textbf{Name} Data
                 \textbf{Default~value} - \\
  \index{Data, Parameter}
  \index{2701, ParamID}
  \label{binary_rep:Data}
  \textbf{Description} The stuff.
\end{list}


\subsection{NAV\_NOP\_REQ v.1}

Request that does nothing. Only global parameters are handled.


\subsection{NAV\_NOP\_REPLY v.1}

Reply that contains nothing but global parameters.


\subsection{NAV\_TOP\_REGION\_REQ v.1}

This request must contain a TopRegionChecksum parameter, see Section 
\ref{TopRegionChecksum}, and a Language of client, see Section 
\ref{LanguageClient}, parameter.


\subsection{NAV\_TOP\_REGION\_REPLY v.1}

Reply with a top region list. The reply must contain a TopRegionChecksum 
parameter along with the TopRegionData parameter.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{3100} \textbf{Type} byte array \textbf{Name} TopRegionData
                 \textbf{Default~value} - \\
\index{TopRegionData, Parameter}
\index{3100, ParamID}
  \textbf{Description} A top region list. Consists of a number of top 
  regions

  \begin{tabular}{|l|l|p{60mm}|}
    \hline
    Name   & Size(Bytes) & Description \\\hline
    ID     & 4           & Top region id. \\\hline
    Type   & 1           & Top region type country = 0, state = 1,
                           internationalRegion = 2, metaregion = 3.\\\hline
    Name   & String      & Name of Top region. \\\hline
  \end{tabular}
\end{list}


\subsection{NAV\_LATEST\_NEWS\_REQ v.1}

This request must contain a Latest news crc parameter, see Section 
\ref{Latest news crc}, and a Language of client, see Section 
\ref{LanguageClient}, parameter..


\subsection{NAV\_LATEST\_NEWS\_REPLY v.1}

Reply with the latest news data. The reply must contain a Latest news crc
parameter. In this version the latest news data is an image.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{3300} \textbf{Type} byte array \textbf{Name} Latest news data
                 \textbf{Default~value} - \\
  \index{Latest news data, Parameter}
  \index{3300, ParamID}
  \label{Latest news data}
  \textbf{Description} A byte array with the latest news data.
\end{list}


\subsection{NAV\_CATEGORIES\_REQ v.1}

This request must contain a Categories crc parameter, see Section 
\ref{Categories crc}, and a Language of client, see Section 
\ref{LanguageClient}, parameter.

\subsection{NAV\_CATEGORIES\_REQ v.2}

This version of the request may also include a position parameter which the
server may use to get a specific category list for the client's area. See
description of parameter 4308 in Section \ref{Category position}.

\subsection{NAV\_CATEGORIES\_REPLY v.1}

Reply with the Categories data. The reply must contain a Categories crc
parameter.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{3500} \textbf{Type} byte array \textbf{Name} Categories data
                 \textbf{Default~value} - \\
\index{Categories data, Parameter}
\index{3500, ParamID}
  \textbf{Description} A list of categories pairs.

  \begin{tabular}{|l|l|p{50mm}|}
    \hline
    Name               & Size(Bytes) & Description               \\\hline
    Category name      & String      & String to send to server. \\\hline
    User friendly name & String      & Name to show user.        \\\hline
  \end{tabular}
\end{list}

\subsection{NAV\_CATEGORIES\_REPLY v.2}
\begin{list}{\textbf{ParamID}}{}
\item \textbf{3501} \textbf{Type} byte array \textbf{Name} filenames data
                 \textbf{Default~value} - \\
\index{Categories data, Parameter}
\index{3501, ParamID}
  \textbf{Description} A list of filenames.

  \begin{tabular}{|l|l|p{50mm}|}
    \hline
    Name               & Size(Bytes) & Description               \\\hline
    filenames          & String      & filenames without file type ending. \\\hline
  \end{tabular}
\index{3502, ParamID}
  \textbf{Description} A list of category ids.

  \begin{tabular}{|l|l|p{50mm}|}
    \hline
    Name               & Size(Bytes) & Description               \\\hline
    category id          & 2      & category id as unsigned short. 0xFFFF indicates
    invalid category id. \\\hline
  \end{tabular}
\end{list}


\subsection{NAV\_CALLCENTER\_LIST\_REQ v.1}

This request must contain a CallCenter Checksum parameter, see Section 
\ref{CallCenter Checksum}, and a Language of client, see Section 
\ref{LanguageClient}, parameter.


\subsection{NAV\_CALLCENTER\_LIST\_REPLY v.1}

Reply with the CallCenter list. The reply must contain a CallCenter Checksum 
parameter.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{3700} \textbf{Type} string \textbf{Name} CallCenter list
                 \textbf{Default~value} - \\
  \index{CallCenter list, Parameter}
  \index{3700, ParamID}
  \textbf{Description} A string with the call center phone numbers and names. 
  Format:
\begin{verbatim}
<callcenter-list> := 
                <callcenter> [, <callcenter-list> ]
<callcenter> := <number> ; <name>
\end{verbatim}
\end{list}


\subsection{NAV\_SERVER\_LIST\_REQ v.1}

This request must contain a Server List Checksum parameter, see Section 
\ref{Server List Checksum}.


\subsection{NAV\_SERVER\_LIST\_REPLY v.1}

Reply with the Server List. The reply must contain a Server List Checksum
parameter.

\begin{list}{\textbf{ParamID}}{}
  \item \textbf{3900} \textbf{Type} string \textbf{Name}  Server List
                 \textbf{Default~value} - \\
  \index{Server List, Parameter}
  \index{3900, ParamID}
  \textbf{Description} A string with the Server List. 
  Must always be accompanied by a Server List Checksum parameter.
  Format:
\begin{verbatim}
<AlternativeServersList> := <ServerGroupList>
<ServerGroupList> := <ServerList> [ ; <ServerList> ]
<ServerList> := <Server> [ , <Server> ]
<Server> := <FQDN> : <port>
\end{verbatim}
\end{list}


\subsection{NAV\_NEW\_PASSWORD\_REQ v.1}

\begin{list}{\textbf{ParamID}}{}
\item \textbf{4000} \textbf{Type} string \textbf{Name} New password
                 \textbf{Default~value} - \\
  \index{New password, Parameter}
  \index{4000, ParamID}
  \label{New password}
  \textbf{Description} String parameter sent from client that wants to set 
  the password of the user.
\end{list}


\subsection{NAV\_NEW\_PASSWORD\_REPLY v.1}

Reply with User Password parameter, see Section \ref{User Password}.


% The server info parameters
\input{serverdataparams}


\subsection{NAV\_WHOAMI\_REQ v.1}
\label{NAV_WHOAMI_REQ}

Sent from client when it doesn't have any User (ID | Login | UIN) and wants to
check with the server if there is any user associated with this phone.
The server returns the User Login and User UIN for the user already associated 
with the phone. If no user is associated with the phone the server may create
a new user for it and return the User Login, User UIN, and User Password.

The client must send User Licence (key), Section \ref{User Licence (key)},
to identify phone. Also Client type is needed when creating a new user.

See also Section \ref{Authentication of client} about when this request 
is handled in authorization.

If no user is associated with the phone then a new user is created if:

\begin{itemize}
\item The user(s) with the Licence Key is looked up and:
  \begin{enumerate}
  \item No users found with the Licence Key and \\
    ClientType is MODII and client WFST is TRIAL or
    ClientType is MODI and client WFST is TRIAL or SILVER \\
    a new user is created with
    random logonID and Password, Licence Key is added to user, 
    WFST set to TRIAL, add region access with the CreateRegionID
    and CreateTime for the ClientType.
    If ClientType has CreateTransactionDays user is set to transaction
    days based and CreateTransactionDays nbr days added to user.
    UIN, logonID and Password returned to client.
  \item One(1) user found with the Licence Key the User Login and User UIN is
    returned to client.
  \item Two or more (2+) users found with the same Licence Key. 
    Return error to client.
  \end{enumerate}
\end{itemize}


\subsection{NAV\_WHOAMI\_REPLY v.1}

Reply with status and possibly User parameters.

\subsection{NAV\_TRACK\_REQ v.1}
\label{NAV_TRACK_REQ}

Request with a list of coordinates to store in server. Also PIN(s) to
allow access to the stored coordinates.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{5200} \textbf{Type} byte array \textbf{Name} TrackPoints
                 \textbf{Default~value} - \\
  \index{TrackPoints, Parameter}
  \index{5200, ParamID}
  \label{TrackPoints}
  \textbf{Description} One or more TrackPoint(s) with the following content. 
                       Multiple 5200 TrackPoints params may be sent.\\
  \begin{tabular}{|l|l|p{60mm}|}
    \hline
    Name   & Size(Bytes) & Description \\\hline
    lat    & 4           & Latitude. \\\hline
    lon    & 4           & Longitude.\\\hline
    dist   & 4           & Distance from last TrackPoint in 
                           centimetres.\\\hline
    speed  & 2           & Speed in m/s * 32. \\\hline
    heading& 2           & Heading. \\\hline
    time   & 4           & Time when Track point was made. If < 100000000 then
                           used as time before now. \\\hline
    comment& String      & String with extra info. \\\hline
  \end{tabular}
\item \textbf{5201} \textbf{Type} uint32 array \textbf{Name} PINIDSync
                 \textbf{Default~value} - \\
  \index{PINIDSync, Parameter}
  \index{5201, ParamID}
  \label{PINIDSync}
  \textbf{Description} PIN IDs to sync. IDs of PINs that the client has.
\item \textbf{5202} \textbf{Type} uint32 array \textbf{Name} PINIDDel
                 \textbf{Default~value} - \\
  \index{PINIDDel, Parameter}
  \index{5202, ParamID}
  \label{track_req:PINIDDel}
  \textbf{Description} PIN IDs to delete. IDs of PINs that the client has 
                       deleted.
\item \textbf{5203} \textbf{Type} byte array \textbf{Name} PINAdd
                 \textbf{Default~value} - \\
  \index{PINAdd, Parameter}
  \index{5203, ParamID}
  \label{track_req:PINAdd}
  \textbf{Description} List of PINs to add. See below for declaration of PIN.\\
  \begin{tabular}{|l|l|p{60mm}|}
    \hline
    Name    & Size(Bytes) & Description \\\hline
    ID      & 4           & The ID. \\\hline
    PIN     & String      & PIN as string. \\\hline
    Comment & String      & Comment about PIN. \\\hline
  \end{tabular}
\item \textbf{5204} \textbf{Type} uint32 \textbf{Name} PINCRC
                 \textbf{Default~value} - \\
  \index{PINCRC, Parameter}
  \index{5204, ParamID}
  \label{track_req:PINCRC}
  \textbf{Description} The CRC for the PINs.
\item \textbf{5205} \textbf{Type} String \textbf{Name} TrackReq
                 \textbf{Default~value} - \\
  \index{TrackReq, Parameter}
  \index{5205, ParamID}
  \label{TrackReq}
  \textbf{Description} The track\_data value string to get position for.
\item \textbf{5206} \textbf{Type} uint32*3 \textbf{Name} TrackReqSetting
                 \textbf{Default~value} - \\
  \index{TrackReqSetting, Parameter}
  \index{5206, ParamID}
  \label{TrackReqSetting}
  \textbf{Description} Settings for TrackReq. First an uint32 that is the
                       maximum number of positions to return. Default 1.
                       Then startTime in UTC, default 0.
                       Then enTime in UTC, default MAX\_UINT32.
\end{list}



\subsection{NAV\_TRACK\_REPLY v.1}
\label{NAV_TRACK_REPLY}

Reply with status.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{5302} \textbf{Type} uint32 array \textbf{Name} PINIDDel
                 \textbf{Default~value} - \\
  \index{PINIDDel, Parameter}
  \index{5302, ParamID}
  \label{track_rep:PINIDDel}
  \textbf{Description} PIN IDs to delete. IDs of PINs that the client has 
                       to delete.
\item \textbf{5303} \textbf{Type} byte array \textbf{Name} PINAdd
                 \textbf{Default~value} - \\
  \index{PINAdd, Parameter}
  \index{5303, ParamID}
  \label{track_rep:PINAdd}
  \textbf{Description} List of PINs to add.
\item \textbf{5304} \textbf{Type} uint32 \textbf{Name} PINCRC
                 \textbf{Default~value} - \\
  \index{PINCRC, Parameter}
  \index{5304, ParamID}
  \label{track_rep:PINCRC}
  \textbf{Description} The CRC for the PINs.
\item \textbf{5305} \textbf{Type} uint32 \textbf{Name} TrackReply
                 \textbf{Default~value} - \\
  \index{TrackReply, Parameter}
  \index{5305, ParamID}
  \label{TrackReply}
  \textbf{Description} The list of matched positions for the request in 5205.
                       Is a list of TrackPoint(s) as defined in 5200.
\end{list}

\subsection{NAV\_TUNNEL\_DATA\_REQ v.1}
\label{NAV_TUNNEL_DATA_REQ}

Request to the server including data transfer. The request is then answered
with appropriate data. Used for tunneling data over Nav2.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{5400} \textbf{Type} byte array \textbf{Name} Destination
                 \textbf{Default~value} - \\
  \index{Destination, Parameter}
  \index{5400, ParamID}
  \label{tunnel_req:Destination}
  \textbf{Description} \\
  \begin{tabular}{|l|l|p{60mm}|}
    \hline
    Name    & Size(Bytes) & Description \\\hline
    Type    & 4           & Type, 0 - content window data \\\hline
    URL     & String      & Target URL to download. \\\hline
  \end{tabular}
\item \textbf{5401} \textbf{Type} byte array \textbf{Name} Data
                 \textbf{Default~value} - \\
  \index{Data, Parameter}
  \index{5401, ParamID}
  \textbf{Description} The data.
\end{list}
 
\subsection{NAV\_TUNNEL\_DATA\_REPLY v.1}

Reply to transfer some data to client.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{5500} \textbf{Type} byte array \textbf{Name} Destination
                 \textbf{Default~value} - \\
  \index{Destination, Parameter}
  \index{5500, ParamID}
  \label{tunnel_rep:Destination}
  \textbf{Description} \\
  \begin{tabular}{|l|l|p{60mm}|}
    \hline
    Name    & Size(Bytes) & Description \\\hline
    Type    & 4           & Type, 0 - content window data \\\hline
    URL     & String      & URL of download (same as in request, used as id). \\ \hline
  \end{tabular}
\item \textbf{5501} \textbf{Type} byte array \textbf{Name} Data
                 \textbf{Default~value} - \\
  \index{Data, Parameter}
  \index{5501, ParamID}
  \label{tunnel_rep:Data}
  \textbf{Description} The data.
\end{list}

\subsection{NAV\_COMBINED\_SEARCH\_REQ v.1}
\label{NAV_COMBINED_SEARCH_REQ}

Request to the server for a combined search.
These params are used in this request but defined elsewhere.\\
1201 - Search area string \\
1202 - Search AreaID \\
1203 - Search item string \\
1204 - Search category string \\
1205 - TopRegionID \\
1000 - Search pos coord and angle\\
6 - LanguageClient


\begin{list}{\textbf{ParamID}}{}
\item \textbf{5600} \textbf{Type} Uint32 \textbf{Name} Start index
                 \textbf{Default~value} - \\
  \index{Start Index, Parameter}
  \index{5600, ParamID}
  \label{combined_search_req:Start_Index}
  \textbf{Description} The index of the first match in the reply.
\item \textbf{5601} \textbf{Type} Uint32 \textbf{Name} Round
                 \textbf{Default~value} - \\
  \index{Round, Parameter}
  \index{5601, ParamID}
  \label{combined_search_req:Round}
  \textbf{Description} The search round. First round \emph{0} is the fast 
  round, round \emph{1} is external search and slow.
\item \textbf{5602} \textbf{Type} Uint32 \textbf{Name} Heading
                 \textbf{Default~value} - \\
  \index{Heading, Parameter}
  \index{5602, ParamID}
  \label{combined_search_req:Heading}
  \textbf{Description} The specific heading, from previous reply, to search
  in. \emph{-1} means all headings.
\item \textbf{5603} \textbf{Type} uint32 \textbf{Name} Max Nbr Search Matches
                 \textbf{Default~value} - \\
  \index{Max Nbr Search Matches, Parameter}
  \index{5603, ParamID}
  \label{Max Nbr Search Matches Combined search}
  \textbf{Description} The reply full limit.
\item \textbf{5604} \textbf{Type} Uint32 \textbf{Name} Distance
                 \textbf{Default~value} - \\
  \index{Distance, Parameter}
  \index{5604, ParamID}
  \label{combined_search_req:Distance}
  \textbf{Description} The radius in meters from search position in param 1000.
\end{list}

\subsection{NAV\_COMBINED\_SEARCH\_REQ v.2}
Extended version 1 of this request with parameter 1209, which is a boolean.
This parameter determines if the category string ( param 1204 ) should be used for searching
for category names to search in. The search for matching category names is done
using the language specified. If this parameter is missing or is false, the
category string must be in english and must be the same as the one from the
category list.
\index{Find Category, Parameter}
\index{1209, ParamID}
There is also a new paramater, the category ID:
\begin{list}{\textbf{ParamID}}{}
\item \textbf{5605} \textbf{Type} Uint16 \textbf{Name} Category ID
                 \textbf{Default~value} - \\
  \index{Category ID, Parameter}
  \index{5605, ParamID}
  \label{combined_search_req:Category_ID}
  \textbf{Description} Category ID to use when searching, this is prefered over
  category name when using the category list to search.
\end{list}
This item must be used instead of the category name ( param 1204 ) when searching
for an exact category ( when selecting it from the list ).

\subsection{NAV\_COMBINED\_SEARCH\_REPLY v.1}

Reply to a combined search.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{5700} \textbf{Type} byte array \textbf{Name} Heading
                 \textbf{Default~value} - \\
  \index{Heading, Parameter}
  \index{5700, ParamID}
  \label{combined_search_rep:Heading}
  \textbf{Description} The first Heading with it's reply matches.
  First an uint32 with heading number, uint32 with type of list 0x0 then item 
  matches and 0x1 if area matches in the list, 
  then an uint32 with index of first match
  followed by an uint32 with total number of matches for the search.
  Then a list of matches. \\
  The item match structure is defined as:\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
    Function  & Size    & Description \\
              & (Bytes) &             \\\hline
    Type        & 1       & Search type.                          \\\hline
    Sub type    & 1       & Search sub type.                      \\\hline
    ID          & String  & MC2 internal id of this match.        \\\hline
    name        & String  & Name of this match.                   \\\hline
    image       & String  & Image for match.                      \\\hline
    lat         & 4       & Latitude of match.                    \\\hline
    lon         & 4       & Longitude of match.                   \\\hline
    Nbr regions & 1       & Number of regions for this match.     \\\hline
    Regions     & X       & Nbr regions region indexes into region table, each 
                            index is a short.                     \\\hline
  \end{tabular}\\
  The area matches are described in Section \ref{Area matches} with an image
  string after the name string.
\item \textbf{5701} \textbf{Type} byte array \textbf{Name} Match regions
                 \textbf{Default~value} - \\
  \index{Match regions, Parameter}
  \index{5701, ParamID}
  \label{Match regions}
  \textbf{Description} List of Search regions. The order of the Regions are
  their index matches. 
  The region structure is defined as in Section \ref{Search regions} except
  for Search location type which is 4 bytes as released clients erroneously
  implemented it so.
\end{list}
First heading is in param 5700, second heading is in 5702 and so on.
Then in 5701 is regions for 5700, in 5703 is regions for 5702 and so on.
Params 5700 to 5750 are reserved for heading replies.

\subsection{NAV\_COMBINED\_SEARCH\_REPLY v.2}
In version 2 of the reply,there is an uint32 after total number of matches in
the heading. This integer describes the number of top hits in the heading. 
After the top this integer there are two strings that describes what to show
above advertisement hits and above the rest of the results. The first string is
the string to show above advertisement and the second if for the rest of the
results.
In addition two these two strings there is a new parameter param 6000 that contains two strings for
the first heading view, i.e what to show above top hits advertisements and for
the rest of the results.

The item structure has a byte directly after the sub type, which has value
1 if the item is an advertisement hit.


\subsection{NAV\_SEARCH\_DESC\_REQ v.1}

This request must contain a Language of client, see Section 
\ref{LanguageClient}, parameter.

\subsection{NAV\_SEARCH\_DESC\_REQ v.2}

With this version of the request a localized description of the type of search hit is included in the reply.

\subsection{NAV\_SEARCH\_DESC\_REPLY v.1}

Reply with combined search description. The reply must contain a crc 
parameter, paramID 28, along with the SearchHitType parameter.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{5900} \textbf{Type} byte array \textbf{Name} SearchHitType
                 \textbf{Default~value} - \\
\index{SearchHitType, Parameter}
\index{5900, ParamID}
  \textbf{Description} A Search Hit type list. Consists of a number of Search
  Hit Types. \\
  \begin{tabular}{|l|l|p{60mm}|}
    \hline
    Name      & Size(Bytes) & Description \\\hline
    Round     & 4           & What round hit belongs too. \\\hline
    Heading   & 4           & What heading number if is. \\\hline
    Name      & String      & Name of search hit type. \\\hline
    TopRegionID& 4          & TopRegionID of search hit type, MAX\_UINT32 if 
                              none. \\\hline
    ImageName & String      & Name of image for the search hit type. \\\hline
  \end{tabular}
\end{list}

\subsection{NAV\_SEARCH\_DESC\_REPLY v.2}

Unlike v.1 this reply also includes a localized description of the type of each search hit. A search hit is thus represented as:

\begin{tabular}{|l|l|p{60mm}|}
  \hline
  Name      & Size(Bytes) & Description \\\hline
  Round     & 4           & What round hit belongs too. \\\hline
  Heading   & 4           & What heading number if is. \\\hline
  Name      & String      & Name of search hit type. \\\hline
  Type      & String      & The type of search hit, localized. \\\hline
  TopRegionID& 4          & TopRegionID of search hit type, MAX\_UINT32 if 
                            none. \\\hline
  ImageName & String      & Name of image for the search hit type. \\\hline
\end{tabular}


\subsection{NAV\_CELLID\_LOOKUP\_REQ v.1}

For all networks the following parameters exists:
\begin{list}{\textbf{ParamID}}{}
\item \textbf{6200} \textbf{Type} String \textbf{Name} NetworkType
                 \textbf{Default~value} - \\
\index{NetworkType, Parameter}
\index{6200, ParamID}
  \textbf{Description} The type of network, possible values are defined per 
  network.
\item \textbf{6201} \textbf{Type} String \textbf{Name} SignalStrength
                 \textbf{Default~value} - \\
\index{SignalStrength, Parameter}
\index{6201, ParamID}
  \textbf{Description} The signal strength to the cell.
\end{list}

For GSM (3GPP) networks the NetworkType can be either GPRS or UMTS and
the following paramters are used:
\begin{list}{\textbf{ParamID}}{}
\item \textbf{6202} \textbf{Type} String \textbf{Name} CurrentMCC
                 \textbf{Default~value} - \\
\index{CurrentMCC, Parameter}
\index{6202, ParamID}
  \textbf{Description} The Mobile Country Code that the cell is in.
\item \textbf{6203} \textbf{Type} String \textbf{Name} CurrentMNC
                 \textbf{Default~value} - \\
\index{CurrentMNC, Parameter}
\index{6203, ParamID}
  \textbf{Description} The Mobile Network Code that the cell is in.
\item \textbf{6204} \textbf{Type} String \textbf{Name} CurrentLAC
                 \textbf{Default~value} - \\
\index{CurrentLAC, Parameter}
\index{6204, ParamID}
  \textbf{Description} The Local Area Code that the cell is in.
\item \textbf{6205} \textbf{Type} String \textbf{Name} CellID
                 \textbf{Default~value} - \\
\index{CellID, Parameter}
\index{6205, ParamID}
  \textbf{Description} The identification of the CellID.
\end{list}

For CDMA networks the NetworkType can be either CDMA or EVDO and
the following paramters are used
\begin{list}{\textbf{ParamID}}{}
\item \textbf{6206} \textbf{Type} String \textbf{Name} CurrentSID
                 \textbf{Default~value} - \\
\index{CurrentSID, Parameter}
\index{6206, ParamID}
  \textbf{Description} The sid.
\item \textbf{6207} \textbf{Type} String \textbf{Name} CurrentNID
                 \textbf{Default~value} - \\
\index{CurrentNID, Parameter}
\index{6207, ParamID}
  \textbf{Description} The nid.
\item \textbf{6208} \textbf{Type} String \textbf{Name} CurrentBID
                 \textbf{Default~value} - \\
\index{CurrentBID, Parameter}
\index{6208, ParamID}
  \textbf{Description} The bid.
\end{list}

For iDEN networks there are the following parameters:
\begin{list}{\textbf{ParamID}}{}
\item \textbf{6209} \textbf{Type} String \textbf{Name} CurrentMCC
                 \textbf{Default~value} - \\
\index{CurrentMCC, Parameter}
\index{6209, ParamID}
  \textbf{Description} The MCC.
\item \textbf{6210} \textbf{Type} String \textbf{Name} CurrentDNC
                 \textbf{Default~value} - \\
\index{CurrentDNC, Parameter}
\index{6210, ParamID}
  \textbf{Description} The dnc.
\item \textbf{6211} \textbf{Type} String \textbf{Name} CurrentSA\_ID
                 \textbf{Default~value} - \\
\index{CurrentSA\_ID, Parameter}
\index{6211, ParamID}
  \textbf{Description} The sa\_id.
\item \textbf{6212} \textbf{Type} String \textbf{Name} CurrentLLA\_ID
                 \textbf{Default~value} - \\
\index{CurrentLLA\_ID, Parameter}
\index{6212, ParamID}
  \textbf{Description} The lla\_id.
\item \textbf{6213} \textbf{Type} String \textbf{Name} CurrentCELL\_ID
                 \textbf{Default~value} - \\
\index{CurrentCELL\_ID, Parameter}
\index{6213, ParamID}
  \textbf{Description} The cell\_id.
\end{list}

\subsection{NAV\_CELLID\_LOOKUP\_REPLY v.1}

Reply with position of mobile cell. 

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6300} \textbf{Type} int32,int32 \textbf{Name} CellCoordinate
                 \textbf{Default~value} - \\
\index{CellCoordinate, Parameter}
\index{6300, ParamID}
  \textbf{Description} The position of the cell.
\item \textbf{6301} \textbf{Type} int32 \textbf{Name} Altitude
                 \textbf{Default~value} - \\
\index{Altitude, Parameter}
\index{6301, ParamID}
  \textbf{Description} The altitude of the cell in meters.
\item \textbf{6302} \textbf{Type} uint32 \textbf{Name} CellInnerRadius
                 \textbf{Default~value} - \\
\index{CellInnerRadius, Parameter}
\index{6302, ParamID}
  \textbf{Description} The inner radius of the cell in meters.
\item \textbf{6303} \textbf{Type} uint32 \textbf{Name} CellOuterRadius
                 \textbf{Default~value} - \\
\index{CellOuterRadius, Parameter}
\index{6303, ParamID}
  \textbf{Description} The outer radius of the cell in meters.
\item \textbf{6304} \textbf{Type} uint16 \textbf{Name} StartAngle
                 \textbf{Default~value} - \\
\index{StartAngle, Parameter}
\index{6304, ParamID}
  \textbf{Description} The start angle in 360 clockwise degrees, 
  with north at 0-degrees.
\item \textbf{6305} \textbf{Type} uint16 \textbf{Name} EndAngle
                 \textbf{Default~value} - \\
\index{EndAngle, Parameter}
\index{6305, ParamID}
  \textbf{Description} The end angle in 360 clockwise degrees, 
  with north at 0-degrees.
\item \textbf{6306} \textbf{Type} uint32 \textbf{Name} TopRegionID
                 \textbf{Default~value} - \\
\index{TopRegionID, Parameter}
\index{6306, ParamID}
  \textbf{Description} The top region id of the cell.
\end{list}

\subsection{NAV\_GET\_KEYED\_DATA\_REQ v.1}

This request allows a client to get generic data associated with a key. The
client may also supply a language to get a language specific version of the 
data if available, see Section \ref{LanguageClient}. If the client has made 
the request before, it should send the CRC which it received from the server, 
to avoid downloading the same data again if it hasn't changed.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6100} \textbf{Type} string \textbf{Name} Key
                 \textbf{Default~value} - \\
\index{Key, Parameter}
\index{6100, ParamID}
  \textbf{Description} The key to get data for.
\item \textbf{6101} \textbf{Type} uint32 \textbf{Name} Keyed Data CRC
                 \textbf{Default~value} - \\
\index{Keyed Data CRC, Parameter}
\index{6101, ParamID}
  \textbf{Description} The CRC, optional.
\end{list}

\subsection{NAV\_GET\_KEYED\_DATA\_REPLY v.1}

If the request didn't include a CRC, or the CRC didn't match, the reply
includes the data and a new CRC. If the CRC matched, these parameters are
simply omitted. The CRC is sent in parameter 6101, as in the request.
The data is sent in parameter 6102 which can be sent multiple times if the
data is too large for a single parameter.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6102} \textbf{Type} byte array \textbf{Name} Keyed Data
                 \textbf{Default~value} - \\
\index{Keyed Data, Parameter}
\index{6102, ParamID}
  \textbf{Description} The data associated with the requested key.
\end{list}

\subsection{NAV\_VERIFY\_THIRD\_PARTY\_TRANSACTION\_REQ v.1}

This request allows a client to verify a third party purchase through the
server so that the server can add the corresponding rights, if verified.
The string supplied in the request corresponds to the transaction id or 
receipt from the transaction. For iPhone client types, the verification string
corresponds to the App Store transaction id.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6400} \textbf{Type} string \textbf{Name} Verification String
                 \textbf{Default~value} - \\
\index{Verification String, Parameter}
\index{6400, ParamID}
  \textbf{Description} The verification string, i.e. transaction id or receipt.
\item \textbf{6401} \textbf{Type} string \textbf{Name} Error Data Selection String
                 \textbf{Default~value} - \\
\index{Error Data Selection String, Parameter}
\index{6401, ParamID}
  \textbf{Description} What the user selected from the paramID 33 data.
  The string is formatted as "<error data type>;<error data value>". Where
  the \emph{error data type} is the same as in paramID 33 and
  the \emph{error data value} is the value selected from the comma separated
  \emph{error data value} list in paramID 33.
\end{list}

\subsection{NAV\_VERIFY\_THIRD\_PARTY\_TRANSACTION\_REPLY v.1}

The reply contains the status of the operation. The client might need to
do a server info in order to update top regions and similar if succesful.

\subsection{NAV\_LOCAL\_CATEGORY\_TREE\_REQ v.1}

Request to get the category tree for the specified location. This request 
contains a Category tree crc parameter, a Language of client parameter 
(ParamID 6), see Section \ref{LanguageClient} for description, 
a Category tree version parameter, and a position parameter which the
server use to get a specific category tree for the client's area. See 
description of parameter 4308 in Section \ref{Category position}.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6500} \textbf{Type} string \textbf{Name} Category tree crc
                 \textbf{Default~value} - \\
\index{Category tree crc, Parameter}
\index{6500, ParamID}
  \textbf{Description} The crc from a previous NAV\_LOCAL\_CATEGORY\_REPLY. Send 
empty attribute if no crc is available.

\item \textbf{6501} \textbf{Type} uint16 \textbf{Name} category tree version
                 \textbf{Default~value} - \\
\index{version, Parameter}
\index{6501, ParamID}
  \textbf{Description} The version format to use in the NAV\_LOCAL\_CATEGORY\_REPLY.

\end{list}

\subsection{NAV\_LOCAL\_CATEGORY\_TREE\_REPLY v.1}

Reply with the Category tree for the specified location. The reply has an 
optional Categories crc parameter that is set if the request succeedes.
The category tree data is sent in the category table, lookup table and string 
table parameters. The parqameter crcOK indicates that no new category tree 
existed at the server, in this case no category tree data is sent in the reply.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6502} \textbf{Type} byte array \textbf{Name} category table
                 \textbf{Default~value} - \\
\index{category table, Parameter}
\index{6502, ParamID}
  \textbf{Description} Contains information about categories (sub categories, 
offset of name and icon in the string table).

\item \textbf{6503} \textbf{Type} byte array \textbf{Name} lookup table
                 \textbf{Default~value} - \\
\index{lookup table, Parameter}
\index{6503, ParamID}
  \textbf{Description} Used to get the byte offset of a category in the category 
table.

\item \textbf{6504} \textbf{Type} byte array \textbf{Name} string table
                 \textbf{Default~value} - \\
\index{string table, Parameter}
\index{6504, ParamID}
  \textbf{Description} Contains category names and icon names.

\item \textbf{6505} \textbf{Type} bool \textbf{Name} crcOK
                 \textbf{Default~value} - \\
\index{crcOK, Parameter}
\index{6505, ParamID}
  \textbf{Description} True if the crc sent in the requst equals the latest
category tree at the server. If this parameter is true no new category tree 
is sent in the reply.

\end{list}

\input{category_tree_bin_format}



\subsection{NAV\_DETAIL\_REQ v.1}

A request for additional details about items, sent
from client to server. A simplified version of NAV\_INFO\_REQ.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{7000} \textbf{Type} string \textbf{Name} DetailItemID
                 \textbf{Default~value} - \\
  \index{DetailItemID, Parameter}
  \index{7000, ParamID}
  \label{DetailItemID}
  \textbf{Description} The string is Search item id.
\end{list}

\subsection{NAV\_DETAIL\_REQ v.2}

No change in the request, only in the reply.


\subsection{NAV\_DETAIL\_REPLY v.1}

A reply to an detail request, sent from the server
to the client. 
\begin{list}{\textbf{ParamID}}{}
\item \textbf{7100} \textbf{Type} byte array \textbf{Name} DetailItems
                 \textbf{Default~value} - \\
  \index{DetailItems, Parameter}
  \index{7100, ParamID}
  \label{DetailItems}
  \textbf{Description} List of DetailItems.\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
    \textbf{Function} & \textbf{Size}    & \textbf{Description} \\
             & \textbf{(Bytes)} & \\\hline
    Item ID  & string  & The MC2 internal id sent in the request.      \\\hline
    nbr tuples& 2      & The number of type-key-value tuples for this 
                         item.\\\hline
    type     & 2       & The type of information, see AdditionalDetailType 
                         for possible values.                          \\\hline
    content type & 1   & The content type of information, see \ref{additionaldetailcontentenum} 
                         for possible values. The field shall be handled as the 
                         specified content type.                       \\\hline
    Key      & string  & String to be presented as first value or key. \\\hline
    Value    & string  & String to be presented as second value.       \\\hline
  \end{tabular}
\end{list}

\label{additionaldetailenum}
AdditionalDetailType enumeration. Specifying the type of the detail item.
\begin{verbatim}
   /// Enum for the type of POI details
   enum AdditionalDetailType {
      dont_show      = 0x0000, 
      text           = 0x0001, 
      street_address = 0x0002, 
      full_address   = 0x0003,
      phone_number   = 0x0004,
      url            = 0x0005,
      email          = 0x0006,
      poi_url        = 0x0007,
      poi_thumb      = 0x0008,
      average_rating = 0x0009,
      description    = 0x000a,
      open_hours     = 0x000b,
      providor_info  = 0x000c,
   };
\end{verbatim}


\label{additionaldetailcontentenum}
AdditionalDetailContentType enumeration. Type for specifing the content type. 
Example: For a detail type called 'booking\_information' could be both phone
number, e-mail or url and the server can set the content type that is used.

\begin{verbatim}
       enum AdditionalDetailContentType {
         content_text          = 0x00,
         content_phone_number  = 0x01,
         content_url           = 0x02,
         content_email_address = 0x03,
         content_integer       = 0x04,
         content_float         = 0x05,
       }
\end{verbatim}

 

\subsection{NAV\_DETAIL\_REPLY v.2}

The following parameters may also be sent:

\begin{list}{\textbf{ParamID}}{}
\item \textbf{7101} \textbf{Type} byte array \textbf{Name} Images
                  \textbf{Optional} \\
  \index{Images, Parameter}
  \index{7101, ParamID}
  \textbf{Description} List of images.\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
  \textbf{Name} & \textbf{Type(Bytes)} & \textbf{Description} \\\hline
    providerNameIndex & int32(4)  & The index to the first byte in the string table for 
the null terminated string for the name of the provider of the images.      \\\hline
    providerImageIndex & int32(4)  & The index to the first byte in the string table for 
the null terminated string for the image of the provider of the images.      \\\hline
    nbrImageUrls& int16(2)       & The number of image urls from this provider.\\\hline
    url      & x*int32(4)  & NbrImageUrls * The index to the first byte in the string table for 
the null terminated string for the url of the image. The url can be used to fetch the image 
thru the MC2 server.                  \\\hline
  \end{tabular}

\item \textbf{7102} \textbf{Type} byte array \textbf{Name} Reviews
                  \textbf{Optional} \\
  \index{Reviews, Parameter}
  \index{7102, ParamID}
  \textbf{Description} List of reviews.\\
  \begin{tabular}{|l|c|p{7cm}|}
    \hline
  \textbf{Name} & \textbf{Type(Bytes)} & \textbf{Description} \\\hline
    providerNameIndex & int32(4)  & The index to the first byte in the string table for 
the null terminated string for the name of the provider of the reviews.      \\\hline
    providerImageIndex & int32(4)  & The index to the first byte in the string table for 
the null terminated string for the image of the provider of the reviews.      \\\hline
    nbrReviews& int16(2)       & The number of reviews from this provider.\\\hline
    review    & x*13  & NbrReviews reviews. See review format below.   \\\hline
  \end{tabular}

\item \textbf{7103} \textbf{Type} byte array \textbf{Name} String table
                  \textbf{Optional} \\
  \index{String table, Parameter}
  \index{7103, ParamID}
  \textbf{Description} The string data.

\end{list}

The \emph{review} format:\\
\begin{tabular}{|l|l|p{60mm}|}
  \hline
  \textbf{Name} & \textbf{Type} & \textbf{Description} \\
                & \textbf{(size)} & \\\hline
    rating    & int8 (1)  & The rating in this review.                   \\\hline
    dateIndex      & int32 (4) & The index to the first byte in the string table for 
the null terminated string for the date of this review.              \\\hline
    reviewerIndex  & int32 (4) & The index to the first byte in the string table for 
the null terminated string for the user who wrote the review.                \\\hline
    reviewIndex    & int32 (4)  & The index to the first byte in the string table for 
the null terminated string for the review text.                         \\\hline

\end{tabular}

\section{One Search}

The One Search main feature is that it has one list of reply matches.\\
NOTE: This request uses coordinates in MC2 format.

\subsection{Search Match}
\index{Search Match, Item}
\label{SearchMatch}

\begin{tabular}{|l|l|p{60mm}|}
  \hline
  \textbf{Name} & \textbf{Type(Bytes)} & \textbf{Description} \\\hline
  nameIndex & int32(4)    & The index to the first byte in the string 
                            table for the null terminated string for name
                            of the match. \\\hline
  idIndex   & int32(4)    & The index to the first byte in the string 
                            table for the the null terminated string for id
                            of the match. \\\hline
  locationIndex & int32(4)& The index to the first byte in the string 
                            table for the for the the null terminated string 
                            for location name of the match. \\\hline
  latitude  & int32(4)    & Latitude (MC2 format) of the match, MAX\_INT32 if none. \\\hline
  longitude & int32(4)    & Longitude (MC2 format) of the match, MAX\_INT32 if none.\\\hline
  type      & int8(1)     & Type of search match see, SearchItemType 
                            enumeration. \\\hline
  subType   & int16(2)    & Sub type of search match, only set if type is poi, 
                            see SearchItemSubType enumeration. \\\hline
  categoryImageIndex & int32(4) & The index to the first byte in the string 
                            table for the the null terminated string for the 
                            category image name of the match, 
                            name does not include file extension. \\\hline
  providerImageIndex & int32(4) & The index to the first byte in the string 
                            table for the the null terminated string for the
                            provider image name of the match, 
                            name does not include file extension. \\\hline
  brandImageIndex & int32(4) & The index to the first byte in the string 
                            table for the the null terminated string for the
                            brand image name of the match, 
                            name does not include file extension. \\\hline
  flags & int8(1)  & LSB is set when additional information about the match exists.
  Other bits are reserved for future use. \\\hline
  nbrCategories & int8(1) & Number of category ids for this match. \\\hline
\end{tabular}
\ \\
\begin{tabular}{|l|l|p{60mm}|} % Had to break the table up
  \hline
  nbrAreas & int8(1)    & Number of areas for this match. \\\hline
  nbrDetailItems & int8(1)  & Number of detail items for this match. \\\hline
  categoryIDs  & X*int32(X*4) & Nbr categories categoryIDs. \\\hline
  areaIndexes & Y*int32(Y*4) & Nbr areas indexes into area table,
                                 each index is to the first byte of the 
                                 area. \\\hline
  detailItemIndexes & Z*int32(Z*4) & NbrDetailItems indexes into detailItem table,
                                   each index is to the first byte of the 
                                   detailItem. \\\hline
\end{tabular}


\subsection{Detail Item}
\index{Detail Item, Item}
\label{DetailItem}

The \emph{DetailItem}s format: \\
\begin{tabular}{|l|l|p{70mm}|}
  \hline
  \textbf{Name} & \textbf{Type(Bytes)} & \textbf{Description} \\\hline
  type      & int16(2)     & The type of information, see section
                            \ref{additionaldetailenum}, AdditionalDetailType, 
                            for possible values.
                            \\\hline
  content type & int8(1)   & The content type of information, see section 
                             \ref{additionaldetailcontentenum}, 
                             AdditionalDetailContentType, 
                             for possible values. The field shall be handled 
                             as the specified content type.
                             \\\hline
  keyIndex  & int32(4)     & The index to the first byte in the string 
                            table for the the null terminated string for the 
                            key name of the information. \\\hline

  valueIndex & int32(4)    & The index to the first byte in the string 
                             table for the the null terminated string for
                             the value name of the information.
                             \\\hline
\end{tabular}

\subsection{Area}
\index{Area, Item}
\label{Area}

The \emph{area} format: \\
\begin{tabular}{|l|l|p{60mm}|}
  \hline
  \textbf{Name} & \textbf{Type(Bytes)} & \textbf{Description} \\\hline
  type      & int16(2)     & The type of area, see section
                            \ref{SearchLocationType} and \emph{Search location
                            type} for possible values. \\\hline
  nameIndex & int32(4)    & The index to the first byte in the string 
                            table for the the null terminated string for
                            the name of the area. \\\hline
  idIndex   & int32(4)     & The index to the first byte in the string 
                             table for the the null terminated string for the
                             id of the area.  \\\hline
\end{tabular}



\subsection{NAV\_ONE\_SEARCH\_REQ v.1}

This request must contain a \emph{Language of client}, see Section 
\ref{LanguageClient}, paramID 6.

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6800} \textbf{Type} String \textbf{Name} SearchMatchQuery
                 \textbf{Optional} \\
\index{SearchMatchQuery, Parameter}
\index{6800, ParamID}
  \textbf{Description} Text to find matches, if not sent or empty it is not
  used.

\item \textbf{6801} \textbf{Type} int32 array \textbf{Name} CategoryIDs
                 \textbf{Optional} \\
\index{CategoryIDs, Parameter}
\index{6801, ParamID}
  \textbf{Description} The categories to limit search to, not used if not sent
                       or empty.

\item \textbf{6802} \textbf{Type} int32,int32 \textbf{Name} SearchPosition
                 \textbf{Required} \\
\index{SearchPosition, Parameter}
\index{6802, ParamID}
  \textbf{Description} The position, in MC2 format, to find matches around.

\item \textbf{6803} \textbf{Type} int32 \textbf{Name} SearchRadius
                 \textbf{Optional} \\
\index{SearchRadius, Parameter}
\index{6803, ParamID}
  \textbf{Description} The maximum distance from the \emph{SearchPosition} to
  find matches at.

\item \textbf{6804} \textbf{Type} int32 \textbf{Name} MaxNumberMatches
                 \textbf{Required} \\
\index{MaxNumberMatches, Parameter}
\index{6804, ParamID}
  \textbf{Description} The maximum number of matches to return in reply.

\item \textbf{6805} \textbf{Type} int32 \textbf{Name} SearchRound
                 \textbf{Required} \\
\index{SearchRound, Parameter}
\index{6805, ParamID}
  \textbf{Description} The search round. First round \emph{0} is the fast 
  round, round \emph{1} is external search and slow.

\item \textbf{6806} \textbf{Type} Bool \textbf{Name} IncludeInfoFields
                 \textbf{Optional} \\
\index{IncludeInfoFields, Parameter}
\index{6806, ParamID}
  \textbf{Description} Default is to include \emph{InfoItem}s use this to 
  turn it off if needed.

\item \textbf{6807} \textbf{Type} int32 \textbf{Name} SearchSorting
                 \textbf{Required} \\
\index{SearchSorting, Parameter}
\index{6807, ParamID}
  \textbf{Description} In what order to return the matches, see SearchSorting
  enumeration.

\end{list}

\label{SearchSortingEnum} 
SearchSorting enumeration.
\begin{verbatim}
       enum SearchSortingType {
              distance_sort   = 0x00,
              alfa_sort       = 0x01,
       }
\end{verbatim}

\subsection{NAV\_ONE\_SEARCH\_REQ v.2}
The following parameters may also be sent:

\begin{list}{\textbf{ParamID}}{}
\item \textbf{6808} \textbf{Type} String \textbf{Name} QueryLocation
                 \textbf{Optional} \\
\index{QueryLocation, Parameter}
\index{6808, ParamID}
  \textbf{Description}  The city or area to seach in.

\item \textbf{6809} \textbf{Type} uint32 \textbf{Name} TopRegionId
                 \textbf{Optional} \\
\index{TopRegionId, Parameter}
\index{6809, ParamID}
  \textbf{Description} Top region ID to search in.

\item \textbf{6810} \textbf{Type} int32 \textbf{Name} SearchType
                 \textbf{Optional} \\
\index{SearchSorting, Parameter}
\index{6807, ParamID}
  \textbf{Description} What we are searching for, see SearchType
  enumeration. The type ``address'' is intended for use with round 0.
  If not sent ``all'' is used.

\end{list}

\label{SearchTypeEnum} 
SearchType enumeration.
\begin{verbatim}
       enum SearchType {
              all     = 0x00,
              address = 0x01,
       }
\end{verbatim}

Parameter 6802 is optional in this version of the request.\\
The location where the search should be performed is specified by either sending
parameter 6802 or parameter 6808 and 6809.

\subsection{NAV\_ONE\_SEARCH\_REPLY v.1}

Reply with either all the parameters below or an error reply.


\begin{list}{\textbf{ParamID}}{}
\item \textbf{6900} \textbf{Type} int32 \textbf{Name} NbrMatches
                 \textbf{Optional} \\
\index{NbrMatches, Parameter}
\index{6900, ParamID}
  \textbf{Description} The number of matches in the \emph{Matches} parameter.

\item \textbf{6901} \textbf{Type} int32 \textbf{Name} TotalNbrMatches
                 \textbf{Optional} \\
\index{TotalNbrMatches, Parameter}
\index{6901, ParamID}
  \textbf{Description} The total number of matches.

\item \textbf{6902} \textbf{Type} byte array \textbf{Name} SearchStringTable
                 \textbf{Optional} \\
\index{SearchStringTable, Parameter}
\index{6902, ParamID}
  \textbf{Description} Byte array with the string data.

\item \textbf{6903} \textbf{Type} byte array \textbf{Name} AreaTable
                 \textbf{Optional} \\
\index{AreaTable, Parameter}
\index{6903, ParamID}
  \textbf{Description} Byte array with the \emph{area}s.

\item \textbf{6904} \textbf{Type} byte array \textbf{Name} InfoItemTable
                 \textbf{Optional} \\
\index{InfoItemTable, Parameter}
\index{6904, ParamID}
  \textbf{Description} Byte array with the \emph{InfoItem}s.

\item \textbf{6905} \textbf{Type} byte array \textbf{Name} Matches
                 \textbf{Optional} \\
\index{Matches, Parameter}
\index{6905, ParamID}
  \textbf{Description} Byte array with the \emph{Search Match}es in order.

\end{list}

\subsection{NAV\_ONE\_SEARCH\_REPLY v.2}
Same as version 1, only change in the request.

\printindex

\appendix


\end{document}
