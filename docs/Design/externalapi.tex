% 
%
% Copyright (c) 1999 - 2010, Vodafone Group Services Ltd
% All rights reserved.
% 
% Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
% 
%     * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
%     * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
%     * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
% 
% THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
%
%
%  A description of the API that will be used by other applications
%  to communicate with MC2
%
%  Please not that this specification is supposed to be a stand-alone
%  document that could be send to third party companies!
%

\chapter{External API --- XML} \label{xmlgrammar}

\input{mc2_xmldochelp}

This is a description of the XML interface to the \mc-system 
developed at Wayfinder Systems AB. In addition to the formal
definition of the Application Programming Interface (API), a 
summary and some examples of the usage are also included in 
this document. It is assumed that the reader has some knowledge of
XML. More information about XML can be found at the World Wide Web 
Consortium (W3C) web site at http://www.w3.org/XML/.

\input{externalapisummary}

\section{Sending Request to a Server}

\subsection{Connecting to a Server}

The connection to the server is HTTP over TCP/IP. 
HTTP Keep-Alive is supported. \\
Normally the communication is encrypted using SSL. If it is not possible to use SSL, you may use insecure communication without SSL.

\subsection{Request Encapsulation}

The request is formatted as an XML document that is sent as the body of an HTTP POST request. 
\texttt{Content-Length} is required and must be the length of the XML
document.
The \texttt{Content-Type} should be \texttt{text/xml} and the URI 
should be \texttt{/xmlfile}. 
Either is sufficient for the server to treat it as an XML request.
\\
Example of a HTTP encapsulated XML request document:
\begin{verbatim}
POST /xmlfile HTTP/1.0
Content-Type: text/xml
Content-Length: 442

<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE isab-mc2>

<isab-mc2>
   <auth>
      <auth_user>username</auth_user>
      <auth_passwd>password</auth_passwd>
   </auth>

   <user_login_request transaction_id="Login1" 
                       user_create_session="true">
      <user_name>ausername</user_name>
      <user_password>apassword</user_password>
      <user_service>HTML</user_service>
   </user_login_request>

</isab-mc2>
\end{verbatim}

\subsection{Additional server communication features}

The server also supports content encoding. This is used to compress the body
of the reply sent from the server to the client. The supported compressions are ``gzip'', alias ``x-gzip'', and ``deflate''.

To enable this feature the client should add an http header field ``Accept-Encoding'' with the value of the compression wanted. A http header might look like this.

\begin{verbatim}
POST /xmlfile HTTP/1.0
Content-Type: text/xml
Accept-Encoding: gzip
Content-Length: 442
\end{verbatim}

The server then replies with ``Content-Encoding'' http header field with
the name of the encoding, compression, used on the body. 

\begin{verbatim}
HTTP/1.0 200 OK
Content-Encoding: gzip
Content-Length: 1046
Content-Type: text/xml
\end{verbatim}

The body of such an reply must be decoded, uncompressed, before it can 
be used.

Please note that even if the client says it accepts a supported encoding 
the server might choose not to encode the reply body. For example if the 
compressed body would become larger than the uncompressed one.

The client must check if the reply contains a content-coding http header
field before applying any decoding.

\subsubsection{Pre agreed encoding}

If the request is sent to ``xsdata'' then the XML request document is 
presumed to be gziped and then encoded using our encryption.
To make a ``xsdata'' request the XML document is first gziped, it can be left
uncompressed, and then enoded, and this is not optional, our predefined
encryption. 
The server doesn't check nor use any encoding header and it sends the
content type ``application/binary''.
The reply from the server must first be unencrypted, and this is not optional, 
using our predefined encryption. Then checked if it is gziped and gunziped if 
so.


\section{Request}\label{xml_request}
\index{Request}
A detailed description of each request supported by the \mc-system can be 
found in the section with the same name as the request, e.g. 
\emph{route\_request} can be found in the route section, section \ref{api:RouteRequest}.

\subsection{Auth}
Each request sent to the \mc-system must contain an auth element.

\begin{verbatim}
<!ELEMENT auth ( (auth_user, auth_passwd, user_service?) | 
                 (user_session_id, user_session_key, user_service) |
                 auth_activate_request |
                 (uin, auth_token) )>
<!ATTLIST auth indentingandlinebreaks %bool; "true"
               development %bool; "false"
               client_type CDATA #IMPLIED
               client_lang %language_t; #IMPLIED >
<!ELEMENT auth_user (#PCDATA)>
<!ELEMENT auth_passwd (#PCDATA)>
<!ENTITY % user_service_t "(WAP|HTML)">
<!ELEMENT user_service (#PCDATA)>
<!ELEMENT auth_activate_request EMPTY>
<!ELEMENT uin (#PCDATA)>
\end{verbatim}
\index{auth, element}
\index{auth, attlist}
\index{auth\_user, element}
\index{auth\_passwd, element}
\index{user\_service\_t, entity}
\index{user\_service, element}
\index{user\_activate\_request, element}
\index{uin, element}
\begin{xmltable}
  \xmldesc{ development }{ boolean }{ Use verbose logging }
  \xmldesc{ client\_type }{ string }{ Type of client the request comes from }
  \xmldesc{ client\_lang }{ string }{ The general language of the client }
  \xmldesc{ indentingandlinebreaks }{ boolean }{ indicates whether ignorable
  whitespace should be added to the reply to make it more human readable. If
  this attribute is false then the reply becomes smaller, and faster to parse
  for an automatic XML parser. }
  \xmldesc{ user\_service }{ string }{ Describes the service that the request
should be authenticated for. See \emph{user\_service\_t} }
  \xmldesc{ auth\_activate\_request }{  }{ Used when one doesn't have a user
  but whants to create one using \emph{activate\_request} }
\end{xmltable}


The authorization part of the document. This part contains access 
information about the one sending the XML-document. There are three main 
ways to authenticate a user. The first one is to use a user name, \emph{auth\_user} and
a password, \emph{auth\_passwd}, and the second one is to verify an active session from a previous
\emph{user\_login\_request}. The third way is to use an \emph{uin} and an 
\emph{auth\_token} from an \emph{activate\_request}.

\section{Reply}
\index{Reply}
For each request (see section \emph{\ref{xml_request} -- Request})
that the \mc~system processes, a reply is sent back to the caller. 
A detailed description of each reply can be found in the section with the 
same name as the reply, e.g. \emph{route\_reply} is in the route section, section \ref{api:RouteReply}.

If a general problem occurs, e.g. an invalid user name or password, the
reply contains only a status code and a status message describing the
problem. Optionally, a status URI may be added as well. 

\section{Common Entities}

\begin{verbatim}
<!ENTITY % number  "NMTOKEN">      <!-- a number, format [0-9]+ -->
\end{verbatim}
\index{number, entity}
A number.
\\[3mm]

\begin{verbatim}
<!ENTITY % bool    "(true|false)"> <!-- true or false -->
\end{verbatim}
\index{bool, entity}
Boolean ``true'' or ``false''.
\\[3mm]
\begin{verbatim}
<!ENTITY % vdata   "CDATA">        <!-- attribute value -->
\end{verbatim}
\index{vdata, entity}
Common type for attributes.
\\[3mm]

\begin{verbatim}
<!ENTITY % HREF    "%vdata;">      <!-- URI, URL or URN designating a 
                                        hypertext node. -->
\end{verbatim}
\index{HREF, entity}
An URI, URL or URN.
\\[3mm]

\begin{verbatim}
<!ENTITY % size_t  "%number;">     <!-- a number but inf is allowed -->
\end{verbatim}
\index{size, entity}
A size, may be special \texttt{inf}, infinity, value.
\\[3mm]

\begin{verbatim}
<!ENTITY % time_t  "CDATA">        <!-- Time since the Epoch 
                                        (00:00:00 UTC, January 1, 1970), 
                                        measured in seconds. -->
\end{verbatim}
\index{date\_t, entity}
Time since the Epoch (00:00:00 UTC, January 1, 1970), measured in seconds.
\\[3mm]

\begin{verbatim}
<!ENTITY % coordinate_t "CDATA">    <!-- A Latitude or longitude -->
\end{verbatim}
\index{date\_t, entity}
A coordinate, see \emph{position\_system\_t} for the possible coordinate
formats.
\\[3mm]

\index{position\_system\_t, entity}
\begin{verbatim}
<!-- position_system_t WGS84(GPS) -->
<!ENTITY % position_system_t "(WGS84|MC2|WGS84Rad|WGS84Deg)">
\end{verbatim}
\input{xml_wgs_position_system}
An example of a boundingbox in the \emph{WGS84} format, enclosing an area in Spain, is
\begin{verbatim}
<boundingbox position_sytem="WGS84"
             north_lat="N 415633.277"
             west_lon="E 12408.425"
             south_lat="N 405516.471"
             east_lon="E 25436.657" />
\end{verbatim}


The MC2 format is a number, digits only, as in the coordinate ``\emph{664731631, 157347616}''.
Use of the MC2 format is recommended, unless you want to present it to an end user.

An example of a boundingbox in the \emph{MC2} format, enclosing the 
western part of Baravägen in Lund, Sweden.
\begin{verbatim}
<boundingbox position_sytem="MC2"
             north_lat="664759427"
             west_lon="157299266" 
             south_lat="664705227"
             east_lon="157395490" />
\end{verbatim}

The WGS84Rad format is a radian angle using the WGS84 coordinate system.

An example of a boundingbox in the \emph{WGS84Rad} format, enclosing the 
western part of Baravägen in Lund, Sweden.
\begin{verbatim}
<boundingbox position_sytem="WGS84Rad"
             north_lat="0.9724885841" 
             west_lon="0.2301159401"
             south_lat="0.9724092940"
             east_lon="0.2302567079" />
\end{verbatim}

The WGS84Deg format is a degree angle using the WGS84 coordinate system.

An example of a boundingbox in the \emph{WGS84Deg} format, enclosing the 
western part of Baravägen in Lund, Sweden.
\begin{verbatim}
<boundingbox position_sytem="WGS84Deg"
             north_lat="55.71949149"
             west_lon="13.18467217"
             south_lat="55.71494850"
             east_lon="13.19273757" />
\end{verbatim}


~\\[3mm]

\begin{verbatim}
<!ENTITY % image_display_type "(std|wap)">
\end{verbatim}
\index{image\_display\_type, entity}
The type of display that an image is designated for, that is, a standard device or a more limited WAP device.
\\[3mm]

\begin{verbatim}
<!ENTITY % route_image_format_t "(png|gif|wbmp)">
\end{verbatim}
\index{route\_image\_format\_t, entity}
The types of image formats. The formats \emph{png} and \emph{gif} may result in large image sizes, whereas the \emph{wbmp} is limited to black and white.
Additional image format types may be supported in future versions of the API.
\\[3mm]

\begin{verbatim}
<!ENTITY % search_item_type_t "(street|pointofinterest|category|misc|
                                other)">
\end{verbatim}
\index{search\_item\_type\_t, entity}
The types of \emph{search\_item}.
Additional search item types may be supported in future versions of the 
API.
\\[3mm]

\begin{verbatim}
<!ENTITY % message_t "(html|wml|smil)">
\end{verbatim}
\index{message\_t, entity}
The types of content of messages that can be sent.
Additional message types may be supported in future versions of the 
API.
\\[3mm]

\begin{verbatim}
<!ENTITY % route_turn_image_t "(map|pictogram|pictogram_set_1|
                                pictogram_set_2|pictogram_set_3|
                                pictogram_set_4|pictogram_set_5)">
\end{verbatim}
\index{route\_turn\_image\_t, entity}
The types of route turn images. Either graphical maps or symbolic 
pictograms.
Additional route turn image types may be supported in future versions 
of the API.
\\[3mm]

\begin{verbatim}
<!ENTITY % sort_distance_t "(radius|route)">
\end{verbatim}
\index{sort\_distance\_t, entity}
\label{sort_distance_t}
The types of distances to sort by, either radius, as the crow fly, distance or
route, the driving, distance.
\\[3mm]

\begin{verbatim}
<!ENTITY % route_cost_t "(distance|time|time_with_disturbances)">
\end{verbatim}
\index{route\_cost\_t, entity}
The types of route costs to optimize by. The possible values are:

\begin{valuetable}
  \valuedesc{ distance }{ The least number of meters. }
  \valuedesc{ time }{ The shortest time. }
  \valuedesc{ time\_with\_disturbances }{ The shortest time, taking account 
    traffic disturbances. }
\end{valuetable}~\\[3mm]

\begin{verbatim}
<!ENTITY % road_side_t "(left_side|right_side|unknown_side|undefined_side|
                         side_does_not_matter|left_side_exit|
                         right_side_exit)">
\end{verbatim}
\index{road\_side\_t, entity}
The possible sides of a street. The \emph{undefined\_side},
\emph{side\_does\_not\_matter}, \emph{left\_side\_exit} and 
\emph{right\_side\_exit} is only used to define a starting point of a 
route.

\begin{valuetable}
  \valuedesc{ left\_side }{ To the left of the road. }
  \valuedesc{ right\_side }{ To the right of the road. }
  \valuedesc{ unknown\_side }{ Unknown side of street. }
  \valuedesc{ undefined\_side }{ Undefined side of street. }
  \valuedesc{ side\_does\_not\_matter }{ Both sides are equally easy to start. }
  \valuedesc{ left\_side\_exit }{ Car is driving out of an exit on the left 
    side }
  \valuedesc{ right\_side\_exit }{ Car is driving out of an exit on the right
    side. }
\end{valuetable}~\\[3mm]

\begin{verbatim}
<!ENTITY % landmarklocation_t "(after|before|in|at|pass|into|arrive|
                                undefinedlocation)">
\end{verbatim}
\index{landmarklocation\_t, entity}
The location of the turn relative to the landmark.

\begin{valuetable}
  \valuedesc{ after}{ The turn is after the landmark. }
  \valuedesc{ before}{ The turn is before the landmark. }
  \valuedesc{ in }{ The turn is in the landmark. }
  \valuedesc{ at }{ The turn is at the landmark. }
  \valuedesc{ pass }{ The landmark has to be passed before the landmark. }
  \valuedesc{ into }{ The turn is in the landmark.
    The landmark could be e.g. a built-up area or a country. }
  \valuedesc{ arrive }{ The turn is where you arrive 
    at the landmark (from e.g. a ferry). }
  \valuedesc{ undefinedlocation}{ The location is unknown. }
\end{valuetable}~\\[3mm]

\begin{verbatim}
<!ENTITY % landmark_t "(builtUpArea|railway|area|poi|signPost|country|
                        countryAndBuiltUpArea|passedStreet|accident|
                        roadwork|camera|speedTrap|police|weather|
                        trafficGen|blackspot|userDefinedCamera)">
\end{verbatim}
\index{landmark\_t, entity}
The types of landmarks:

\begin{valuetable}
  \valuedesc{ builtUpArea }{ A Built Up Area. }
  \valuedesc{ railway }{ A railway. }
  \valuedesc{ area }{ An area, like park. }
  \valuedesc{ poi }{ A Point Of Interest. }
  \valuedesc{ signPost }{ A sign post. }
  \valuedesc{ country }{ A country. }
  \valuedesc{ countryAndBuiltUpArea }{ A country and build up area. }
  \valuedesc{ passedStreet }{ Street passed before the turn. }
  \valuedesc{ accident }{ Traffic accident on route. }
  \valuedesc{ roadwork }{ Traffic, roadwork on route. }
  \valuedesc{ camera }{ Traffic, speed camera on route. }
  \valuedesc{ speedTrap }{ Traffic, speed camera on route. }
  \valuedesc{ police }{ Traffic, police activity. }
  \valuedesc{ weather }{ Traffic, weather contitions. }
  \valuedesc{ trafficGen }{Traffic, undefined. }
  \valuedesc{ blackspot }{ Traffic, blackspot. }
  \valuedesc{ userDefinedCamera }{ Traffic, speed camera on route reported by
    user. }
\end{valuetable}~\\[3mm]

\begin{verbatim}
<!ENTITY % top_region_t "(country|state|internationalRegion|metaregion)">
\end{verbatim}
\index{top\_region\_t, entity}
The types of top regions:

\begin{valuetable}
  \valuedesc{ country }{ A country, Sweden. }
  \valuedesc{ state }{ A state, Kentucky. }
  \valuedesc{ internationalRegion }{ An international region, Medicon Valley. }
  \valuedesc{ metaregion }{ A group of other regions like Europe or 
    Scandinavia. Can not be used in searches only in region access. }
\end{valuetable}~\\[3mm]

\begin{verbatim}
<!ENTITY % language_t "(swedish|english|german|danish|italian|dutch|
                        spanish|french|welch|finnish|norwegian|portuguese|
                        czech|hungarian|polish|greek|american|albanian|
                        basque|catalan|frisian|irish|galician|
                        letzeburgesch|raetoRomance|serboCroatian|slovenian|
                        valencian|slovak|russian|turkish|arabic|
                        eng|swe|ger|dan|ita|dut|spa|fre|wel|fin|nor|por|
                        eng_usa|cze|alb|baq|cat|fry|gle|glg|ltz|roh|scr|
                        slv|hun|gre|pol|slo|rus|tur|ara|chi|est|lav|lit
                        tha|bul|ind|may|isl|jpa|amh|hye|tgl|bel|ben|mya|
                        hrv|fas|gla|kat|guj|heb|hin|kan|kaz|khm|kor|lao|
                        mkd|mal|mar|mol|mon|pan|ron|srp|sin|som|swa|tam|
                        tel|bod|tir|tuk|ukr|urd|vie|zul|sot|bun|bos|sla|
                        bet|mat|scc|ukl|mlt|zh-hant|zh-hant-hk)">
\end{verbatim}
\index{language\_t, entity}
\label{language_t}
The diffenent languages. Swedish, english, german, danish, italian, 
dutch, spanish, french, finnish, norwegian, portuguese, czech,
hungarian, polish, greek, american, slovak, russia, slovenian,
turkish, chinese and traditional chinese
is supported in output such as route descriptions. 
There is also the possibility to use iso639-3 code with 
optional country dialect in ISO 3166-1 alpha-3.
\\[3mm]

\begin{verbatim}
<!ENTITY % route_vehicle_t "(passengercar|pedestrian|taxi)">
\end{verbatim}
\index{route\_vehicle\_t, entity}
Type of transportation:

\begin{valuetable}
   \valuedesc{ passengercar }{ Private passenger car }
   \valuedesc{ pedestrian }{ Pedestrian }
   \valuedesc{ taxi }{ Taxi }
\end{valuetable}
Additional routing vehicle types may be supported in future version of the API.
~\\[3mm]

\begin{verbatim}
<!ENTITY % matchtype_t "(close|full|exact|
                         closefull|wildcard|allwords|
                         phonetic|editdistance)">
\end{verbatim}
\index{matchtype\_t, entity}
The types of string matching methods.
This controls the way that the user input string, $s_{u}$, is compared with the database string, $s_{db}$.

\begin{valuetable}
  \valuedesc{ close }{ Match if $s_{u}$ is a substring of $s_{db}$, when spaces,
    dashes, and otherwise non alphanumeric characters are disregarded. This is
    the recommended matchtype. }
  \valuedesc{ exact }{ Match if $s_{u}$ is a substring of $s_{db}$. }
  \valuedesc{ full }{ Match if $s_{u}$ is same as $s_{db}$. Same as \emph{exact},
    but strings must also be the same length. }
  \valuedesc{ closefull }{ Same as \emph{close}, but strings must also be the
    same length. }
  \valuedesc{ wildcard }{ Not implemented, yet. User input string may include
    wildcards, similar to ``*'' and ``?''. }
  \valuedesc{ allwords }{ All words in the user input string must be present in
    the database string. The order of the words does not matter. }
  \valuedesc{ phonetic }{ This selection allows for matching strings with similar
    phonetics. }
  % xxx replace editdistance with something else?
  \valuedesc{ editdistance }{ This matches strings allowing for a few
    misspellings, by the user and the database. }
\end{valuetable}

\begin{verbatim}
<!ENTITY % wordmatch_t "(beginning|anywhere|wildcardpart|beginningofword)">
\end{verbatim}
\index{wordmatch\_t, entity}
The types of word matching:

\begin{valuetable}
  \valuedesc{ beginning }{ The user input string must match the beginning of the
    database string. }
  \valuedesc{ anywhere }{ The user input string may be found anywhere in the
    database string. }
  \valuedesc{ wildcardpart }{ This should be used together with the ``wildcard''
    \emph{stringmatching\_t}. }
  \valuedesc{ beginningofword }{ The user input string is matched to the
    beginning of any word of the name in the database. }
\end{valuetable}

\begin{verbatim}
<!ENTITY % sorttype_t "(no_sort|alfa_sort|confidence_sort)">
\end{verbatim}
\index{sorttype\_t, entity}
The types of sorting:

\begin{valuetable}
  \valuedesc{ no\_sort }{ The result will not be sorted. }
  \valuedesc{ alfa\_sort }{ Matches are sorted in alphabetical order. }
  \valuedesc{ confidence\_sort }{ Matches are sorted by confidence, attempting to
    place the most probable matches on top of the match list. }
\end{valuetable}
% xxx avstånds/körtidssortering


\begin{verbatim}
<!ENTITY % transactionBased_t "(no_transactions|transactions|
                                transaction_days)">
\end{verbatim}
\label{transactionBasedT}
\index{transactionBased\_t, entity}
The types of transaction types for a user:

\begin{valuetable}
  \valuedesc{ no\_transactions }{ Transactions not used for user. }
  \valuedesc{ transactions }{ Transactions per request is used for user. }
  \valuedesc{ transaction\_days }{ Transactions per 24h day is used for user. }
\end{valuetable}


\begin{verbatim}
<!ENTITY % user_service_t "(ROUTE)">
<!ENTITY % user_method_t "(WAP|HTML|NAV|XML|SMS|OPERATOR)">
\end{verbatim}
\index{user\_service\_t, entity}
\index{user\_method\_t, entity}
The types and methods of services.

\begin{verbatim}
<!ENTITY % poi_info_t "(dont_show|text|url|wap_url|email|phone_number|
                        mobile_phone|fax_number|contact_info|short_info|
                        vis_address|vis_house_nbr|vis_zip_code|
                        vis_complete_zip|vis_zip_area|vis_full_address|
                        brandname|short_description|long_description|
                        citypart|state|neighborhood|open_hours|
                        nearest_train|start_date|end_date|start_time|
                        end_time|accommodation_type|check_in|check_out|
                        nbr_of_rooms|single_room_from|double_room_from|
                        triple_room_from|suite_from|extra_bed_from|
                        weekend_rate|nonhotel_cost|breakfast|
                        hotel_services|credit_card|special_feature|
                        conferences|average_cost|booking_advisable|
                        admission_charge|home_delivery|disabled_access|
                        takeaway_available|allowed_to_bring_alcohol|
                        type_food|decor|image_url|supplier|owner|
                        price_petrol_superplus|price_petrol_super|
                        price_petrol_normal|price_diesel|
                        price_biodiesel|free_of_charge|
                        tracking_data|post_address|post_zip_area|
                        post_zip_code|open_for_season|
                        ski_mountain_min_max_height|
                        snow_depth_valley_mountain|
                        snow_quality|lifts_open_total|ski_slopes_open_total|
                        cross_country_skiing_km|glacier_area|last_snowfall|
                        booking_url|booking_phone_number|
                        special_flag)" >
\end{verbatim}
\index{poi\_info\_t, entity}
The types of poi information fields.

The \tt{special\_flag} field means that if you don't find any special 
field you know how to handle, this favorite should not be shown. 
Special fields are like \tt{tracking\_data} which requires a tracking
request to get the latest coordinate for the tracked user.

%% \begin{valuetable}
%% \valuedesc{ dont\_show }{ Do not show this poi. }
%% \valuedesc{ text }{ Generic text field. }
%% \valuedesc{ url }{ }
%% \valuedesc{ wap\_url }{ }
%% \valuedesc{ email }{ }
%% \valuedesc{ phone\_number }{ }
%% \valuedesc{ mobile\_phone }{ }
%% \valuedesc{ fax\_number }{ }
%% \valuedesc{ contact\_info }{ }
%% \valuedesc{ short\_info }{ Short text info. }
%% \valuedesc{ vis\_address }{ }
%% \valuedesc{ vis\_house\_nbr }{ }
%% \valuedesc{ vis\_zip\_code }{ }
%% \valuedesc{ vis\_complete\_zip }{ }
%% \valuedesc{ vis\_zip\_area }{ }
%% \valuedesc{ vis\_full\_address }{ }
%% \valuedesc{ brandname }{ }
%% \valuedesc{ short\_description }{ A short description about the object. }
%% \valuedesc{ long\_description }{ A longer description about the object. }
%% \valuedesc{ citypart }{ }
%% \valuedesc{ state }{ }
%% \valuedesc{ neighborhood }{ }
%% \valuedesc{ open\_hours }{ Opening hours. }
%% \valuedesc{ nearest\_train }{ }
%% \valuedesc{ start\_date }{ }
%% \valuedesc{ end\_date }{ }
%% \valuedesc{ start\_time }{ }
%% \valuedesc{ end\_time }{ }
%% \valuedesc{ accommodation\_type }{ }
%% \valuedesc{ check\_in }{ }
%% \valuedesc{ check\_out }{ }
%% \valuedesc{ nbr\_of\_rooms }{ }
%% \valuedesc{ single\_room\_from }{ }
%% \valuedesc{ double\_room\_from }{ }
%% \valuedesc{ triple\_room\_from }{ }
%% \valuedesc{ suite\_from }{ }
%% \valuedesc{ extra\_bed\_from }{ }
%% \valuedesc{ weekend\_rate }{ }
%% \valuedesc{ nonhotel\_cost }{ }
%% \valuedesc{ breakfast }{ }
%% \valuedesc{ hotel\_services }{ }
%% \valuedesc{ credit\_card }{ }
%% \valuedesc{ special\_feature }{ }
%% \valuedesc{ conferences }{ }
%% \valuedesc{ average\_cost }{ }
%% \valuedesc{ booking\_advisable }{ }
%% \valuedesc{ admission\_charge }{ }
%% \valuedesc{ home\_delivery }{ }
%% \valuedesc{ disabled\_access }{ }
%% \valuedesc{ takeaway\_available }{ }
%% \valuedesc{ allowed\_to\_bring\_alcohol }{ }
%% \valuedesc{ type\_food }{ }
%% \valuedesc{ decor }{ }
%% \valuedesc{ image\_url }{ }
%% \valuedesc{ supplier }{ }
%% \valuedesc{ owner }{ }
%% \valuedesc{ price\_petrol\_superplus }{ }
%% \valuedesc{ price\_petrol\_super }{ }
%% \valuedesc{ price\_petrol\_normal }{ }
%% \valuedesc{ price\_diesel }{ }
%% \valuedesc{ price\_biodiesel }{ }
%% \valuedesc{ free\_of\_charge }{ }
%% \valuedesc{ tracking\_data }{ }
%% \valuedesc{ post\_address }{ }
%% \valuedesc{ post\_zip\_area }{ }
%% \valuedesc{ post\_zip\_code }{ }
%% \valuedesc{ open\_for\_season }{ }
%% \valuedesc{ ski\_mountain\_min\_max\_height }{ }
%% \valuedesc{ snow\_depth\_valley\_mountain }{ }
%% \valuedesc{ snow\_quality }{ }
%% \valuedesc{ lifts\_open\_total }{ }
%% \valuedesc{ ski\_slopes\_open\_total }{ }
%% \valuedesc{ cross\_country\_skiing\_km }{ }
%% \valuedesc{ glacier\_area }{ }
%% \valuedesc{ last\_snowfall }{ }
%% \valuedesc{ booking\_url }{ }
%% \valuedesc{ booking\_phone\_number }{ }
%% \valuedesc{ special\_flag }{ }
%% \end{valuetable}

\section{Common Elements} \label{api:CommonElements}
\begin{verbatim}
<!ELEMENT status_code (#PCDATA)>
\end{verbatim}
\index{status\_code, element}
The status code of the transaction. 

\begin{statustable}
  \statusdesc{ 0 }{ The request succeeded. }
  \statusdesc{ -1 }{ The general error code. There was a problem with the request.}
  \statusdesc{ -2 }{ The request was malformed, see \emph{status\_message}
    for detailed error.}
  \statusdesc{ -3 }{ The request timed out. There was an internal timeout while 
    processing the request. }
  \statusdesc{ -4 }{ Outside map coverage. The request was for an area outside the
    map coverage of the server. }
  \statusdesc{ -5 }{ Outside allowed area. The request was for an area 
    outside the map coverage the user is allowed to use. }
\end{statustable}


\textit{Each request may define additional status codes}.
\\[3mm]

\pagebreak

The status codes that may be returned from an user authentication request.
The \emph{auth} element, \emph{user\_login\_request},
\emph{user\_verify\_request}, \emph{user\_show\_request} and
\emph{user\_find\_request} uses these error codes.


\begin{statustable}
  \statusdesc{ -201 }{ Access denied. The user does not have access to the
    requested service or data. }
  \statusdesc{ -202 }{ Unknown user. The user does not exist.}
  \statusdesc{ -203 }{ Invalid login. The login and password does not match. }
  \statusdesc{ -204 }{ Invalid session. The session is not valid.}
  \statusdesc{ -205 }{ Session has expired, login again. The session has been
    unused for too long, login again to get a new one.}
  \statusdesc{ -206 }{ Expired user. The user no longer has access to the service.}
  \statusdesc{ -207 }{ Unknown token. The token does not match. Use
    \emph{activate\_request} to get new.}
  \statusdesc{ -208 }{ Expired token. The token is too old. Use the new
    \emph{auth\_token} in this reply.}
  \statusdesc{ -209 }{ Insufficient credit. Silver user using Gold client.}
  \statusdesc{ -210 }{ Important data in reply like new server auth bob and Server
    list. If Server list sent with this code it is not needed to redirect
    immediately just store the new server list and/or auth bob.}
  \statusdesc{ -211 }{ Redirect. See Server list in reply for new server to use. 
    There may be a server auth bob in the reply too.}
  \statusdesc{ -212 }{ Not on backup server. You can't do that on this backup
    server.}

  \statusdesc{ -213 }{ We can't create an account for you. Try activation code. }
  \statusdesc{ -214 }{ Version lock. The user is not allowed to use the current
    client software.}
  \statusdesc{ -215 }{ License key owned by more than one user. The hardware\_key
    in the request is owned by several users and we cannot determine
    which to use.}
  \statusdesc{ -401 }{ External auth client not from the external entity it should
    be. Check installed client application, SIM and access point.}
  \statusdesc{ -402 }{ External auth client is authenticated but external entity
    says that the user hasn't access. Buy some extension.}
\end{statustable}


\begin{verbatim}
<!ELEMENT status_message (#PCDATA)>
\end{verbatim}
\index{status\_message, element}
A text message describing the status of the transaction. This may be,
e.g., ``Ok'', or ``Access Denied''.
\\[3mm]

\begin{verbatim}
<!ELEMENT status_uri EMPTY>
<!ATTLIST status_uri href %HREF; #REQUIRED >
\end{verbatim}
\index{status\_uri, element}
\index{status\_uri, attlist}
An optional URI that can be used to present the error to the user. 
\\[3mm]

\begin{verbatim}
<!ELEMENT status_code_extended (#PCDATA)>
\end{verbatim}
\index{status\_code\_extended, element}
A extended status code that can be sent to Content Window.
\\[3mm]

\begin{verbatim}
<!ELEMENT name ( #PCDATA )>
\end{verbatim}
\index{name, element}
A name of a \emph{search\_item} or a \emph{search\_area}, e.g., ``Lund''.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_item ( name, itemid, streetnbr?, explicit_itemid?,
                        location_name?, lat?, lon?, category_list?
                        boundingbox? 
                        search_area*, info_item?, info_field* )>
\end{verbatim}
\index{search\_item, element}
The element that represents an item of the \emph{search\_item\_type\_t}
types. This type of item is sent by the server in reply to some requests, such as \emph{search\_request}. The items may also be used by the client in subsequent requests.
The contained \emph{search\_area}s is \emph{search\_area}s that this 
\emph{search\_item} is located in.

\begin{xmltable}
  \xmldesc{ name }{ string }{ Name of the \emph{search\_item} }
  \xmldesc{ itemid }{ string }{ A unique id for this item }
  \xmldesc{ streetnbr }{ integer }{ The streets number }
  \xmldesc{ explicit\_itemid }{ }{ Obsolete, do not use. }
  \xmldesc{ location\_name }{ string }{ Name of the location. }
  \xmldesc{ lat }{ }{ Latitude coordinate. }
  \xmldesc{ lon }{ }{ Longitude coordinate. }
  \xmldesc{ category\_list }{ }{ The categories the item belongs to. }
  \xmldesc{ boundingbox }{}{ Boundingbox. }
  \xmldesc{ search\_area }{}{ See \emph{search\_area} }
  \xmldesc{ info\_item }{}{ Added if \emph{include\_info\_item} is 
    \emph{true} }
  \xmldesc{ info\_field }{}{ Added if \emph{include\_info\_fields} is 
    \emph{true} }
\end{xmltable}


\begin{verbatim}
<!ATTLIST search_item search_item_type %search_item_type_t; #REQUIRED
                      image CDATA #IMPLIED
                      category_image CDATA #IMPLIED
                      provider_image CDATA #IMPLIED
                      brand_image CDATA #IMPLIED
                      advert %bool; #IMPLIED >
\end{verbatim}
\index{search\_item, attlist}

\begin{xmltable}
\xmldesc{ image }{ string }{ Image name wihtout file extension. }
\xmldesc{ advert }{ boolean }{ Is set to true if the item is an
  advertisement. Default false. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT itemid ( #PCDATA )>
\end{verbatim}
\index{itemid, element}
The identifier of a \emph{search\_item}.
\\[3mm]

\begin{verbatim}
<!ELEMENT streetnbr ( #PCDATA )>
\end{verbatim}
\index{streetnbr, element}
The street number of a \texttt{search\_item} on the street. If a \emph{street\_item} is located on the address ``14 Grosvenor Crescent'', its \emph{streetnbr} would be ``14''.
\\[3mm]

\begin{verbatim}
<!ELEMENT explicit_itemid ( #PCDATA )>
\end{verbatim}
\index{explicit\_itemid, element}
Obsolete, exists only for backward compatibility with old clients. Do
not use this. Please use coordinates (latitude, longitude) instead.
\\[3mm]

\begin{verbatim}
<!ELEMENT location_name ( #PCDATA )>
\end{verbatim}
\index{location\_name, element}
It contains the name of the location of the \emph{search\_item}.
\\[3mm]

\begin{verbatim}
<!ENTITY % search_area_type_t "(municipal|city|citypart|zipcode|ziparea|
                                country|other)">
\end{verbatim}
\index{search\_area\_type\_t, entity}
The types of \emph{search\_area}.

\begin{valuetable}
  \valuedesc{ municipal }{ An administrative area. }
  \valuedesc{ city }{ A city, all sizes from small rural to a mega city. }
  \valuedesc{ citypart }{ A small part of a city. }
  \valuedesc{ zipcode }{ A postal area identified by id. }
  \valuedesc{ ziparea }{ A postal area identified by name. }
  \valuedesc{ country }{ Country name. }
\end{valuetable}

Additional types of areas may be supported in future versions of the API.

\begin{verbatim}
<!ELEMENT search_area ( name, areaid, location_name?,
                        lat?, lon?, boundingbox?, top_region_id?,
                        search_area* )>
\end{verbatim}
\index{search\_area, element}
The element that represents an area of the \emph{search\_area\_type\_t}
types. The lat and lon is a center point of the \emph{search\_area} not 
necessarily the geographic center but a center like town square.
The contained \emph{search\_area}s is \emph{search\_area}s that this 
\emph{search\_area} is part of. The \emph{location\_name} is a string with
the name of the location of the \emph{search\_area}.

\begin{xmltable}
\xmldesc{ name }{ string }{ Name of the area. }
\xmldesc{ areaid }{ string }{ Unique area id. }
\xmldesc{ location\_name }{ string }{ Name of the location of the area. }
\xmldesc{ boundingbox }{}{ The areas boundingbox. }
\xmldesc{ lat \\ lon }{ }{ The latitude and longitude center point of the area, not necessarily the
  geographic center but a center like town square. }
\xmldesc{ top\_region\_id }{ integer }{ The top region in which the area
  resides. }
\xmldesc{ search\_area }{ }{ A larger area for which this area belong to. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST search_area search_area_type %search_area_type_t; #REQUIRED>
\end{verbatim}
\index{search\_area, attlist}
The type of \texttt{search\_area}.
\\[3mm]

\begin{verbatim}
<!ELEMENT areaid ( #PCDATA )>
\end{verbatim}
\index{areaid, element}
The identifier of a \texttt{search\_area}.
\\[3mm]

\begin{verbatim}
<!ELEMENT position_item ( lat, lon, angle? )>
\end{verbatim}
\index{position\_item, element}
Item describing a position.
This can for example be used as an origin or a destination when routing. 
In that case the coordinates are translated to the nearest point on a street.

\begin{xmltable}
\xmldesc{ lat }{  }{ Latitude. }
\xmldesc{ lon }{  }{ Longitude. }
\xmldesc{ angle }{  }{ The angle is an optional part of a position. It is used to help finding
the best streat near the position. The angle is clockwise from 0 to 360 
where 0 and 360 is north. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST position_item position_system %position_system_t; #REQUIRED>
\end{verbatim}
\index{position\_item, attlist}
The type of positioning reference system used in a 
\emph{position\_item}.
\\[3mm]

\begin{verbatim}
<!ELEMENT lat ( #PCDATA )>
\end{verbatim}
\index{lat, element}
The latitude of a position or \emph{position\_item}.
\\[3mm]

\begin{verbatim}
<!ELEMENT lon ( #PCDATA )>
\end{verbatim}
\index{lon, element}
The longitude of a position or \emph{position\_item}.
\\[3mm]

\begin{verbatim}
<!ELEMENT angle ( #PCDATA ) >
\end{verbatim}
\index{angle, element}
The angle is an optional part of a position. It is used to help finding
the best streat near the position. The angle is clockwise from 0 to 360 
where 0 and 360 is north.
\\[3mm]


\begin{verbatim}
<!ELEMENT boundingbox EMPTY>
<!ATTLIST boundingbox 
             position_sytem %position_system_t; #REQUIRED
             north_lat CDATA #REQUIRED
             west_lon  CDATA #REQUIRED
             south_lat CDATA #REQUIRED
             east_lon  CDATA #REQUIRED >
\end{verbatim}
\index{boundingbox, element}
\index{boundingbox, attlist}

\begin{xmltable}
\xmldesc{ position\_sytem }{  }{ Which position system the latitude and
  longitude are expressed in. }
\xmldesc{ nort\_lat }{ }{ North latitude. }
\xmldesc{ west\_lon }{ }{ West longitude. }
\xmldesc{ south\_lat }{ }{ South latitude. }
\xmldesc{ east\_lon }{ }{ East longitude. }
\end{xmltable}

\begin{figure}[h]
\begin{center}
   \preimage
   \resizebox{0.5\textwidth}{!}{\includegraphics{boundingbox}}
   \postimage
   \caption{A boundingbox.}
   \label{fig:boundingbox}
\end{center}
\end{figure}

A bounding box with a defined positioning reference system.
See figure \ref{fig:boundingbox}.
A \emph{boundingbox} can be imagined as a form of rectangle that circumscribes another object, such as a route or a section of a map.
\\[3mm]


\begin{verbatim}
<!ELEMENT image_settings EMPTY>
<!ATTLIST image_settings 
             image_show_street_main %bool; "true" 
             image_show_street_first %bool; "true"
             image_show_street_second %bool; "true"
             image_show_street_third %bool; "true"
             image_show_street_fourth %bool; "true"
             image_show_builtup_area %bool; "true"
             image_show_park %bool; "true"
             image_show_forest %bool; "true"
             image_show_building %bool; "true"
             image_show_water %bool; "true"
             image_show_island %bool; "true"
             image_show_pedestrianarea %bool; "true"
             image_show_aircraftroad %bool; "true"
             image_show_land %bool; "true" >
\end{verbatim}
\index{image\_settings, element}
\index{image\_settings, attlist}
Set what to show on images.

\begin{xmltable}
\xmldesc{ image\_show\_street\_main }{ boolean }{ Include main roads in the image }
\xmldesc{ image\_show\_street\_first }{ boolean }{ Include level 1 roads. These are smaller than main roads. }
\xmldesc{ image\_show\_street\_second }{ boolean }{Include level 2 roads. These are smaller than level 1 roads.  }
\xmldesc{ image\_show\_street\_third }{ boolean }{ Include level 3 roads. These are smaller than level 2 roads. }
\xmldesc{ image\_show\_street\_fourth }{ boolean }{ Include level 4 roads. These are smaller than level 3 roads. }
\xmldesc{ image\_show\_builtup\_area }{ boolean }{ Include built up area polygons. }
\xmldesc{ image\_show\_park }{ boolean }{ Include parks. }
\xmldesc{ image\_show\_forest }{ boolean }{ Include forests. }
\xmldesc{ image\_show\_building }{ boolean }{ Include areas of larger buildings, such as industrial estates. }
\xmldesc{ image\_show\_water }{ boolean }{ Include water items. }
\xmldesc{ image\_show\_pedestrianarea }{ boolean }{ Include pedestrian areas. }
\xmldesc{ image\_show\_aircraftroad }{ boolean }{ Include aircraft roads. }
\xmldesc{ image\_show\_land }{ boolean }{ Include land polygons. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT name_node ( #PCDATA ) >
<!ATTLIST name_node language %language_t; #REQUIRED >
\end{verbatim}
\index{name\_node, element}
\index{name\_node, attlist}

\begin{xmltable}
\xmldesc{ language }{ string }{ Language of string in the name node. }
\end{xmltable}

A name node describes a name in a specific language.
\\[3mm]


\begin{verbatim}
<!ELEMENT top_region ( top_region_id, boundingbox, name_node )>
<!ATTLIST top_region top_region_type %top_region_t; #REQUIRED >
<!ELEMENT top_region_id ( #PCDATA )>
\end{verbatim}
\index{top\_region, element}

\begin{xmltable}
\xmldesc{top\_region\_id}{ integer }{ A unique id for a top region. }
\xmldesc{boundingbox}{  }{ The box in which the top region resides. }
\xmldesc{name\_node}{  }{ The name of the top region }
\end{xmltable}

A top region is a high level area such as a country.
\\[3mm]


\section{User Profile}

This request and reply allows users to change their profile. New user
can also be added. Users cannot be removed through the API due to debiting and security considerations.

These functions are not generally available without certain permissions.

\subsection{User Request}

\begin{verbatim}
<!ELEMENT user_request (user)>
<!ATTLIST user_request transaction_id ID #REQUIRED
                       new_user %bool; #IMPLIED >
\end{verbatim}
\index{user\_request, element}

\begin{xmltable}
\xmldesc{ user }{ }{ See user node doc. }
\xmldesc{ transaction\_id }{ string }{ Unique transaction id. }
\xmldesc{ new\_user }{ boolean }{ Whether or not to add a new user. }
\end{xmltable}

A  user that should be modified in some way or a new users to be added.
The \emph{transaction\_id} as a unique (within the document) id of the 
transaction to enable mapping the status in the document sent as reply
to the correct transaction.

The \texttt{new\_user} attribute tell whether the request is for adding
a new user or editing an existing user. If \texttt{new\_user} attribute
is not set the user will be added if \texttt{user\_id} doesn't already 
exist and changed if it does. It is recommended to use the 
\texttt{new\_user} attribute.
\\[3mm]

\begin{verbatim}
<!ELEMENT user ( user_id, first_name?, last_name?, initials?, 
                 language?, measurement_system?, 
                 email_address?, operator_comment?,
                 search_for_municipal?, search_for_city?,
                 search_for_citypart?, search_for_zipcode?,
                 search_for_ziparea?,
                 search_for_street?,
                 search_for_company?, search_for_category?,
                 search_for_misc?,
                 new_password?, old_password?,
                 service*, phone*, user_licence_key*,
                 binary_key*, region_access*,
                 wayfinder_subscription?, right*, token*, pin*, 
                 id_key*, last_client* )>
<!ATTLIST user uin CDATA #IMPLIED
               birth_date CDATA #IMPLIED
               route_cost %route_cost_t; #IMPLIED
               route_vehicle %route_vehicle_t; #IMPLIED
               search_match_type %matchtype_t; #IMPLIED
               search_word_match_type %wordmatch_t; #IMPLIED
               search_sort_type %sorttype_t; #IMPLIED
               valid_date %time_t; #IMPLIED
               edit_user_right %bool; #IMPLIED
               address1 CDATA #IMPLIED
               address2 CDATA #IMPLIED
               address3 CDATA #IMPLIED
               address4 CDATA #IMPLIED
               address5 CDATA #IMPLIED
               route_turn_image %route_turn_image_t; #IMPLIED
               overview_image_type %overview_image_t; #IMPLIED
               transactionBased %transactionBased_t; #IMPLIED
               deviceChanges %number; #IMPLIED
               supportComment CDATA #IMPLIED
               postalCity CDATA #IMPLIED
               zipCode CDATA #IMPLIED
               companyName CDATA #IMPLIED
               companyReference CDATA #IMPLIED
               companyVATNbr CDATA #IMPLIED
               emailBounces %number; #IMPLIED
               addressBounces %number; #IMPLIED
               customerContactInfo CDATA #IMPLIED >
\end{verbatim}
\index{user, element}
\index{user, attlist}
A description of the addition or changes of information for one user. 
The values for the present elements are updated, the others will be left unchanged. 
It is not possible to remove a user that has been added, to disable a
user access to the \mc-system all services (see below) should be 
removed.
\\[3mm]


\begin{xmltable}
\xmldesc{uin}{ integer }{ The user identification.}
\xmldesc{birth\_date}{ string }{ The birth date of the user.}
\xmldesc{route\_cost}{  }{ The default route cost for user.}
\xmldesc{route\_vehicle}{  }{ The default route vehicle for user.}
\xmldesc{search\_match\_type}{  }{ The default search string matching method.}
\xmldesc{search\_word\_match\_type}{  }{ The default type of word matching.}
\xmldesc{search\_sort\_type}{  }{ The default type of sorting.}
\xmldesc{valid\_date}{}{ The time until which the user has access.}
\xmldesc{edit\_user\_right}{ boolean }{ If the user may edit other users.}
\xmldesc{address1}{ string }{ The 1:st address field.}
\xmldesc{address2}{ string }{ The 2:nd address field.}
\xmldesc{address3}{ string }{ The 3:rd address field.}
\xmldesc{address4}{ string }{ The 4:th address field.}
\xmldesc{address5}{ string }{ The 5:th address field.}
\xmldesc{route\_turn\_image}{  }{ The type of turn images prefered.}
\xmldesc{overview\_image\_type}{  }{ The type of overview image prefered.}
\xmldesc{transactionBased}{  }{ The type of transactions used for user.
  See Section \ref{transactionBasedT}.}
\xmldesc{deviceChanges}{ integer }{ The number of device changes the user has, -1
  means unlimited number changes.}
\xmldesc{supportComment}{ string }{ The support comment.}
\xmldesc{postalCity}{ string }{ The postal city.}
\xmldesc{zipCode}{ string }{ The zip code.}
\xmldesc{companyName}{ string }{ The company name.}
\xmldesc{companyReference}{ string }{ The company reference.}
\xmldesc{companyVATNbr}{ string }{ The company VAT number.}
\xmldesc{emailBounces}{ integer }{ If the email bounces.}
\xmldesc{addressBounces}{ integer }{ If the address bounces.}
\xmldesc{customerContactInfo}{ string }{ The customer contact information.}
\end{xmltable}

\begin{verbatim}
<!ELEMENT user_id (#PCDATA)>
\end{verbatim}
\index{user\_id, element}
A unique identification id of a user.
\\[3mm]

\begin{verbatim}
<!ELEMENT first_name (#PCDATA)>
\end{verbatim}
\index{first\_name, element}
The first name of a user.
\\[3mm]

\begin{verbatim}
<!ELEMENT last_name (#PCDATA)>
\end{verbatim}
\index{last\_name, element}
The last name of a user.
\\[3mm]

\begin{verbatim}
<!ELEMENT initials (#PCDATA)>
\end{verbatim}
\index{initials, element}
The initials of a user.
\\[3mm]

\begin{verbatim}
<!ELEMENT language (#PCDATA)>
\end{verbatim}
\index{language, element}
The language that the user prefers. See section \ref{language_t}
and the language\_t entity for valid values.
\\[3mm]

\begin{verbatim}
<!ELEMENT measurement_system (#PCDATA)>
\end{verbatim}
\index{measurement\_system, element}
The measurement system for the distances. Valid values are (case 
insensitive):

\begin{valuetable}
  \valuedesc{ metric }{ The distances will be presented to the user in meters. }
  \valuedesc{ imperial }{ The distances will be presented to the user in foots. }
\end{valuetable}


\begin{verbatim}
<!ELEMENT email_address (#PCDATA)>
\end{verbatim}
\index{email\_address, element}
The email address of the user.
~\\[3mm]

\begin{verbatim}
<!ELEMENT operator_comments (#PCDATA)>
\end{verbatim}
\index{operator\_comments, element}
The operator comments about a user, not to be shown to user.
~\\[3mm]

The \emph{search\_for\_municipal}, \emph{search\_for\_city} and
\emph{search\_for\_citypart} represent booleans that sets if search
result may include municipals, cities and cityparts. 
~\\[3mm]

The \emph{search\_for\_street}, \emph{search\_for\_company}, 
\emph{search\_for\_category} and \emph{search\_for\_misc} represent booleans
that sets if search result may include streets, companies, categories and 
miscs.
~\\[3mm]

\begin{verbatim}
<!ELEMENT new_password (#PCDATA)>
\end{verbatim}
\index{new\_password, element}
The new password for user. This will be the future password for user.
\\[3mm]

\begin{verbatim}
<!ELEMENT old_password (#PCDATA)>
\end{verbatim}
\index{old\_password, element}
The old password for user. This will be checked against the current password
user has and if it matches then \emph{new\_password} will be set. If 
\emph{old\_password} isn't right then error code -105 is returned.
\\[3mm]

\begin{verbatim}
<!ELEMENT service (service_type, service_method, service_delete?)>
\end{verbatim}
\index{service, element}
Specifies one service that should be added to or deleted from the 
user.
\\[3mm]

\begin{verbatim}
<!ELEMENT service_type (#PCDATA)>
\end{verbatim}
\index{service\_type, element}
The type of service. Valid values are (case sensitive):
\begin{description}
   \item[ROUTE] The service that, given an origin and at least one
                destination, returns a route description between the
                start and the destination to the user.
\end{description}
~\\[3mm]

\begin{verbatim}
<!ELEMENT service_method (#PCDATA)>
\end{verbatim}
\index{service\_method, element}
The way used to access the service of a given type. Valid values are
(case sensitive):

\begin{valuetable}
   \valuedesc{ SMS }{ The service type specified by the
     \emph{service\_type}-element might be accessed via SMS (Short Message
     Service).}

   \valuedesc{ WAP }{ The service type specified by the
     \emph{service\_type}-element might be accessed via WAP (Wireless
     Application Protocol).}
   \valuedesc{ HTML }{ The service may be accessed via html.}
   \valuedesc{ NAV }{ The service may be accessed via proprietary Navigator
              protocoll.}
   \valuedesc{ XML }{ The service may be accessed via XML(this) api.}
   \valuedesc{ OPERATOR }{ The service may be accessed via operator interface.}
\end{valuetable}


\begin{verbatim}
<!ELEMENT service_delete EMPTY>
\end{verbatim}
\index{service\_delete, element}
If this element is present the service should be deleted from 
the user. That is, the user will not have access to the specified 
service any more.
\\[3mm]

\begin{verbatim}
<!ELEMENT phone (phone_number, phone_manufacturer?, phone_model?, 
                 phone_delete?)>
\end{verbatim}
\index{phone, element}
The information about the mobile phone of the user. If the
\emph{phone\_number}-element contains the number
of an existing phone then this will be changed, otherwise a new phone
will be added. \emph{\textbf{NB!} The support for more than one phone 
per user might depend on the \emph{auth\_user} (could be restricted to one 
phone per user).}
\\[3mm]

\begin{verbatim}
<!ELEMENT phone_number (#PCDATA)>
\end{verbatim}
\index{phone\_number, element}
The phone number of this phone. Including the country code but without
any '+', e.g.  ``4623456789''.
\\[3mm]

\begin{verbatim}
<!ELEMENT phone_manufacturer (#PCDATA)>
\end{verbatim}
\index{phone\_manufacturer, element}
The manufacturer of the phone. Valid values are (case insensitive):\\
\begin{center}
\begin{tabular}{lll}
   \textbf{Ericsson}~~~~~~~~~    & \textbf{Motorola}~~~~~~~~~  & 
                                   \textbf{Nokia}~~~~~~~~~     \\
   \textbf{Panasonic}~~~~~~~~~   & \textbf{Philips}~~~~~~~~~   & 
                                   \textbf{Siemens}~~~~~~~~~   \\
   \textbf{Default}~~~~~~~~~     & ~~~~~~~~~                      &
                                   ~~~~~~~~~ \\
\end{tabular}
\end{center}
For other manufacturers you may use the settings for \emph{Default}, that work with most phones. Also select the \emph{Unknown} as model.
~\\[3mm]

\begin{verbatim}
<!ELEMENT phone_model (#PCDATA)>
\end{verbatim}
\index{phone\_model, element}
The model of the phone. Valid values depends on the manufacturer and 
are (case insensitive):\\
\begin{description}
   \item[Ericsson] Models: 380e, A1018, A2618, GA318, GA628, GF337, GF388,
         GF788, GH337, GH388, GH688, R250, R310, R320s, R380s, R520s,
         S868, S888, T18, T20e, T20s, T28, T29, T39, T65, T66 and T68.

   \item[Nokia] Models: 3310, 3330, 6210, 6250, 6310, 7110, 8210, 8310,
         8850, 8890, 9110 and 9210.

   \item[Siemens] Models C25, C28, C30, C35i, M35i, ME45, S25, S35i, S40, 
         S45 and SL45.
%
   \item[Motorola] Models: A008, cd930, M3588, M3888, P7389, T180, T191, 
         T192, T2288, T250, T260, T280, V100, V101, V2288, V3688, V3690 
         and V66.
%
   \item[Default] Models: Unknown.
\end{description}
~\\[3mm]

\begin{verbatim}
<!ELEMENT phone_delete EMPTY>
\end{verbatim}
\index{phone\_delete, element}
If this element is present the phone should be deleted from the user. 
If it is not present, the phone is added or modified.
\\[3mm]


\begin{verbatim}
<!ELEMENT binary_key ( key_data, key_delete? ) >
<!ATTLIST binary_key id CDATA #REQUIRED >
<!ELEMENT key_data ( #PCDATA ) >
<!ELEMENT key_delete EMPTY >
\end{verbatim}
\index{binary\_key, element}
\index{key\_data, element}
\index{key\_delete, element}
This element describes a binary key that is used to verify a user.
The \texttt{key\_data} is the binary key base64 encoded.\\
If the \texttt{key\_delete} element is present then the 
\texttt{binary\_key} will be removed.

This element is obsolete use \texttt{user\_licence\_key} instead.
\\[3mm]

\begin{verbatim}
<!ELEMENT user_licence_key EMPTY >
<!ATTLIST user_licence_key id       CDATA                 #REQUIRED
                           key      CDATA                 #REQUIRED
                           key_type %hardware_key_type_t; #IMPLIED
                           product  CDATA                 #IMPLIED
                           delete   %bool;                #IMPLIED >
\end{verbatim}
\index{user\_licence\_key, element}
This element describes a hardware key that is used to verify a user.
If the \texttt{key\_delete} attribute is true is present then the 
\texttt{user\_licence\_key} will be removed.
\\[3mm]


\begin{verbatim}
<!ELEMENT region_access ( region_access_delete? ) >
<!ATTLIST region_access id            %number; #REQUIRED  
                        top_region_id %number; #REQUIRED 
                        start_time    %time_t; #REQUIRED
                        end_time      %time_t; #REQUIRED >
<!ELEMENT region_access_delete EMPTY>
\end{verbatim}
\index{region\_access, element}
\index{region\_access, attlist}
\index{region\_access\_delete, element}
This element describes an Allowed User Region Access (A.U.R.A.).
The \texttt{region\_access} says where and when the user may use the
server's different regions.
If the \texttt{region\_access\_delete} element is present then the 
\texttt{region\_access} will be removed.

\begin{xmltable}
\xmldesc{ region\_access\_delete }{}{ If present then the specified
  \emph{region\_access } will be removed. }
\xmldesc{ id }{ integer }{ Unique id of the region. }
\xmldesc{ top\_region\_id }{ integer }{ The top region for which the access
  belongs to. }
\xmldesc{ start\_time }{ }{ Start time when the access is valid. }
\xmldesc{ end\_time }{ }{ End time when the access will be invalid. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT wayfinder_subscription ( wayfinder_subscription_delete? )>
<!ATTLIST wayfinder_subscription id      %number; #REQUIRED  
                                 type    %number; #REQUIRED >
<!ELEMENT wayfinder_subscription_delete EMPTY>
\end{verbatim}
\index{wayfinder\_subscription, element}
\index{wayfinder\_subscription, attlist}
This element describes the level of a wayfinder user's subscription. 
Obsoleted by \emph{user\_right}s.
If the \texttt{wayfinder\_subscription\_delete}  element is present then
 the \texttt{wayfinder\_subscription} will be removed.

\begin{xmltable}
\xmldesc{ id }{ integer }{ }
\xmldesc{ type }{ integer }{ }
\xmldesc{ wayfinder\_subscription\_delete }{ }{ If present then the current
  \emph{wayfinder\_subscription} will be removed. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT right EMPTY >
<!ATTLIST right         id            %number; #REQUIRED
                        add_time      %time_t; #IMPLIED
                        type          %number; #IMPLIED
                        top_region_id %number; #IMPLIED
                        start_time    %time_t; #IMPLIED
                        end_time      %time_t; #IMPLIED
                        deleted       %bool;   #IMPLIED
                        origin        CDATA    #IMPLIED >  
\end{verbatim}
\index{right, element}
\index{right, attlist}
This element describes a right the user has.

\begin{xmltable}
\xmldesc{ id }{ integer }{}
\xmldesc{ add\_time }{}{}
\xmldesc{ type }{ integer }{}
\xmldesc{ top\_region\_id }{ integer }{ The right belong to this top region. }
\xmldesc{ start\_time}{}{ The start time when this right is valid. }
\xmldesc{ end\_time }{}{ The end time when this right becomes invalid. }
\xmldesc{ delete }{ boolean }{ If this rights i deleted or not. }
\xmldesc{ origin }{ string }{ A comment string about the origin. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT token EMPTY >
<!ATTLIST token id            %number; #REQUIRED
                create_time   %time_t; #IMPLIED
                age           %number; #IMPLIED
                token         CDATA    #IMPLIED
                group         CDATA    #IMPLIED >
\end{verbatim}
\index{token, element}
\index{token, attlist}
This element describes a token the user has received from 
\emph{activate\_request}.

\begin{xmltable}
\xmldesc{ id }{ integer }{ }
\xmldesc{ create\_time }{ }{ The creation time for this token. }
\xmldesc{ age }{ }{}
\xmldesc{ token }{ string }{ The actual token. }
\xmldesc{ group }{ string }{}
\end{xmltable}


\begin{verbatim}
<!ELEMENT pin ( delete? ) >
<!ATTLIST pin id            %number; #REQUIRED
              PIN           CDATA    #IMPLIED
              comment       CDATA    #IMPLIED > 
<!ELEMENT delete EMPTY >
\end{verbatim}
\index{pin, element}
\index{pin, attlist}
This element describes a pin the user has to allow other users to 
access some parts of the user's data.
If the \texttt{delete} element is present then the 
\texttt{pin} will be removed.

\begin{xmltable}
\xmldesc{ id }{ integer }{}
\xmldesc{ PIN }{ string }{ The actual PIN. }
\xmldesc{ comment }{ string }{ A comment about the PIN. }
\xmldesc{ delete }{ }{ If present then the pin should be deleted. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT id_key ( delete? ) >
<!ENTITY % id_key_t "(account|hardware|hardware_and_time|
                      service_id_and_time)">
<!ATTLIST id_key id            %number;      #REQUIRED
                 type          %id_key_t;    #IMPLIED
                 key           CDATA         #IMPLIED > 
\end{verbatim}
\index{id\_key, element}
\index{id\_key, attlist}
This element describes an key which identifies a user.
If the \texttt{delete} element is present then the 
\texttt{id\_key} will be removed.

\begin{xmltable}
\xmldesc{ id }{ integer }{}
\xmldesc{ type }{}{ Key type. }
\xmldesc{ key }{ string }{ The key. }
\xmldesc{ delete }{ }{ If present then the key should be removed }
\end{xmltable}


\begin{verbatim}
<!ELEMENT last_client EMPTY >
<!ATTLIST last_client id                  %number; #REQUIRED
                      client_type         CDATA    #IMPLIED
                      client_type_options CDATA    #IMPLIED
                      version             CDATA    #IMPLIED
                      extra               CDATA    #IMPLIED
                      origin              CDATA    #IMPLIED
                      history             %bool;   #IMPLIED
                      changer_uin         CDATA    #IMPLIED
                      change_time         %time_t; #IMPLIED > 
\end{verbatim}
\index{last\_client, element}
\index{last\_client, attlist}
This element describes what client types a user has and has had.

\begin{xmltable}
\xmldesc{ id }{ integer }{ }
\xmldesc{ client\_type }{ string }{ Last client type used. }
\xmldesc{ client\_type\_options}{ string }{ }
\xmldesc{ version }{ string }{ }
\xmldesc{ extra }{ string }{ }
\xmldesc{ origin }{ string }{ }
\xmldesc{ history }{ boolean }{}
\xmldesc{ changer\_uin }{ integer }{ }
\xmldesc{ change\_time }{}{ When the last change was made. }
\end{xmltable}


% \input{xml_api_favorite}
% Included from externalapi.tex and public_xml.tex
\index{favorite, element}
\begin{verbatim}
<!ELEMENT favorite ( position_item, fav_info* )>
<!ATTLIST favorite
                    id                CDATA  #REQUIRED
                    name              CDATA  #REQUIRED
                    short_name        CDATA  #REQUIRED
                    description       CDATA  #REQUIRED
                    category          CDATA  #REQUIRED
                    map_icon_name     CDATA  #REQUIRED >
<!ELEMENT fav_info EMPTY >
<!ATTLIST fav_info  type  %poi_info_t; #REQUIRED
                    key   CDATA        #REQUIRED
                    value CDATA        #REQUIRED >
\end{verbatim}
\label{favorite}
Favorite describes a special place that the user commonly wants to
go to.

\begin{xmltable}
\xmldesc{favorite}{}{ A favorite place for the user.}
\xmldesc{id}{}{ The id that is used to identify the favorite. See also Section \ref{favoriteid} \emph{favorite\_id}.}
\xmldesc{name}{ string }{ The name of the favorite to show in selection list.}
\xmldesc{short\_name}{ string }{ A short name of the favorite for quick
  selection. Might not be available on all interfaces.}
\xmldesc{description}{ string }{ A text describing the favorite and/or
  additional information.}
\xmldesc{category}{ string }{ Used to group favorites together. Currently not
  used.}

\xmldesc{map\_icon\_name}{ string }{ The symbol to use for the favorite when
  drawn on maps. Currently not used.}
\xmldesc{fav\_info}{}{ The list of information elements for the favorite.}
\end{xmltable}



\subsection{User Reply}

The following error codes may also be returned apart from the generic ones:

\begin{statustable}
  \statusdesc{ -105 }{ Old password not valid. The supplied 
    \emph{old\_password} is wrong.}
  \statusdesc{ -106 }{ Must supply old password. \emph{old\_password} is
    required when changing password.}
  \statusdesc{ -107 }{ Not unique userID. A new user must have a unique 
    \texttt{user\_id}. }
  \statusdesc{ -108 }{ No such user. Could not find user to edit, check 
    \texttt{user\_id}. }
\end{statustable}

\begin{verbatim}
<!ELEMENT user_reply (status_code, status_message, status_code_extended?)>
<!ATTLIST user_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{user\_reply, element}
The status code and message with the result of the request.
The \emph{transaction\_id} is the ID of the transaction that this 
reply refers to.

\begin{xmltable}
\xmldesc{ status\_code }{ integer }{ See table. }
\xmldesc{ status\_message }{ string }{ A message describing the error }
\xmldesc{ status\_code\_extended }{}{ Extended code. }
\end{xmltable}




\section{User Favorites}

Request for add, delete and synchronize user's favorites. It is also 
possible to set a ``auto route'' favorite.
These functions are not generally available without certain permissions.


\subsection{User Favorites Request}

\begin{verbatim}
<!ELEMENT user_favorites_request ( (user_id | uin |
                                    (user_session_id, user_session_key) )?,
                                   favorite_id_list?,
                                   delete_favorite_id_list?,
                                   add_favorite_list?,
                                   auto_dest_favorite? )>
<!ATTLIST user_favorites_request 
                              transaction_id ID #REQUIRED
                              fetch_auto_dest   %bool; "false"
                              sync_favorites    %bool; "true"
                              position_system   %position_system_t; "MC2"
                              fav_info_in_desc  %bool; "true" >
<!ELEMENT favorite_id_list ( favorite_id* )>
<!ELEMENT favorite_id ( #PCDATA )>
<!ELEMENT delete_favorite_id_list ( favorite_id+ )>
<!ELEMENT add_favorite_list ( favorite+ )>
<!ELEMENT auto_dest_favorite ( favorite? )>
\end{verbatim}
\index{user\_favorites\_request, element}

\begin{xmltable}
\xmldesc{user\_id \\ uin \\ user\_session\_id \\  user\_session\_key}
{}{ The user of the favorites. Identified by 
      \emph{user\_id} or \emph{user\_session} or \emph{uin}.}
\xmldesc{favorite\_id\_list}{}{ The id's of the favorites that the client
  has.}
\xmldesc{delete\_favorite\_id\_list}{}{ The id's of the favorites that the
  client has deleted.}
\xmldesc{add\_favorite\_list}{}{ The favorites that the client has added.}
\xmldesc{auto\_dest\_favorite}{}{ The ``auto route'' favorite. If the
  \emph{auto\_dest\_favorite} element is present and empty then
  the ``auto route'' favorite is cleared.}
\xmldesc{fetch\_auto\_dest}{}{ If the ``auto route'' favorite should be
  sent in the reply.}
\xmldesc{sync\_favorites}{}{ If the reply should contain the add and 
  delete favorites that is needed to synchronize the client, uses
  \emph{favorite\_id\_list}. Otherwise the reply only contains the added
  and deleted favorites in the request.}
\xmldesc{position\_system}{}{ The position\_system to use in the favorites
  in the reply.}
\xmldesc{fav\_info\_in\_desc}{}{ If \emph{fav\_info}s should be added to
 \emph{description} attribute. New clients that support \emph{fav\_info}s 
 should set this to \emph{false}.}
\xmldesc{favorite\_id}{}{ \label{favoriteid} An id of a favorite. Value is from an \emph{id} in a \emph{favorite} described in Section 
 \ref{favorite}.}
\end{xmltable}

\subsection{User Favorites Reply}

\begin{verbatim}
<!ELEMENT user_favorites_reply ( (delete_favorite_id_list?,
                                  add_favorite_list?,
                                  auto_dest_favorite?) |
                                 ( status_code, status_message, 
                                   status_code_extended? ) )>
<!ATTLIST user_favorites_reply transaction_id ID #REQUIRED
                               crc CDATA #REQUIRED >
\end{verbatim}
\index{user\_favorites\_reply, element}

\begin{xmltable}
\xmldesc{delete\_favorite\_id\_list}{}{ The id's of the favorites that the
  client should remove from it's list.}
\xmldesc{add\_favorite\_list}{}{ The favorites that the client should
  add to it's list.}
\xmldesc{auto\_dest\_favorite}{}{ The ``auto route'' favorite or empty if
  no ```auto route'' favorite.}
\xmldesc{crc}{}{ the favorites crc. Can be used with \emph{user\_favorites\_crc\_request}.}
\end{xmltable}

\subsection{User Favorites CRC}
Calculates crc for the user favorite list.

\subsubsection{User Favorites CRC Request}
\begin{verbatim}
<!ELEMENT user_favorites_crc_request EMPTY >
<!ATTLIST user_favorites_crc_request transaction_id ID #REQUIRED
                                     crc CDATA #REQUIRED >
\end{verbatim}
\index{user\_favorites\_crc\_request, element}
\index{user\_favorites\_crc\_request, attlist}
Request for crc match. 

\begin{xmltable}
\xmldesc{ crc }{ }{ Match against favorites crc. }
\end{xmltable}

\subsubsection{User Favorites CRC Reply}
\begin{verbatim}
<!ELEMENT user_favorites_crc_reply EMPTY >
<!ATTLIST user_favorites_crc_reply transaction_id ID #REQUIRED
                                   crc_match %bool; #REQUIRED >
\end{verbatim}
\index{user\_favorites\_crc\_reply, element}
\index{user\_favorites\_crc\_reply, attlist}
\begin{xmltable}
\xmldesc{ crc\_match }{ boolean }{ True if the crc matched. }
\end{xmltable}

\section{User Capabilities}

Request for user capabilities.


\subsection{User Cap Request}

\begin{verbatim}
<!ELEMENT user_cap_request EMPTY >
<!ATTLIST user_cap_request transaction_id ID #REQUIRED >
\end{verbatim}
\index{user\_cap\_request, element}
A request for user capabilities.
\\[3mm]

\subsection{User Cap Reply}

\begin{verbatim}
<!ELEMENT user_cap_reply (user_id, cap*, pin*, popup*) >
<!ATTLIST user_cap_reply transaction_id ID #REQUIRED >
<!ENTITY % cap_name_type "(gps|locator|route|fleet|traffic)">
<!ELEMENT cap EMPTY >
<!ATTLIST cap name %cap_name_type; #REQUIRED >
<!ELEMENT popup (popup_message, popup_once?, popup_url?)>
<!-- Yes No if url and attr for if to exit if no on url. -->
<!ENTITY % popup_url_t "(yes_no|goto_or_exit)">
<!ELEMENT popup_message ( #PCDATA )>
<!ELEMENT popup_once ( #PCDATA )>
<!ELEMENT popup_url ( #PCDATA )>
<!ATTLIST popup_url url_type %popup_url_t; "yes_no" >
\end{verbatim}
\index{user\_cap\_reply, element}
The reply to a \emph{user\_cap\_reply} with the \emph{user\_id},
\emph{cap} and \emph{pin}. The popup element indicates that the client must show the message with an ok button if the isn't an url. If the is an url then the client shows yes and no buttons. If yes url is opened. If no check the \emph{url\_type} attribute if exit application ("goto\_or\_exit") or continue to main menu ("yes\_no").

\begin{xmltable}
  \xmldesc{ popup }{ }{ }
  \xmldesc{ popup\_message }{ string }{ Message to be shown in the popup. }
  \xmldesc{ popup\_once }{ }{ If node is present then the popup should only be
    shown once. }
  \xmldesc{ popup\_url }{ string }{ URL to be shown if the clients accepts it (
    by pressing ``yes'' ) }
  \xmldesc{ url\_type }{ }{ What kind of user choice buttons to show. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT cap EMPTY >
<!ATTLIST cap name %cap_name_type; #REQUIRED >
\end{verbatim}
The users capability, for example ``\emph{gps}'' or ``\emph{route}''.
\\[3mm]

\section{User Show}

Request for the data about a user.


\subsection{User Show Request}

\begin{verbatim}
<!ELEMENT user_show_request ( (user_id | 
                               (user_session_id, user_session_key))? ) >
<!ATTLIST user_show_request transaction_id ID #REQUIRED
                            uin CDATA #IMPLIED >
\end{verbatim}
\index{user\_show\_request, element}
A request for a specific user's settings and data. The user can be 
identified by \emph{user\_id} or by \emph{user\_session\_id} and 
\emph{user\_session\_key} or by an \emph{uin}. 

\begin{xmltable}
\xmldesc{ uin }{ integer }{ if present,
used to find user even if \emph{user\_id} or \emph{user\_session\_id} and 
\emph{user\_session\_key} is present. }
\end{xmltable}



\subsection{User Show Reply}

\begin{verbatim}
<!ELEMENT user_show_reply ( ( user ) |
                            ( status_code, status_message, 
                              status_code_extended? ) )>
<!ATTLIST user_show_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{user\_show\_reply, element}
The reply to a \emph{user\_show\_request} with the user data or a status 
code and message expaining why not.

\begin{xmltable}
  \xmldesc{ user }{ }{ Contains user data information nodes. }
  \xmldesc{ status\_code }{ integer }{ Error code. }
  \xmldesc{ status\_message }{ string }{ Error message. }
  \xmldesc{ status\_code\_extended }{ integer }{ Extended status code. For
    additional errors. }
\end{xmltable}

\section{Route}


\subsection{Route Request}
\label{api:RouteRequest}

\begin{verbatim}
<!ELEMENT route_request ( route_request_header, 
                          routeable_item_list, 
                          routeable_item_list )>
\end{verbatim}
\index{route\_request, element}
A route request with origin(s) and destination(s) to make a route 
between.
\begin{xmltable}
\xmldesc{ route\_request\_header }{ }{ Settings for route. }
\xmldesc{ routeable\_item\_list }{ }{ First node is origins for route and the
  second node is destinations. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST route_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{route\_request, attlist}
The unique identifier of the \emph{route\_request}.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_request_header ( route_preferences )>
<!ENTITY % reroute_reason_t "(unknown|truncated_route|off_track|
                              traffic_info_update|user_request)" >
<!ATTLIST route_request_header 
          previous_route_id CDATA               #IMPLIED
          reroute_reason    %route_reason_t;    #IMPLIED>
\end{verbatim}
\index{route\_request\_header, element}
The settings of the \emph{route\_request} are in this element.

\begin{xmltable}
\xmldesc{ previous\_route\_id }{ string }{ Shall be included when the
route\_request is actually a reroute of a previous route.  }
\xmldesc{ reroute\_reason}{}{ Describes why a reroute
was necessary. Using a correct \emph{reroute\_reason} value will give
better service. }
\end{xmltable}

Values for reroute\_reason:

\begin{valuetable}
  \valuedesc{ unknown }{ When the reason is not known. }
  \valuedesc{ truncated\_route }{ If the client downloaded a truncated route
    this reason shall be used when requesting the next part of the
    route. The XML server never delivers truncated routes.}
  \valuedesc{ off\_track }{ The user has left the route and requires a new one. }
  \valuedesc{ traffic\_info\_update }{ The client want's the route updated with
    current traffic information.}
  \valuedesc{ user\_request }{ The user requested a reroute. }
\end{valuetable}


\begin{verbatim}
<!ELEMENT route_preferences ( ( user_id | route_settings | uin |
                                (user_session_id, user_session_key) ), 
                              image_settings? )>
\end{verbatim}
\index{route\_preferences, element}
The route settings of a user can be used or the settings can be explicitly
entered. The user can be identified by \emph{user\_id} or 
\emph{user\_session\_id} and \emph{user\_session\_key} or \emph{uin}.
Optionally settings for images can be set with an 
\emph{image\_settings} element.
\\[3mm]

\begin{verbatim}
<!ENTITY % route_description_type_t "(normal|compact)">
\end{verbatim}
\index{route\_description\_type\_t, entity}
The type of route descriptions to get. Valid values are
(case sensitive):
\begin{valuetable}
   \valuedesc{ normal }{ The normal type of description with a natural flow of
     text. }
   \valuedesc{ compact }{ The compact type of description which is for devices
     with a limited display, such as some cellulars. The text in this case will
     be abbreviated in order for it to fit into a narrow cellular
     display. Also, some messaging protocols limit the amount of text that may
     be transferred per message. SMSes for example, have a limit of 160
     characters. }
\end{valuetable}

The following short except from a route description will illustrate the difference made by different values of \emph{route\_description\_type\_t}.
\emph{route\_description\_type} set to \emph{normal} gives
\begin{verbatim}
Drive 46 meters then turn right into the 1:st street Karsviksgatan
Drive 180 meters then turn left into the 1:st street Pontonjärgatan
Drive 130 meters then turn right into the 2:nd street Sven Rinmans gata
\end{verbatim}
\emph{route\_description\_type} set to \emph{compact} gives
\begin{verbatim}
46m 1->
Karlsviksgatan
180m 1<-
Pontonjärgatan
130m 2->
Sven Rinmans Gata
\end{verbatim}
Abbreviations here are to be interpreted as first the number of streets to pass, and then the turn direction, so that ``2->'' is interpreted as ``turn right into the 2:nd street''.
Street names may also be abbreviated using the \emph{abbreviate\_route\_names} flag.
~\\[3mm]

\begin{verbatim}
<!ATTLIST route_preferences 
          route_description_type %route_description_type_t; #REQUIRED
          route_image_links %bool; "false"
          route_overview_image_width %number; "256"
          route_overview_image_height %number; "256"
          route_turn_image_width %number; "256"
          route_turn_image_height %number; "256"
          route_image_default_format %route_image_format_t; "png"
          route_image_display_type %image_display_type; "std"
          route_turn_data %bool; "false"
          route_boundingbox_position_sytem %position_system_t; "MC2"
          route_turn_boundingbox %bool; "false"
          route_road_data %bool; "false"
          route_items %bool; "true"
          abbreviate_route_names %bool; "true"
          route_landmarks %bool; "false" >
\end{verbatim}
\index{route\_preferences, attlist}
The attributes for the route preferences.


\begin{xmltable}

  \xmldesc{route\_description\_type}{}{ The preference for the type of route description is in this attribute}

  \xmldesc{route\_image\_links}{ boolean }{ Set if route-turn-image links should be added to the reply.}

  \xmldesc{route\_overview\_image\_width}{ integer }{ The width of the route overview image.}

  \xmldesc{route\_overview\_image\_height}{ integer }{ The height of the route overview image.}

  \xmldesc{route\_turn\_image\_width}{ integer }{ The width of the turn images.}

  \xmldesc{route\_turn\_image\_height}{ integer }{ The height of the turn images.}

  \xmldesc{route\_image\_default\_format}{}{ Image format, used if
    the HTTP request doesn't contain any supported image format in it's
    \texttt{Accept} header line.}

  \xmldesc{route\_image\_display\_type}{}{ The type of display that should 
    display the images.}

  \xmldesc{route\_turn\_data}{ boolean }{ Set if the building blocks of the description should
    be sent. This adds the turn, distance, time, road name, exit count, 
    signpost text, signpostexitnbr, signpostroutenbr, transportation\_type, 
    crossing\_type element. For the first turn, the start\_dir and
    route\_housenumber\_start\_direction elements are added. Use this flag if you want the elements used for each turn instruction.}

  \xmldesc{route\_boundingbox\_position\_system}{}{ The positioning
    system for the turn boundingbox and road data.}

  \xmldesc{route\_turn\_boundingbox}{ boolean }{ Set if a boundingbox for the
    turns should be added.}

  \xmldesc{route\_road\_data}{ boolean }{ Set if route road data should be added to the
    reply. This includes coordinates, and may become a huge amount of
    data. Make sure you really need this before using it.}

  \xmldesc{route\_items}{ boolean }{ Set if route\_items should be added to reply.}

  \xmldesc{abbreviate\_route\_names}{ boolean }{ Set if the street names should be 
    abbreviated or not. Default is true.}

  \xmldesc{route\_landmarks}{ boolean }{ If landmarks should be included in the 
    reply. Default is false.}

\end{xmltable}

\begin{verbatim}
<!ELEMENT route_settings ( route_costA?, 
                           route_costB?, 
                           route_costC?,
                           language )>
\end{verbatim}
\index{route\_settings, element}
The settings to use when routing, see below for an explanation of the parameters.
\\[3mm]

\begin{verbatim}
<!ATTLIST route_settings route_vehicle %route_vehicle_t; #REQUIRED
                         avoid_toll_road %bool; #IMPLIED
                         avoid_highway   %bool; #IMPLIED >
\end{verbatim}
\index{route\_settings, attlist}
Type of transportation to use for the route.
The \emph{avoid\_toll\_road} attribute is if toll-roads should be penalised
when calculating the route. 
The \emph{avoid\_highway} attribute is if highways should be penalised 
when calculating the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_costA ( #PCDATA )>
\end{verbatim}
\index{route\_costA, element}
If the value isn't ``0'' then the distance to go from origin to destination
is a parameter to minimize when calculating the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_costB ( #PCDATA )>
\end{verbatim}
\index{route\_costB, element}
If the value isn't ``0'' then the time between origin and destination
is a parameter to minimize when calculating the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_costC ( #PCDATA )>
\end{verbatim}
\index{route\_costC, element}
If the value isn't ``0'' then the time to go from origin to destination
taking traffic, road and weather disturbances into account is a
parameter to minimize when calculating the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT routeable_item_list ( (position_item | search_item)+ )>
\end{verbatim}
\index{routeable\_item\_list, element}
A list of items to use as origin or destination for the route.
\\[3mm]


\subsection{Route Reply}
\label{api:RouteReply}

The status codes that may be returned in a route reply. In addition to the
generic ones like ``-5'' ``Outside allowed area''.

\begin{statustable}
  \statusdesc{ -501 }{ No route found. No route was found from the origin to
    the destination. Example: origin is on an island with no
    bridges and no information on ferries.}
  \statusdesc{ -502 }{ Too far for vehicle.  Route is too far to go
    for the vehicle used. Mostly used for pedestrian routes that
    are too long.}
  \statusdesc{ -503 }{ Problem with origin. Can not make out origin. Example:
    origin position is too far from a drivable/walkable street. Or an
    invalid search\_item was sent in the routeable\_item\_list.}
  \statusdesc{ -504 }{ Problem with destination. Can not make out
    destination. For examples see -503.}
  \statusdesc{ -505 }{ Keep your route, it is up to date. This happens when
    reroute\_reason is traffic\_info\_update and the route is unchanged.}

  \statusdesc{ -94209 }{ Routing not allowed. You need to buy route service. This
    error can be sent to Content Window. Number is 0x17001. }
\end{statustable}

\begin{verbatim}
<!ELEMENT route_reply ( ( route_reply_header, 
                          route_origin, route_destination,
                          route_reply_items ) |
                        ( status_code, status_message, status_uri?,
                          status_code_extended? ) )>
\end{verbatim}
\index{route\_reply, element}
The result of a \emph{route\_request} with the route description, or
a status code and a message with an error description.

\begin{xmltable}
  \xmldesc{ route\_reply\_head }{ }{ Statistics of the route. }
  \xmldesc{ route\_origin }{ }{ Contains the route origin(s). }
  \xmldesc{ route\_destination }{ }{ Contains the route destination(s). }
  \xmldesc{ route\_reply\_items }{ }{ The route as number of elements. If the
    \emph{route\_items} attribute in the \emph{route\_preferences} is set to false then this
    element is empty. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST route_reply transaction_id ID        #REQUIRED
                      route_id       CDATA     #REQUIRED
                      ptui           %number;  #IMPLIED >
\end{verbatim}
\index{route\_reply, attlist}
\index{ptui, attribute}

\begin{xmltable}
  \xmldesc{ route\_id }{ string }{ Unique id for the route in the \mc~system
    that can be used later as a reference to the route. }
  \xmldesc{ ptui }{ integer }{ Periodic traffic info interval in minutes. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT route_reply_header ( total_distance,
                               total_distance_nbr,
                               total_time,
                               total_time_nbr,
                               total_standstilltime,
                               total_standstilltime_nbr,
                               average_speed,
                               average_speed_nbr,
                               routing_vehicle,
                               routing_vehicle_type,
                               boundingbox,
                               route_overview_link?,
                               route_overview_width?,
                               route_overview_height? )>
\end{verbatim}
\index{route\_reply\_header, element}
The header of the route reply with statistics of the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT total_distance ( #PCDATA )>
\end{verbatim}
\index{total\_distance, element}
The total distance of the route, in the form of a string with a
measurement unit and a short explanation, for example ``\emph{Total
  distance: 5.2 km}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT total_distance_nbr ( #PCDATA )>
\end{verbatim}
\index{total\_distance\_nbr, element}
The total distance of the route in meters, for example ``\emph{5198}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT total_time ( #PCDATA )>
\end{verbatim}
\index{total\_time, element}
The total time of the route, formatted as a string, such as ``\emph{Total time: hh:mm:ss}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT total_time_nbr ( #PCDATA )>
\end{verbatim}
\index{total\_time\_, element}
The total time of the route in seconds, for example ``\emph{253}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT total_standstilltime ( #PCDATA )>
\end{verbatim}
\index{total\_standstilltime, element}
The total standstill time of the route, formatted as a string, such as ``\emph{Standstill time: hh:mm:ss}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT total_standstilltime_nbr ( #PCDATA )>
\end{verbatim}
\index{total\_standstilltime\_nbr, element}
The total standstill time of the route in seconds, for example 
``\emph{25}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT average_speed ( #PCDATA )>
\end{verbatim}
\index{average\_speed, element}
The average speed of the route, formatted as a string, such as ``\emph{Average speed x km/h}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT average_speed_nbr ( #PCDATA )>
\end{verbatim}
\index{average\_speed\_nbr, element}
The average speed of the route in meters per second, for example 
``\emph{11.525097}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT routing_vehicle ( #PCDATA )>
\end{verbatim}
\index{routing\_vehicle, element}
The routing vehicle of the route, formatted as a string, using the 
language, of the request, such as ``\emph{passenger car}'' 
or ``\emph{pedestrian}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT routing_vehicle_type ( #PCDATA )>
\end{verbatim}
\index{routing\_vehicle\_type, element}
The routing vehicle of the route as a \emph{route\_vehicle\_t}, 
for example ``\emph{passengercar}'' or ``\emph{pedestrian}''.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_overview_link ( #PCDATA )>
\end{verbatim}
\index{route\_overview\_link, element}
A URI to the overview image of the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_overview_width ( #PCDATA )>
\end{verbatim}
\index{route\_overview\_width, element}
The width of the overview image, in pixels, formatted as a
string. This is normally the same as the requested image width, but may
also be less.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_overview_height ( #PCDATA )>
\end{verbatim}
\index{route\_overview\_height, element}
The height of the overview image, in pixels, formatted as a
string. This is normally the same as the requested image height, but may
also be less.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_origin ( search_item+ )>
\end{verbatim}
\index{route\_origin, element}
The origin(s) of the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_destination ( search_item+ )>
\end{verbatim}
\index{route\_description, element}
The destination(s) of the route.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_reply_items ( route_reply_item* )>
\end{verbatim}
\index{route\_reply\_items, element}
The route as a number of elements. If the \emph{route\_items} attribute in 
the \emph{route\_preferences} is set to false then this element is empty.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_reply_item ( description?,
                             turn?,
                             distance?,
                             time?,
                             roadname?,
                             exitcount?,
                             signposttext?,
                             signpostexitnbr?,
                             signpostroutenbr?,
                             start_dir?,
                             route_housenumber_start_direction?,
                             transporation_type?,
                             crossing_type?,
                             route_turn_link?,
                             route_turn_width?,
                             route_turn_height?,
                             boundingbox?,
                             position_item?,
                             route_road_item*,
                             route_landmark_item* )>
<!ATTLIST route_reply_item   controlled_access   %bool; #IMPLIED
                             ramp                %bool; #IMPLIED
                             roundabout          %bool; #IMPLIED
                             drive_on_right_side %bool; #IMPLIED >
\end{verbatim}
\index{route\_reply\_item, element}
A part of the route describing a turn or some other action.
The controlled\_access, ramp, roundabout and drive\_on\_right\_side attributes
here are for the road near the turn not necessarily valid for the entire
distance to the next turn. If the attributes are not present then they have
the same value as the last time they appeared in a \emph{route\_reply\_item} or
\emph{route\_road\_item}. This means that for example if 
drive\_on\_right\_side is set in the first \emph{route\_reply\_item} to true 
and not in any following \emph{route\_reply\_item} or \emph{route\_road\_item}
the entire journey from start to end there is right-hand traffic.\\[3mm]

\begin{verbatim}
<!ELEMENT description ( #PCDATA )>
\end{verbatim}
\index{description, element}
The description of the \emph{route\_reply\_item}, as a human
readable driving direction text string.
\\[3mm]

\begin{verbatim}
<!ENTITY % route_turn_t "(left|right|ahead|u_turn|followroad|
                          enter_roundabout|exit_roundabout|
                          ahead_roundabout|right_roundabout|
                          left_roundabout|off_ramp|on_ramp|
                          enter_bus|exit_bus|change_bus|
                          park_car|start|finally|exit|
                          keep_left|keep_right|
                          enter_ferry|exit_ferry|change_ferry|
                          start_with_u_turn|u_turn_roundabout|
                          endofroad_left_turn|endofroad_right_turn|
                          off_ramp_left|off_ramp_right|
                          on_main|off_main|
                          no_turn)">
<!ENTITY % crossing_t "undefined_crossing|no_crossing|
                       crossing_3ways_t|crossing_3ways_y|crossing_4ways|
                       crossing_5ways|crossing_6ways|crossing_7ways|
                       crossing_8ways|crossing_2roundabout|
                       crossing_3roundabout|crossing_4roundabout|
                       crossing_4roundabout_asymmetric|
                       crossing_5roundabout|crossing_6roundabout|
                       crossing_7roundabout" >
<!ENTITY % route_start_dir_t "(north|northnortheast|northeast|
                               eastnortheast|east|eastsoutheast|
                               southeast|southsoutheast|south|
                               southsouthwest|southwestwestsouthwest|
                               west|westnorthwest|northwest|
                               northnorthwest)" >
<!ENTITY % route_housenumber_start_direction_t "(leftodd|rightodd|
                                                 increasing|decreasing|
                                                 unknown)">
<!ENTITY % route_transportation_t "(drive|walk|bus)">
\end{verbatim}
\index{route\_turn\_t, entity}
\index{crossing\_t, entity}
\index{route\_start\_dir\_t, entity}
\index{route\_housenumber\_start\_direction\_t, entity}
\index{route\_transportation\_t, entity}
The turn, crossing, housenumber starting direction and transportation
method types.

\emph{route\_turn\_t} type of turn or other action:

\begin{valuetable}
% xxx describe:
  \valuedesc{ left }{ A normal left turn. }
  \valuedesc{ right }{ A normal right turn. }
  \valuedesc{ ahead }{ Drive straight ahead, for example in a crossing. }
  \valuedesc{ u\_turn }{ Make a U-turn, that is, turn the vehicle around. }
  \valuedesc{ followroad }{ Follow the current road. }
  \valuedesc{ enter\_roundabout }{ Enter into a roundabout. }
  \valuedesc{ exit\_roundabout }{ Exit out of a roundabout. }
  \valuedesc{ ahead\_roundabout }{ Drive straight ahead at the roundabout. }
  \valuedesc{ right\_roundabout }{ Make a right turn at the roundabout. }
  \valuedesc{ left\_roundabout }{ Make a left turn at the roundabout. }
  \valuedesc{ off\_ramp }{ Take an off ramp, for example to get off a highway. }
  \valuedesc{ on\_ramp }{ Take an on ramp, for example to get on a highway. }
  \valuedesc{ enter\_bus }{ Enter a bus. For pedestrians. }
  \valuedesc{ exit\_bus }{ Exit a bus. For pedestrians. }
  \valuedesc{ change\_bus }{ Get off the current bus, and get on another one. }
  \valuedesc{ park\_car }{ Park the car and continue as a pedestrian. }
  \valuedesc{ start }{ Route starts here. }
  \valuedesc{ finally }{ Destination is straight ahead in the current
    direction. }
  \valuedesc{ exit }{ Drive of current road. }
  \valuedesc{ keep\_left }{ Make a slight left turn. }
  \valuedesc{ keep\_right }{ Make a slight right turn. }
  \valuedesc{ enter\_ferry }{ Enter a ferry. }
  \valuedesc{ exit\_ferry }{ Exit a ferry. }
  \valuedesc{ change\_ferry }{ Change to another ferry. }
  \valuedesc{ start\_with\_u\_turn }{ Route starts here but you have to turn the 
    vehicle around first. }
  \valuedesc{ u\_turn\_roundabout }{ Drive around in the roundabout exiting in
    the same direction as entering. }
  \valuedesc{ endofroad\_left\_turn }{ Take left road where road ends. }
  \valuedesc{ endofroad\_right\_turn }{ Take right road where road ends. }
  \valuedesc{ off\_ramp\_left }{ Take an off ramp to the left. }
  \valuedesc{ off\_ramp\_right }{ Take an off ramp to the right. }
  \valuedesc{ off\_main }{ Take an off ramp, off non highway road. }
  \valuedesc{ on\_main }{ Take an on ramp, on non highway road. }
  \valuedesc{ no\_turn }{ Not really a turn. }
\end{valuetable}

\emph{crossing\_t}:

\begin{valuetable}
  \valuedesc{ undefined\_crossing }{ The crossing is handled in an alternative
    way. }
  \valuedesc{ no\_crossing }{ There is no crossing here ``Follow the road''. }
  \valuedesc{ crossing\_3ways\_t }{ Crossing of three roads in the shape of a
    ``T''. }
  \valuedesc{ crossing\_3ways\_y }{ Crossing of three roads in the shape of a
    ``Y''. }
  \valuedesc{ crossing\_4ways }{ Crossing of four roads. }
  \valuedesc{ crossing\_5ways }{ Crossing of five roads. }
  \valuedesc{ crossing\_6ways }{ Crossing of six roads. }
  \valuedesc{ crossing\_7ways }{ Crossing of seven roads. }
  \valuedesc{ crossing\_8ways }{ Crossing of eight roads. }
  \valuedesc{ crossing\_2roundabout }{ Crossing is a roundabout with only two
    exits. }
  \valuedesc{ crossing\_3roundabout }{ Crossing is a roundabout with three
    exits. }
  \valuedesc{ crossing\_4roundabout }{ Crossing is a roundabout with four exits. }
  \valuedesc{ crossing\_4roundabout\_asymmetric }{ Crossing is a roundabout with
    four exits. The four exits however, are not positioned in a symmetric way. }
  \valuedesc{ crossing\_5roundabout }{ Crossing is a roundabout with five exits. }
  \valuedesc{ crossing\_6roundabout }{ Crossing is a roundabout with six exits. }
  \valuedesc{ crossing\_7roundabout }{ Crossing is a roundabout with seven
    exits. }
\end{valuetable}

   \emph{route\_start\_dir\_t}
% no need to describe each alternative here
\emph{route\_housenumber\_start\_direction\_t}:

\begin{valuetable}
  \valuedesc{ leftodd }{ House numbers on left side of the vehicle should be
    odd. }
  \valuedesc{ rightodd }{ House numbers on right side of the vehicle should be
    odd. }
  \valuedesc{ increasing }{ House numbers should be increasing in the direction
    of travel. }
  \valuedesc{ decreasing }{ House numbers should be decreasing in the direction
    of travel. }
  \valuedesc{ unknown }{}
\end{valuetable}

\emph{route\_transportation\_t}:

\begin{valuetable}
  \valuedesc{ drive }{ Current mode of transportation is by car. }
  \valuedesc{ walk }{ Current mode of transportation is by foot. }
  \valuedesc{ bus }{ Current mode of transportation is by bus. }
\end{valuetable}


\begin{verbatim}
<!ELEMENT turn ( #PCDATA )>
\end{verbatim}
\index{turn, element}
One of the \emph{route\_turn\_t} turn types.
\\[3mm]

\begin{verbatim}
<!ELEMENT distance ( #PCDATA )>
\end{verbatim}
\index{distance, element}
The distance for the description in meters. This field is only digits, such as ``2166''.
The \emph{distance} element is not present for the
starting \emph{route\_reply\_item}. Instead, the starting
\emph{route\_reply\_item} will have a \emph{start\_dir} tag.
\\[3mm]

\begin{verbatim}
<!ELEMENT time ( #PCDATA )>
\end{verbatim}
\index{time, element}
The estimated time the distance should take, in seconds, such as ``138''.
The \emph{distance} element is not present for the
starting \emph{route\_reply\_item}. Instead, the starting
\emph{route\_reply\_item} will have a 
\emph{route\_housenumber\_start\_direction} tag.
\\[3mm]

\begin{verbatim}
<!ELEMENT roadname ( #PCDATA )>
\end{verbatim}
\index{roadname, element}
The name of the street that the turn is into, such as ``Oxford Street''.
\\[3mm]

\begin{verbatim}
<!ELEMENT exitcount ( #PCDATA )>
\end{verbatim}
\index{exitcount, element}
Indicates how many exits there are on the same side as the road to turn into before the road to turn into. Simply a number, such as ``0'' or ``8''.
\\[3mm]

\begin{verbatim}
<!ELEMENT signposttext ( #PCDATA )>
\end{verbatim}
\index{signposttext, element}
If there is a signpost at the turn this string contains the text on it.
An example is ``STOCKHOLM, (31), (33)'', which means that the road leads to Stockholm and road numbers are 31 and 33.
\\[3mm]

\begin{verbatim}
<!ELEMENT signpostexitnbr ( #PCDATA )>
\end{verbatim}
\index{signpostexitnbr, element}
If there is a signpost at the turn this string contains the exit number
on it. A number, only, such as ``26''.
\\[3mm]

\begin{verbatim}
<!ELEMENT signpostroutenbr ( #PCDATA )>
\end{verbatim}
\index{signpostroutenbr, element}
If there is a signpost at the turn, this string contains the road numbers
that the signpost says the turn will lead you to, such as ``33''.
\\[3mm]

\begin{verbatim}
<!ELEMENT start_dir ( #PCDATA )>
\end{verbatim}
\index{start\_dir, element}
Only present for the starting \emph{route\_reply\_item}, the
starting direction as one of the \emph{route\_start\_dir\_t} types.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_housenumber_start_direction ( #PCDATA )>
\end{verbatim}
\index{route\_housenumber\_start\_direction, element}
The house numbering at the start of the route, if available, is one of the 
\emph{route\_housenumber\_start\_direction\_t} types.
\\[3mm]

\begin{verbatim}
<!ELEMENT transporation_type ( #PCDATA )>
\end{verbatim}
\index{transportation\_type, element}
The transportation method for the \emph{route\_reply\_item}, as one of the
\emph{route\_transportation\_t} types.
\\[3mm]

\begin{verbatim}
<!ELEMENT crossing_type ( #PCDATA )>
\end{verbatim}
\index{crossing\_type, element}
The type of crossing at the turn, as one of the \emph{crossing\_t}
types.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_turn_link ( #PCDATA )>
\end{verbatim}
\index{route\_turn\_link, element}
The URI for the image covering the turn.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_turn_width ( #PCDATA )>
\end{verbatim}
\index{route\_turn\_width, element}
The width of the turn image, in pixels.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_turn_height ( #PCDATA )>
\end{verbatim}
\index{route\_turn\_height, element}
The height of the turn image, in pixels.
\\[3mm]

\begin{verbatim}
<!ELEMENT boundingbox EMPTY>
\end{verbatim}
%\index{boundingbox, element} (already defined earlier)=
The boundingbox covering the turn. The data is in the \emph{ATTLIST} of the \emph{boundingbox} element, see section \ref{api:CommonElements}.
\\[3mm]
The \emph{position\_item} is sent along with the boundingbox and 
contains the exact position of the turn's exit.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_road_item ( (lat, lon)+ ) >
<!ATTLIST route_road_item 
                            speedLimit %number; #REQUIRED
                            is_turn %bool;      #IMPLIED
                            controlled_access   %bool; #IMPLIED
                            ramp                %bool; #IMPLIED
                            roundabout          %bool; #IMPLIED
                            drive_on_right_side %bool; #IMPLIED >
\end{verbatim}
\index{route\_road\_item, element}
\index{route\_road\_item, attlist}
The coordinates describing the shape of this part of the route, and
other detailed information about the current section of the route.
If the attributes are not present then they have
the same value as the last time they appeared in a \texttt{route\_reply\_item} or
\texttt{route\_road\_item}.

\begin{valuetable}
  \valuedesc{ speedLimit }{ The speed limit of the road, 0 is unknown speed. }
  \valuedesc{ is\_turn }{ If the road is where the actual turning is done. }
  \valuedesc{ controlled\_access }{ If the road has controlled access. }
  \valuedesc{ ramp }{ If the road is a ramp. }
  \valuedesc{ roundabout }{ If the road is part of a roundabout. }
  \valuedesc{ drive\_on\_right\_side }{ If to drive on the right side of the
    road. }
\end{valuetable}~\\[3mm]


\begin{verbatim}
<!ELEMENT route_landmark_item ( description, road_side?, 
                                landmarklocation_type?, landmark_type?,
                                distance?, name? )>
<!ATTLIST route_landmark_item at_turn   %bool; #REQUIRED 
                              is_detour %bool; #IMPLIED
                              is_start  %bool; #IMPLIED 
                              is_stop   %bool; #IMPLIED>
<!ELEMENT road_side ( #PCDATA )>
<!ELEMENT landmarklocation_type ( #PCDATA )>
<!ELEMENT landmark_type ( #PCDATA )>
\end{verbatim}
\index{route\_landmark\_item, element}
\index{route\_landmark\_item, attlist}
Describes a landmark that is passed before the turn or near the turn 
itself.
The \emph{road\_side}, \emph{landmarklocation\_type}, 
\emph{landmark\_type}, \emph{distance} and \emph{name} is in the reply 
if \emph{route\_turn\_data}
is ``true''.

\begin{valuetable}
  \valuedesc{ at\_turn }{ If the landmark is adjacent to the turn. }
  \valuedesc{ is\_detour }{ If the landmark is a traffic caused detour. }
  \valuedesc{ is\_start }{ If the landmark is the begining of a traffic
    situation. }
  \valuedesc{ is\_stop }{ If the landmark is the end of a traffic situation. }
\end{valuetable}~\\[3mm]



\section{Search}



\subsection{Search Request}

\begin{verbatim}
<!ELEMENT search_request ( search_request_header,
                           (search_query | proximity_query ) )>
\end{verbatim}
\index{search\_request, element}
A text search for search areas and search items or a proximity request.

\begin{xmltable}
  \xmldesc{ search\_request\_header }{ }{ Search settings. }
  \xmldesc{ search\_query }{ }{ item and area query. }
  \xmldesc{ proximity\_query }{ }{ Position search. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST search_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{search\_request, attlist}
The unique identifier of the \emph{search\_request}.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_request_header (search_preferences,
                                 search_explicit_itemid?)>
<!ATTLIST search_request_header 
                         position_sytem %position_system_t; "MC2"
                         position_search_items %bool; "false"
                         position_search_areas %bool; "false"
                         search_area_starting_index %number; "0"
                         search_area_ending_index %number; "49"
                         search_item_starting_index %number; "0"
                         search_item_ending_index %number; "99"
                         full_search_area_match_purge %bool; #IMPLIED >
<!ELEMENT search_explicit_itemid EMPTY>
\end{verbatim}
\index{search\_request\_header, element}
\index{search\_request\_header, attlist}
\index{search\_explicit\_itemid, element}
Header of a \emph{search\_request} which contains search settings.

\begin{xmltable}
  \xmldesc{ search\_explicit\_itemid }{ string }{ Obsolete and should not be
    used, use  \emph{position\_search\_items} instead. If set, then the
    \emph{explicit\_itemid} is added to the returned \emph{search\_item}s. }
  \xmldesc{ position\_search\_items }{ boolean }{ If ``true'', the
    \emph{position\_sytem} is used as the coordinate system in the
    resulting \emph{search\_item}s. }
  \xmldesc{ position\_search\_areas }{ boolean }{ If ``true'', the
    \emph{position\_sytem} is used as the coordinate system in the
    resulting \emph{search\_area}s. }

  \xmldesc{ search\_area\_starting\_index }{ integer }{ Start offset for
    \emph{search\_area}s in the search. }
  \xmldesc{ search\_area\_ending\_index }{ integer }{ End offset for
    \emph{search\_area}s in search. }
  \xmldesc{ search\_item\_starting\_index }{ integer }{ Start offset for
    \emph{search\_item}s in the search. }
  \xmldesc{ search\_item\_ending\_index }{ integer }{ End offset for 
    \emph{search\_item}s in the search. }
  \xmldesc{ full\_search\_area\_match\_purge }{ boolean }{ Enables full 
    \emph{search\_area} match purge. If the \emph{search\_area\_query} matches 
    a \emph{search\_area} fully, ``Lund'' matches fully ``Lund'' but not 
    ``Lunde'', all other \emph{search\_area} matches are removed and a 
    \emph{search\_item\_query} is performed if possible. 
    This feature is default false.}
\end{xmltable}

\begin{verbatim}
<!ELEMENT search_preferences ( ((user_id|uin), search_settings?) | 
                               search_settings |
                               (user_session_id, user_session_key,
                                search_settings?) )>
\end{verbatim}
\index{search\_preferences, element}
The search settings of a user can be used by specifying a \emph{user\_id} element or with a \emph{user\_session\_id} and \emph{user\_session\_key} element, or by \emph{uin} element, or they can be explicitly entered with a \emph{search\_settings} element.
When specifying search settings with an user. Search settings may be 
overridden or specified by a \emph{search\_settings} element after the user.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_settings ( search_for_municipal?, search_for_city?,
                            search_for_citypart?, search_for_zipcode?,
                            search_for_ziparea?,
                            search_for_street?,
                            search_for_company?, search_for_category?,
                            search_for_misc?,
                            show_search_area_municipal?,
                            show_search_area_city?, 
                            show_search_area_city_part?,
                            show_search_item_municipal?,
                            show_search_item_city?, 
                            show_search_item_city_part?,
                            show_search_item_zipcode?,
                            show_search_item_ziparea?,
                            language? )>
\end{verbatim}
\index{search\_settings, element}
The explicit search settings element.
The language is the preferred language of the name in \emph{search\_item}s or \emph{search\_area}s.
This setting is used for those items with different names in different languages.
For example, the English: Gothenburg and the Swedish: Göteborg refers
to the same city.

\begin{xmltable}
  \xmldesc{ search\_for\_municipal }{ }{ include municipals in search. }
  \xmldesc{ search\_for\_city }{ }{ Include cities in search. }
  \xmldesc{ search\_for\_citypart }{ }{ Include city-parts in search. }
  \xmldesc{ search\_for\_zipcode }{ }{ Include zipcodes in search. }
  \xmldesc{ search\_for\_ziparea }{ }{ Include zipareas in search. }
  \xmldesc{ search\_for\_street }{ }{ Include streets in search. }
  \xmldesc{ search\_for\_company }{ }{ Include companies and points of interest
  in search. }
  \xmldesc{ search\_for\_category }{ }{ Include categories of companies and
    other items in search. }
  \xmldesc{ search\_for\_misc }{ }{ Include misc items in search. }
  \xmldesc{ show\_search\_area\_municipal }{ }{ Show municipal for search areas. }
  \xmldesc{ show\_search\_area\_city }{ }{ Show city for search areas. }
  \xmldesc{ show\_search\_area\_city\_part }{ }{ Show city part for search areas. }
  \xmldesc{ show\_search\_item\_municipal }{ }{ Show municipal for search items. }
  \xmldesc{ show\_search\_item\_city }{ }{ Show city for search items. }
  \xmldesc{ show\_search\_item\_city\_part }{ }{ Show city part for search
    items. }
  \xmldesc{ show\_search\_item\_zipcode }{ }{ Show zipcode for search items. }
  \xmldesc{ show\_search\_item\_ziparea }{ }{ Show ziparea for search items. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST search_settings 
                            matchtype %matchtype_t; #IMPLIED
                            wordmatch %wordmatch_t; #IMPLIED
                            sorttype  %sorttype_t;  #IMPLIED
                            minimum_numberhits %number; #IMPLIED >
\end{verbatim}
\index{search\_settings, attlist}
The attributes to \emph{search\_settings} is the type of string matching method, the type of word matching and the type of sorting.

The \emph{minimum\_numberhits} attribute is how many matches there should
at least be in the reply. If the search results in less than 
\emph{minimum\_numberhits} matches the search area is expanded and 
the search criteria reduced gradually until the number of matches is at 
least \emph{minimum\_numberhits}. Even after expanding the search area and
reducing the search criteria maximally the resulting number of matches may
still be less than \emph{minimum\_numberhits} in the reply.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_municipal EMPTY>
\end{verbatim}
\index{search\_for\_municipal, element}
If present in the \emph{search\_settings} the search result may include
municipals.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_city EMPTY>
\end{verbatim}
\index{search\_for\_city, element}
If present in the \emph{search\_settings} the search result may include
cities.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_citypart EMPTY>
\end{verbatim}
\index{search\_for\_citypart, element}
If present in the \emph{search\_settings} the search result may include
city-parts.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_zipcode EMPTY>
\end{verbatim}
\index{search\_for\_zipcode, element}
If present in the \emph{search\_settings} the search result may include
zipcodes.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_ziparea EMPTY>
\end{verbatim}
\index{search\_for\_ziparea, element}
If present in the \emph{search\_settings} the search result may include
zipareas.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_street EMPTY>
\end{verbatim}
\index{search\_for\_street, element}
If present in the \emph{search\_settings} the search result may include
streets.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_company EMPTY>
\end{verbatim}
\index{search\_for\_company, element}
If present in the \emph{search\_settings} the search result may include
companies and points of interest.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_for_category EMPTY>
\end{verbatim}
\index{search\_for\_category, element}
If present in the \emph{search\_settings} the search result may include
categories of companies and other items.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_area_municipal EMPTY>
\end{verbatim}
\index{show\_search\_area\_municipal, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_area}s should have the municipal they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_area_city EMPTY>
\end{verbatim}
\index{show\_search\_area\_city, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_area}s should have the city they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_area_city_part EMPTY>
\end{verbatim}
\index{show\_search\_area\_city\_part, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_area}s should have the city part they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_area_zipcode EMPTY>
\end{verbatim}
\index{show\_search\_area\_zipcode, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_area}s should have the zipcode they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_area_ziparea EMPTY>
\end{verbatim}
\index{show\_search\_area\_ziparea, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_area}s should have the ziparea they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_item_municipal EMPTY>
\end{verbatim}
\index{show\_search\_item\_municipal, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_item}s should have the municipal they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_item_city EMPTY>
\end{verbatim}
\index{show\_search\_item\_city, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_item}s should have the city they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_item_city_part EMPTY>
\end{verbatim}
\index{show\_search\_item\_city\_part, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_item}s should have the city part they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_item_zipcode EMPTY>
\end{verbatim}
\index{show\_search\_item\_zipcode, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_item}s should have the zipcode they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT show_search_item_ziparea EMPTY>
\end{verbatim}
\index{show\_search\_item\_ziparea, element}
If present in the \emph{search\_settings} the search result 
\emph{search\_item}s should have the ziparea they're in.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_query ( top_region?, (search_area_query | search_area),
                         search_item_query? )>
\end{verbatim}
\index{search\_query, element}
If a \emph{top\_region} is present then the search is done in that top 
region if not then the default top region is used to search in.
If \emph{search\_area\_query} is given, the \emph{search\_query} is interpreted as a search for an area and
optionally an item in that area. If you already have a
\emph{search\_area}, you may search for an item using the
\emph{search\_item\_query} within that area.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_area_query ( #PCDATA )>
\end{verbatim}
\index{search\_area\_query, element}
The name of the area(s) to search for.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_item_query ( #PCDATA )>
<!ATTLIST search_item_query house_number CDATA #IMPLIED >
\end{verbatim}
\index{search\_item\_query, element}
\index{house\_number, attribute}
The name of the item(s) to search for. Optionally the house number in
separate \emph{house\_number} attribute.
\\[3mm]

\begin{verbatim}
<!ELEMENT proximity_query ( ( ((search_item | position_item), distance?) |
                              boundingbox),
                            search_item_query? ) >
\end{verbatim}
\index{proximity\_query, element}
A proximity query is used to get \emph{search\_item}s in an area.
The \emph{search\_item} or the \emph{position\_item} defines the 
center point of a circle with \emph{distance} as radius, in metres. 
This circle defines the area to search in. If \emph{distance} is left 
out the whole country is searched and the closest matches are returned.
The \emph{search\_item\_query}, if present, is used as in a normal 
\emph{search\_query} to find only those results that matches the string.
\\[3mm]


\subsection{Search Reply}

\begin{verbatim}
<!ELEMENT search_reply ( ( search_area_list?, search_item_list? ) |
                         ( status_code, status_message, 
                           status_code_extended? ) )>
\end{verbatim}
\index{search\_reply, element}
The result of a \emph{search\_request} with lists of matches to the
search request.
\\[3mm]

\begin{verbatim}
<!ATTLIST search_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{search\_reply, attlist}
The \emph{search\_reply}'s unique identifier.
\\[3mm]

\begin{verbatim}
<!ELEMENT search_area_list ( search_area* )>
\end{verbatim}
\index{search\_area\_list, element}
A list of \emph{search\_area}s, see section \ref{api:CommonElements} for a description of these elements.
\\[3mm]

\begin{verbatim}
<!ATTLIST search_area_list numberitems %number; #REQUIRED
                           total_numberitems %number; #IMPLIED
                           starting_index %number; #IMPLIED
                           ending_index %number; #IMPLIED >
\end{verbatim}
\index{search\_area\_list, attlist}

\begin{xmltable}
  \xmldesc{ numberitems }{ integer }{ The number of \emph{search\_area}s in the 
    \emph{search\_area\_list}. }
  \xmldesc{ total\_numberitems }{ integer }{ The total number of matches for the 
    search. }
  \xmldesc{ starting\_index }{ integer }{ The index of the first match in the 
    \emph{search\_area\_list}. }
  \xmldesc{ ending\_index }{ integer }{ The index of the last match in the 
    \emph{search\_area\_list}. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT search_item_list ( search_item* )>
\end{verbatim}
\index{search\_item\_list, element}
A list of \emph{search\_item}s, see section \ref{api:CommonElements} for a description of these elements.
\\[3mm]

\begin{verbatim}
<!ATTLIST search_item_list numberitems %number; #REQUIRED
                           total_numberitems %number; #IMPLIED
                           starting_index %number; #IMPLIED
                           ending_index %number; #IMPLIED >
\end{verbatim}
\index{search\_item\_list, attlist}

\begin{xmltable}
  \xmldesc{ numberitems }{ integer }{ The number of \emph{search\_item}s in the 
    \emph{search\_item\_list}. }
  \xmldesc{ total\_numberitems }{ integer }{ The total number of matches for the 
    search. }
  \xmldesc{ starting\_index }{ integer }{ The index of the first match in the 
    \emph{search\_item\_list}. }
  \xmldesc{ ending\_index }{ integer }{ The index of the last match in the 
    \emph{search\_item\_list}. }
\end{xmltable}

\subsection{Advertisement Debit Request}
\begin{verbatim}
<!ELEMENT ad_debit (itemid) >
<!ATTLIST ad_debit type %number; #REQUIRED >

<!ELEMENT ad_debit_request (ad_debit*) >
<!ATTLIST ad_debit_request transaction_id ID #REQUIRED 
                           count %number; #REQUIRED >
\end{verbatim}
Adds an advertisement debit to the server.

\begin{xmltable}
  \xmldesc{ itemid }{ string }{ Unique item id. }
  \xmldesc{ type }{ integer }{ Type of the item. }
  \xmldesc{ count }{ integer }{ The number of \emph{ad\_debit} elements in the
    request. }
\end{xmltable}


\subsection{Advertisement Debit Reply}
\begin{verbatim}
<!ELEMENT ad_debit_reply EMPTY >
<!ATTLIST ad_debit_reply transaction_id ID #REQUIRED >
\end{verbatim}
Reply to an ad\_debit\_request. Does not contain anything.

\subsection{Category List Request}
\begin{verbatim}
<!ELEMENT category_list_request ( position_item? ) >
<!ATTLIST category_list_request transaction_id ID #REQUIRED
                                crc %hex_t; #REQUIRED
                                language CDATA #REQUIRED >
\end{verbatim}
Requests a category list from the server. Optionally the client may supply its
position, the server will then choose a specific category list for that area
(if available).

Consider to use the Local Category Tree Request instead of this one, see \ref{local_category_tree_request}

\begin{xmltable}
  \xmldesc{ language }{ string }{ The language to translate the category names
    to. }
  \xmldesc{ crc }{ string }{ A crc in hex from a previous category list request,
    can be empty. }
\end{xmltable}

\subsection{Category List Reply}

\begin{verbatim}
<!ELEMENT category_list_reply (category*|crc_ok) >
<!ATTLIST category_list_reply transaction_id ID #REQUIRED 
                              count %number; #REQUIRED
                              crc %hex_t; #REQUIRED >

<!ELEMENT cat (name,image_name?,cat*) >
<!ATTLIST cat cat_id %number; #REQUIRED >

\end{verbatim}
Returns categories with their name, translated name and image filename.


\begin{xmltable}
  \xmldesc{ count }{ integer }{ The number of categories returned and \emph{crc} is the crc
    of the entire list.}
  \xmldesc{ crc\_ok }{ }{ Returned if the \emph{crc} matched. }
\end{xmltable}

\subsection{Category Tree Request}
\begin{verbatim}
<!ENTITY % category_tree_t "(vicinity|eventfinder)" >
<!ELEMENT category_tree_request EMPTY>
<!ATTLIST category_tree_request transaction_id ID #REQUIRED
                                crc %hex_t; #REQUIRED
                                language CDATA #REQUIRED
                                type %category_tree_t; "vicinity" >

\end{verbatim}
\index{category\_tree\_request, element}

Consider to use the Local Category Tree Request instead of this one, see \ref{local_category_tree_request}.
\begin{xmltable}
  \xmldesc{ crc }{ string }{ The crc from a previous \emph{category\_tree\_reply}. }
  \xmldesc{ language }{ string }{ The language in which the category names should
    be in. }
  \xmldesc{ type }{ string }{ Which type of tree to get. If type is vicinity then the
    normal poi categories will be returned. If type is eventfinder then special
    music event types will be returned. }
\end{xmltable}

\subsection{Category Tree Reply}
\begin{verbatim}
<!ELEMENT cat (name,image_name?,cat*) >
<!ATTLIST cat cat_id %number; #IMPLIED >
<!ELEMENT category_tree ( cat* ) >
<!ELEMENT category_tree_reply (category_tree|crc_ok|
                              ( status_code, status_message, 
                               status_code_extended? )) >
<!ATTLIST category_tree_reply transaction_id ID #REQUIRED 
                              crc %hex_t; #REQUIRED >

\end{verbatim}
\index{category\_tree\_reply,element}
\index{category\_tree, element}
\index{cat, element}

\begin{xmltable}
  \xmldesc{ cat }{ }{ Node that describes a category. Can contain subnodes. }
  \xmldesc{ name }{ string }{ Translated name of the category. }
  \xmldesc{ image\_name }{ string }{ Name of the image associated with the
    category. }
  \xmldesc{ cat\_id }{ integer }{ Unique id of the category. }
  \xmldesc{ crc }{ string }{ A checksum calculated of the entire tree. }
\end{xmltable}

\subsection{Local Category Tree Request}
\label{local_category_tree_request}
\begin{verbatim}
<!ELEMENT local_category_tree_request ( position_item ) >
<!ATTLIST local_category_tree_request transaction_id ID #REQUIRED
                                      crc CDATA #REQUIRED
                                      language %language_t; #REQUIRED
                                      version %number; #REQUIRED >

\end{verbatim}
\index{local\_category\_tree\_request, element}
Requests a category tree from the server. The server will choose a specific 
category tree depending on the position provided by the client. 

\begin{xmltable}
  \xmldesc{ crc }{ string }{ The crc from a previous \emph{local\_category\_tree\_reply}.
  Send empty attribute if no crc is available.}
  \xmldesc{ language }{ string }{ The language in which the category names should
    be in. }
  \xmldesc{ version }{ integer }{ The version to use in the reply. }
\end{xmltable}

\subsection{Local Category Tree Reply}
\begin{verbatim}
<!ELEMENT category_table ( #PCDATA ) >
<!ATTLIST category_table length %number; #REQUIRED >
<!ELEMENT lookup_table ( #PCDATA ) >
<!ATTLIST lookup_table length %number; #REQUIRED >
<!ELEMENT string_table ( #PCDATA ) >
<!ATTLIST string_table length %number; #REQUIRED >
<!ELEMENT local_category_tree_reply ( (category_table, lookup_table,
                                    string_table)|crc_ok|( status_code, 
                                    status_message, status_uri?, 
                                    status_code_extended? ) ) >
<!ATTLIST local_category_tree_reply transaction_id ID #REQUIRED 
                                    crc CDATA #IMPLIED >                              

\end{verbatim}
\index{local\_category\_tree\_reply, element}
\index{category\_table, element}
\index{lookup\_table, element}
\index{string\_table, element}

Returns the category tree in binary format (Base64 encoded). See sepcification
of the format below the table.

\begin{xmltable}
  \xmldesc{ category\_table }{ }{ Node that contains the binary category table.
  The data is Base64 encoded. }
  \xmldesc{ lookup\_table }{ }{ Node that contains the binary lookup table. 
  The data is Base64 encoded. }
  \xmldesc{ string\_table }{ }{ Node that contains the binary string table. 
  The data is Base64 encoded. }
  \xmldesc{ length }{ integer }{ Number of items in the table. Used to improve 
    allocation performance on client. }
  \xmldesc{ crc }{ string }{ A checksum calculated of the entire tree.
  The crc attribute is only avaiable if the request completes successfully. }
\end{xmltable}

\input{category_tree_bin_format}


\subsection{Compact Search Request}
\begin{verbatim}

<!ELEMENT category_id ( #PCDATA ) >
<!ELEMENT category_query ( #PCDATA ) >
<!ELEMENT category_list ( category_id+ ) >
<!ELEMENT compact_search_request ( search_item_query, 
                                   ( category_query | category_name  |
                                     category_id | category_list )?,
                                   ( (search_area_query, top_region_id)|
                                     search_area|
                                    (position_item, distance?) ) ) >
\end{verbatim}
\index{compact\_search\_request}
\begin{xmltable}
  \xmldesc{ category\_id }{ integer }{A unique category id, see
    \emph{category\_list\_reply} and \emph{category\_tree\_reply} }
  \xmldesc{ category\_query }{ string }{Match category names to this string}
  \xmldesc{ category\_list }{  }{ Contains a set of category ids to search in }
  \xmldesc{ search\_item\_query }{string}{Match items to this string}
  \xmldesc{ category\_name}{ string }{ An exact name of the category }
  \xmldesc{ search\_area\_query }{ string }{ The city or area to search in }
  \xmldesc{ top\_region\_id }{ integer }{ A unique region to search in }
  \xmldesc{ search\_area }{ }{ Id of area to search in. See ref here }
  \xmldesc{ position\_item }{}{ Coordinates for position search. See ref here }
  \xmldesc{ distance }{ integer }{ The radius in meters from position in
    \emph{position\_item} }
\end{xmltable}

A text search for search areas, search items or search from position.

There are three ways to search within categories. The first one is using
\emph{category\_id} which is a number that comes from either the category tree
or the category list.

The second way to search within categories is to do a free text category
string using the \emph{category\_query} tag. This will search for categories
matching this string with the language specified. The string is matched against 
all categories in the category tree, see \emph{category\_tree\_reply}.
The last way is to use an exact category name with the tag \emph{category\_name} which must contain the
entire english name of the category, this search type is obsolete and must not be
used in any new applications! Use the \emph{category\_id} instead.


\begin{verbatim}
<!ATTLIST compact_search_request transaction_id ID #REQUIRED
                         start_index %number; #REQUIRED
                         end_index %number; #REQUIRED
                         max_hits %number; #REQUIRED
                         language CDATA #REQUIRED
                         round %number; #REQUIRED
                         heading %number; "-1" 
                         uin %number; #IMPLIED 
                         version %number; "0"
                         include_category_id %bool; "false"
                         include_top_region_id %bool; "false"
                         use_persistent_ids %bool; "false"
                         position_system %position_system_t; "MC2" >
\end{verbatim}
\index{compact\_search\_request, attlist}

\begin{xmltable}
  \xmldesc{ transaction\_id }{ string }{ Unique id for the request }
  \xmldesc{ start\_index }{ integer }{ Start offset of the query }
  \xmldesc{ end\_index }{ integer }{ End offset of the query }
  \xmldesc{ max\_hits }{ integer }{ Number of maximum search results to return }
  \xmldesc{ language }{ string }{ Language of results }
  \xmldesc{ round }{ integer }{ Search round. Round 0 = Fast internal search,
    Round 1 = Slow external provider search }
  \xmldesc{ heading }{ integer }{ The heading to search in, default is all }
  \xmldesc{ uin }{ integer }{ Search using this user }
  \xmldesc{ version }{ integer }{ Version 0 is used for old clients that can not
    handle ad\_result\_text and all\_result\_text nodes, version 1 sends these
    nodes. }
  \xmldesc{ include\_category\_id }{ boolean }{ Whether to include category ids
    in the reply. }
  \xmldesc{ include\_top\_region\_id }{ boolean }{ Whether to have country search\_areas in the reply. }
  \xmldesc{ use\_persistent\_ids }{ boolean }{ Do not use this unless told to do so as turnig it on will change the ids in the results in a way that they will not work if used in a request. }
  \xmldesc{ position\_system }{ }{ Determines which coordinate system to use in
    the reply. }
\end{xmltable}

The \emph{round} will be ignored if \emph{heading} value is set other than \emph{-1}.
\\[3mm]

\subsection{Compact Search Reply}

\begin{verbatim}
<!ELEMENT compact_search_reply (ad_results_text?, 
                                all_results_text?, search_hit_list*)>
\end{verbatim}
\index{ad\_results\_text, element}
\index{all\_results\_text, element}
The text to be displayed above top hits in the heading view is controlled by
\emph{ad\_results\_text} value and the text bove the other headings is controlled by
\emph{all\_results\_text} value.

\begin{verbatim}
<!ATTLIST compact_search_reply transaction_id ID #REQUIRED>
\end{verbatim}
\emph{transaction\_id} is the unique identifier of the \emph{compact\_search\_reply}.

\begin{verbatim}
<!ELEMENT search_hit_list ( ad_results_text?, all_results_text?, 
                            ( search_item* | search_area* ))>
\end{verbatim}
\index{search\_item\_list, element}
\index{ad\_results\_text, element}
\index{all\_results\_text, element}
\begin{xmltable}
  \xmldesc{ ad\_results\_text }{ string }{ The title string to display above
    advertisement hits inside the heading }
  \xmldesc{ all\_results\_text }{ string }{ The title string to display above
    normal hits ( i.e non-advertisement hits ) inside the heading }
  \xmldesc{ search\_item}{ }{ See search\_item(~\ref{api:CommonElements}) }
  \xmldesc{ search\_area}{ }{ See search\_area(~\ref{api:CommonElements}) }
\end{xmltable}

A list of \emph{search\_item}s, see section~\ref{api:CommonElements} for a
description of these elements.
The \emph{search\_item} also includes an extra attribute \emph{image} which is
the image name, without file extension. The image can be fetched with TMap from
the XML server.
When \emph{search\_area} nodes are encountered then these can not be used for
\emph{poi\_info\_request}, instead they must be used for a new search with the
old \emph{what} field and the results \emph{search\_area} to get a list of
search hits within the area.
\\[3mm]

\begin{verbatim}
<!ATTLIST search_hit_list numberitems %number; #REQUIRED
                          total_numberitems %number; #REQUIRED
                          starting_index %number; #REQUIRED
                          ending_index %number; #REQUIRED 
                          heading %number; #REQUIRED
                          top_hits %number; "0" >
\end{verbatim}
\index{search\_hit\_list, attlist}

\begin{xmltable}
  \xmldesc{ numberitems }{ integer }{ The number of \emph{search\_item}s in the 
    \emph{search\_hit\_list}. }
  \xmldesc{ total\_numberitems }{ integer }{ The total number of matches for the 
    search. }
  \xmldesc{ starting\_index }{ integer }{ The index of the first match in the 
    \emph{search\_hit\_list}. }
  \xmldesc{ ending\_index }{ integer }{ The index of the last match in the 
    \emph{search\_hit\_list}. }
  \xmldesc{ heading }{ integer }{ The heading identifier of the list, see
    \emph{search\_desc\_reply}. }
  \xmldesc{ top\_hits }{ integer }{ The number of top hits in this list. The top hits are the
    first hits that should be shown above all the headings. }
\end{xmltable}


\subsection{Search Description Request}

\begin{verbatim}
<!ELEMENT search_desc_request EMPTY />
\end{verbatim}
\index{search\_desc\_request}
\begin{verbatim}
<!ATTLIST search_desc_request transaction_id ID #REQUIRED
                              crc %hex_t; #REQUIRED
                              language CDATA #REQUIRED
                              uin %number; #IMPLIED
                              desc_version %number; "0" >
\end{verbatim}
\index{search\_desc\_request, attlist}

\begin{xmltable}
  \xmldesc{ transaction\_id }{ integer }{ A unique identifier for the request. }
  \xmldesc{ crc }{ string }{ The previous crc from search\_desc\_reply. }
  \xmldesc{ language }{ string }{ The language preference for the reply. }
  \xmldesc{ uin }{ integer }{ Anothers users uin to get search\_desc\_request
    for. }
  \xmldesc{ desc\_version }{ integer }{ Determines the descriptor version. Version 0 is for old
    clients ( java version 7 ) that did not implement search result correctly and
    thus can not handle special headings such as phonebook and favorites. So use
    version 1 for new clients. }
\end{xmltable}

\subsection{Search Description Reply}
\begin{verbatim}
<!ELEMENT search_desc_reply (search_hit_type* | crc_ok ) >
\end{verbatim}
\index{search\_desc\_reply}

\begin{xmltable}
\xmldesc{ search\_hit\_type }{ }{ The description of the \emph{search\_hit\_list}
  type. }
\xmldesc{ crc\_ok }{ }{ An empty node to indicate that the crc matched. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST search_desc_reply transaction_id ID #REQUIRED
                            crc %hex_t; #REQUIRED
                            length %number; #REQUIRED >
\end{verbatim}
\index{search\_desc\_reply, attlis}

\begin{xmltable}
  \xmldesc{ transaction\_id }{ string }{ Unique identifier for the request. }
  \xmldesc{ crc }{ string }{ The check sum. The reply will be a single element \emph{crc\_ok} if crc from
    request matches. }
  \xmldesc{ length }{ integer }{  The number of \emph{search\_hit\_type} in the
    list. }
\end{xmltable}

\begin{verbatim}
<!ELEMENT image_name ( #PCDATA ) >
<!ELEMENT search_hit_type (name, top_region_id?, image_name?, type?) >
\end{verbatim}
\index{search\_hit\_type}

\begin{xmltable}
  \xmldesc{ name }{ string }{ The translated name of the type. }
  \xmldesc{ top\_region\_id }{ integer }{ The top region id of the search hit. }
  \xmldesc{ image\_name }{ string }{ The image name without file extension. }
  \xmldesc{ type }{ string }{ The type of service, localized (e.g. Yellow pages). }
\end{xmltable}

\begin{verbatim}
<!ATTLIST search_hit_type round %number; #REQUIRED
                          heading %number; #REQUIRED >
\end{verbatim}
\index{search\_hit\_type, attlist}

\begin{xmltable}
  \xmldesc{ round }{ integer }{ The round for the specific type. }
  \xmldesc{ heading }{ integer }{ The heading number for the type. } 
\end{xmltable}


\subsection{Search Position Description Request}
\begin{verbatim}
<!ELEMENT search_position_request ( position_item ) />
\end{verbatim}
\index{search\_position\_desc\_request, element}
\begin{xmltable}
  \xmldesc{ position\_item }{ }{ The position to determine top region and which
    search providers that are present. }
\end{xmltable}

This request will determine the top region and which search providers that are
present at a position.

\subsection{Search Position Description Reply}
\begin{verbatim}
<!ATTLIST search_position_desc_request
          transaction_id ID #REQUIRED
          language CDATA #REQUIRED >
\end{verbatim}

\begin{xmltable}
  \xmldesc{ language }{ string }{ The language for which the top region name and search
    providers will be translated to. }
\end{xmltable}

\index{search\_position\_desc\_request, attlist}
\begin{verbatim}
<!ELEMENT search_position_desc_reply ( top_region?, search_hit_type* ) >
<!ATTLIST search_position_desc_reply transaction_id ID #REQUIRED 
                                     length %number; #REQUIRED >
\end{verbatim}
\index{search\_position\_desc\_reply, element}
\index{search\_position\_desc\_reply, attlist}
See \emph{top\_region} and \emph{search\_hit\_type}. Position system in the top
region element will have the same system as the \emph{position\_item} in the request.
\emph{length} is the number of \emph{search\_hit\_type} nodes, i.e excluding
the top region node.
\\[3mm]

\subsection{POI Search Request}
\begin{verbatim}
<!ELEMENT poi_search_request (position_item, distance,
                              category_list?,
                              search_item_query?) >

<!ATTLIST poi_search_request transaction_id ID #REQUIRED
                             start_index %number; #REQUIRED
                             end_index %number; #REQUIRED
                             language CDATA #REQUIRED 
                             include_top_region_id %bool; "false"
                             use_persistent_ids %bool; "false" >
\end{verbatim}
\index{poi\_search\_request, element}
\index{poi\_search\_request, attlist}

\begin{xmltable}
  \xmldesc{ search\_item\_query }{ string }{ Match search hit names with this string. }
  \xmldesc{ category\_list }{ }{ Category ids to search in. }
  \xmldesc{ position\_item }{ }{ Centrum point for search. }
  \xmldesc{ distance }{ }{ Radius in meters. }
  \xmldesc{ start\_index }{ integer }{ Start offset of search hits. }
  \xmldesc{ end\_index }{ integer }{ End offset of search hits. }
  \xmldesc{ language }{ string }{ The language for withc the search hits should
  be translated to. }
  \xmldesc{ include\_top\_region\_id }{ boolean }{ Whether to have country search\_areas in the reply. }
  \xmldesc{ use\_persistent\_ids }{ boolean }{ Do not use this unless told to do so as turnig it on will change the ids in the results in a way that they will not work if used in a request. }
\end{xmltable}

This request will search for POIs within a circle centred at
\emph{position\_item} with a \emph{distance} radius in meters.
The result is a \emph{poi\_search\_reply}. Note that the reply
may return a different \emph{end\_index} than requested.
The maximum radius is set to 100 km.
The different poi types are visible at different radius ranges.
Here are the ranges: \\
\begin{tabular}{|l|l|}
\hline
\rowcolor{black}\color{white}Range (in km) & \color{white}POI \\
\hline
0-100 & airport \\
\hline
0-20 & parking, petrol stations, rent a car, hospital, hotel \\
\hline
0-4 & All pois not covered by the above ranges. \\
\hline
\end{tabular}
(The ranges are closed, i.e 0 <= x <= 20 )

The only poi type you can not search for is city centres.

\subsection{POI Search Reply}
\begin{verbatim}
<!ATTLIST poi_search_reply transaction_id ID #REQUIRED >
<!ELEMENT poi_search_reply ( search_item_list |
                            ( status_code, status_message,
                            status_uri?, status_code_extended? ) )>
\end{verbatim}
\index{poi\_search\_reply, element}
\index{poi\_search\_reply, attlist}

\section{Copyright Strings}

Request to get the copyright strings for the map data. Contains boundingboxes
for the different copyright strings.

\subsection{Copyright Strings Request}
\begin{verbatim}
<!ELEMENT copyright_strings_request EMPTY >
<!ATTLIST copyright_strings_request transaction_id ID #REQUIRED 
                                    crc %hex_t; #REQUIRED
                                    language CDATA #REQUIRED >
\end{verbatim}
Requests copyright strings from the server with specified language.

\begin{xmltable}
  \xmldesc{ crc }{ string }{ A checksum from a previous request, can be empty on
    the first request. }
  \xmldesc{ language }{ string }{ Language for the copyrights. }
\end{xmltable}

\subsection{Copyright Strings Reply}

\begin{verbatim}
<!ELEMENT copyright_strings_reply ( crc_ok | copyright_strings_data ) >
<!ATTLIST copyright_strings_reply transaction_id ID #REQUIRED 
                                  crc %hex_t; #REQUIRED >
<!ELEMENT copyright_strings_data ( #PCDATA )>
\end{verbatim}
\begin{xmltable}
  \xmldesc{ copyright\_strings\_data }{ string }{ base64 encoded format string of
    the copyright data }
  \xmldesc{ crc }{ string }{ Will be matched against the current copyright
    data. }
  \xmldesc{ crc\_ok }{ }{ Will be returned instead of
    \emph{copyright\_strings\_data}. if the crc matched. }
\end{xmltable}


\section{Expand}

\subsection{Expand Request}

\begin{verbatim}
<!ELEMENT expand_request ( expand_request_header, 
                           expand_request_query )>
\end{verbatim}
\index{expand\_request, element}
A request to expand a category to a list of \emph{search\_item}s. 
Can also expand a \emph{search\_item} or a \emph{search\_area} and
return it's boundingbox. Also, a \emph{position\_item} can be expanded to a \emph{search\_item}, this is, the street that is closest to the given position.
\\[3mm]

\begin{verbatim}
<!ATTLIST expand_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{expand\_request, attlist}
The unique identifier of the \emph{expand\_request}.
\\[3mm]

\begin{verbatim}
<!ELEMENT expand_request_header (search_preferences)>
\end{verbatim}
\index{expand\_request\_header, element}
The settings to use when expanding a \emph{search\_item}.
\\[3mm]

\begin{verbatim}
<!ENTITY % expand_request_location_t "(all_possible|country_city)">
<!ATTLIST expand_request_header
                         position_system %position_system_t; "MC2"
                         include_top_region_id %bool; "false"
                         location_name %expand_request_location_t; #IMPLIED  >
\end{verbatim}
\index{expand\_request\_header, attlist}
The \emph{position\_system} to use in the reply.
The \emph{include\_top\_region\_id} determines whether the node
\emph{top\_region\_id} is included in the country \emph{search\_area} node.
The \emph{location\_name} sets the content of any \emph{location\_name} node
in the reply.
\\[3mm]

\begin{verbatim}
<!ELEMENT expand_request_query ( (search_area, search_item) |
                                 search_item | position_item | search_area )>
\end{verbatim}
\index{expand\_request\_query, element}
If the query contains a \emph{search\_item} to expand and that item is a 
category then the \emph{search\_area} in which to expand must be
present to set the area from which to get points-of-interest items.
If the query is a single \emph{search\_item} or \emph{search\_area} 
then the \emph{boundingbox} of that item is returned.
If the query is a \emph{position\_item}, the closest point on a street is returned in the form of a \emph{search\_item}.



\subsection{Expand Reply}

\begin{verbatim}
<!ELEMENT expand_reply ( (search_item_list | search_area_list |
                          companydata)+ |
                         (status_code, status_message, 
                          status_code_extended? ) )>
\end{verbatim}
\index{expand\_reply, element}
The result of an \emph{expand\_request} with the expanded data.
\\[3mm]

\begin{verbatim}
<!ATTLIST expand_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{expand\_reply, attlist}
The unique identifier of the \emph{expand\_reply}.
\\[3mm]

\begin{verbatim}
<!ELEMENT companydata EMPTY>
\end{verbatim}
\index{companydata, element}
To be defined. This could contain, for example, phone numbers, web
address, etc. See POI info request.



\section{Send SMS}

\subsection{Send SMS Request}

\begin{verbatim}
<!ELEMENT send_sms_request ( phone_number, 
                             (smsmessage |
                              (route_sms_message, route_message_data) |
                              (local_map_sms_settings, local_map_data) |
                              (wayfinder_destination_sms) |
                              (wayfinder_route_sms) |
                              (wayfinder_favourite_sms) |
                              (wap_push_service_indication) ) ) >
<!ATTLIST send_sms_request transaction_id ID #REQUIRED
                           wayfinder_sms_version CDATA "1">
\end{verbatim}
\index{send\_sms\_request, element}
\index{send\_sms\_request, attlist}
A request to send one or several SMSes.
\\[3mm]

\begin{verbatim}
<!ELEMENT smsmessage (#PCDATA)>
\end{verbatim}
\index{smsmessage, element}
Plain text to send as an SMS. The text will be truncated if it is too
long for one SMS.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_sms_message ( phone_manufacturer, phone_model ) >
<!ATTLIST route_sms_message wap_link %bool; #REQUIRED >
\end{verbatim}
\index{route\_sms\_message, element}
\index{route\_sms\_message, attlist}
Data about sender of route message such as phone model and manufacturer.
The \emph{wap\_link} attribute tells if the route should be sent as an SMS
with a WAP link or as SMSes with driving instructions.
If the message is too long to fit into one SMS, it is split into several SMSes, which may be concatenated based on the capabilities of the \emph{phone\_model}.
\\[3mm]
\begin{verbatim}
<!ELEMENT wap_push_service_indication ( #PCDATA ) >
<!ATTLIST wap_push_service_indication href %HREF; #REQUIRED >
\end{verbatim}
Send WAP Push SMS with Service Indication, href is the URI the WAP browser should go to, the contents of the element is the text shown to the user. See WAP Forum specification WAP-167-ServiceInd-20010731-a.
\\[3mm]

\begin{verbatim}
<!ELEMENT route_message_data ( language, signature, 
                               originString, originLocationString,
                               destinationString, 
                               destinationLocationString ) >
<!ATTLIST route_message_data route_id CDATA  #REQUIRED >
<!ELEMENT signature ( #PCDATA ) >
<!ELEMENT originString ( #PCDATA ) >
<!ELEMENT originLocationString ( #PCDATA ) >
<!ELEMENT destinationString ( #PCDATA ) >
<!ELEMENT destinationLocationString ( #PCDATA ) >
\end{verbatim}
\index{route\_message\_data, element}
\index{route\_message\_data, attlist}
\index{signature, element}
\index{originString, element}
\index{originLocationString, element}
\index{destinationString, element}
\index{destinationLocationString, element}
Data and settings about the route to send in a message.

\begin{xmltable}
  \xmldesc{ route\_id }{ string }{ The id of the route. }
  \xmldesc{ signature }{ string }{ A text that is placed last in the message. }
  \xmldesc{ originString }{ string }{ A text describing the origin of the route,
    such as the name of the origin. }
  \xmldesc{ originLocationString }{ string }{ A text describing the origin's
    location, such as the name of the origin city. }
  \xmldesc{ destinationString }{ string }{ A text describing the destination of
    the route. }
  \xmldesc{ destinationLocationString }{ string }{ A text describing the
    destination's  location. }
\end{xmltable}


\begin{verbatim}
<!ELEMENT local_map_sms_settings ( phone_manufacturer, phone_model ) >
\end{verbatim}
\index{local\_map\_sms\_settings, element}
The settings needed to send a local map sms, i.e., an URL to a local map. See section \ref{api:localmapdataelement} for a description of the \emph{local\_map\_data} element.

\begin{verbatim}
<!ELEMENT wayfinder_destination_sms ( position_item, signature? ) >
<!ATTLIST wayfinder_destination_sms description CDATA #REQUIRED >
\end{verbatim}
\index{wayfinder\_destination\_sms, element}
A Wayfinder destination sms to send to a cellular with Wayfinder program
installed. The description text will be truncated to fit into a single sms.

\begin{verbatim}
<!ELEMENT wayfinder_route_sms ( position_item, position_item, signature? ) >
<!ATTLIST wayfinder_route_sms orig_description CDATA #REQUIRED 
                              dest_description CDATA #REQUIRED >
\end{verbatim}
\index{wayfinder\_route\_sms, element}
A Wayfinder route sms to send to a cellular with Wayfinder program
installed. The description text will be truncated to fit into a single sms.

\begin{xmltable}
  \xmldesc{ position\_item }{ }{ First node is position of origin the second
    node is the destination. }
  \xmldesc{ signature }{ string }{ A signature to the message. }
  \xmldesc{ orig\_description }{ string }{ origin description. }
  \xmldesc{ dest\_description }{ string }{ destination description. }
\end{xmltable}

\begin{verbatim}
<!ELEMENT wayfinder_favourite_sms ( position_item, name, short_name, 
                                    category_name, map_icon_name, 
                                    signature? )>
<!ATTLIST wayfinder_favourite_sms description CDATA #REQUIRED >
<!ELEMENT short_name ( #PCDATA ) >
<!ELEMENT category_name ( #PCDATA ) >
<!ELEMENT map_icon_name ( #PCDATA ) >
\end{verbatim}
\index{wayfinder\_favourite\_sms, element}
A Wayfinder favourite sms to send to a cellular with Wayfinder program
installed. The description text will be truncated to fit into a single sms.

\begin{xmltable}
  \xmldesc{ position\_item }{ }{ Position of the favorite. }
  \xmldesc{ name }{ string }{ Name of the favorite. }
  \xmldesc{ short\_name }{ string }{ Short version of the name. }
  \xmldesc{ category\_name }{ string }{ Category name for the favorite. }
  \xmldesc{ map\_icon\_name }{ string }{ Name of the map icon. }
  \xmldesc{ signature }{ string }{ A signature to be appended to the sms. }
\end{xmltable}

\subsection{Send SMS Reply}

\begin{verbatim}
<!ELEMENT send_sms_reply ( status_code, status_message, 
                           status_code_extended? )>
<!ATTLIST send_sms_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{send\_sms\_reply, element}
\index{send\_sms\_reply, attlist}
The reply to a \emph{send\_sms\_request} with the result status of
the sending process.




\section{User Login, Verify and Logout}

\subsection{User Login}

\begin{verbatim}
<!ELEMENT user_login_request ( user_name, user_password, 
                               user_service? ) >
<!ATTLIST user_login_request
             transaction_id ID          #REQUIRED
             user_create_session %bool; "false"
             client_type         CDATA  #IMPLIED
             client_type_options CDATA  #IMPLIED >
<!ELEMENT user_name ( #PCDATA ) >
<!ELEMENT user_password ( #PCDATA ) >
\end{verbatim}
\index{user\_login\_request, element}
\index{user\_login\_request, attlist}
\index{user\_name, element}
\index{user\_password, element}
Log in a user using a user name and a password. Optionally the intended 
service can be set.

\begin{xmltable}
  \xmldesc{ user\_name }{ string }{ User name. }
  \xmldesc{ user\_password }{ string }{ Password. }
  \xmldesc{ user\_service }{ string }{ The intended service. }
  \xmldesc{ user\_create\_session }{ boolean }{ If true then session data is
    returned in the reply of a successful login request. }
\end{xmltable}

\begin{verbatim}
<!ELEMENT user_login_reply ( status_code, status_message, 
                             status_code_extended?,
                             user_session_id?, user_session_key? ) >
<!ATTLIST user_login_reply transaction_id ID #REQUIRED>
<!ELEMENT user_session_id ( #PCDATA ) >
<!ELEMENT user_session_key ( #PCDATA ) >
\end{verbatim}
\index{user\_login\_reply, element}
\index{user\_login\_reply, attlist}
\index{user\_session\_id, element}
\index{user\_session\_key, element}
The reply to a \emph{user\_login\_request} with the status of the login and 
optionally a session that can be used in \emph{user\_verify\_requests}.
\\[3mm]

\subsection{User Verify}

\begin{verbatim}
<!ELEMENT user_verify_request ( user_session_id, user_session_key ) >
<!ATTLIST user_verify_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{user\_verify\_request, element}
\index{user\_verify\_request, attlist}
Request for verifying a session from a \emph{user\_login\_reply}.
\\[3mm]

\begin{verbatim}
<!ELEMENT user_verify_reply ( status_code, status_message, 
                              status_code_extended? ) >
<!ATTLIST user_verify_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{user\_verify\_reply, element}
\index{user\_verify\_reply, attlist}
The status of a \emph{user\_verify\_request}.

\subsection{User Logout}

\begin{verbatim}
<!ELEMENT user_logout_request ( user_session_id, user_session_key ) >
<!ATTLIST user_logout_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{user\_logout\_request, element}
\index{user\_logout\_request, attlist}
Request for ending a session.
\\[3mm]

\begin{verbatim}
<!ELEMENT user_logout_reply ( status_code, status_message, 
                              status_code_extended? ) >
<!ATTLIST user_logout_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{user\_logout\_reply, element}
\index{user\_logout\_reply, attlist}
The status of a \emph{user\_logout\_request}.




\section{Map}

\subsection{Map Request}
\label{api:MapRequest}

\begin{verbatim}
<!ELEMENT map_request ( map_request_header, map_symbol_list? ) >
<!ATTLIST map_request transaction_id ID #REQUIRED>
<!ELEMENT map_request_header ( boundingbox, image_settings?,
                               route_data?, phone_position? ) >
<!ATTLIST map_request_header 
             image_width  %number; "400"
             image_height %number; "400"
             image_default_format %route_image_format_t; "png"
             image_display_type %image_display_type; "std"
             showMap            %bool;   "true"
             showTopographMap   %bool;   "true"
             showPOI            %bool;   "true"
             showRoute          %bool;   "true"
             showScale          %bool;   "false"
             showTraffic        %bool;   "false" >
<!ELEMENT route_data ( route_id, route_turn? ) >
<!ELEMENT route_id ( #PCDATA ) >
<!ELEMENT route_turn ( #PCDATA ) >
<!ELEMENT map_symbol_list ( map_symbol_item+ ) >
<!ELEMENT map_symbol_item ( position_item, name ) >
<!ATTLIST map_symbol_item href %HREF; #REQUIRED>
\end{verbatim}
\index{map\_request, element}
\index{map\_request, attlist}
\index{map\_request\_header, element}
\index{map\_request\_header, attlist}
\index{route\_data, element}
\index{route\_id, element}
\index{route\_turn, element}
\index{map\_symbol\_list, element}
\index{map\_symbol\_item, element}
\index{map\_symbol\_item, attlist}
A request for a map image.
Optionally a route and turn and/or phone position can be added to the map.
The optional route is specified in a \emph{route\_data} element by the \emph{route\_id} from a previous \emph{route\_reply}.
The optional phone position is specified with a \emph{phone\_position} element.

If you wish to specify an area using a center point of a circle and its' radius, you can calculate the enclosing bounding box of the circle and use that boundingbox in a \emph{map\_request}.
\\[3mm]

\subsection{Map Reply}

\begin{verbatim}
<!ELEMENT map_reply ( href | ( status_code, status_message, 
                               status_code_extended? ) ) >
<!ATTLIST map_reply transaction_id ID #REQUIRED>
<!ELEMENT href ( #PCDATA )>
\end{verbatim}
\index{map\_reply, element}
\index{map\_reply, attlist}
\index{href, element}
The reply to a map request with either a URI to the map image or a status
message describing the reason why it isn't a map URI.

It is true that the format of the URI is more or less straight forward to understand. However, we recommend using the XML API for posting requests for maps. The XML server then assembles a correct URL for the current format used by the HTTP server. We recommend that the URL format is not used directly to assemble custom requests. The URL format is subject to change without notice at any time, whereas the XML API is not. We thus discourage the use of the URL map request format directly without the use of the XML server.


\section{Point of Interest}

\subsection{POI Info Request}

\begin{verbatim}
<!ELEMENT poi_info_request ( search_item, language ) >
<!ATTLIST poi_info_request transaction_id ID #REQUIRED
                           position_system %position_system_t; "MC2"
                           include_category_id %bool; "false"
                           include_full_search_item %bool; "false""
                           use_persistent_ids %bool; "false" >
\end{verbatim}
\index{poi\_info\_request, element}
\index{poi\_info\_request, attlist}
Request for information about a specific pointofinterest.
The \emph{position\_system} is the desired coordinate format in the reply.
If \emph{include\_category\_id} is set to true the reply will contain the
\emph{category\_list} node.
If \emph{include\_full\_search\_iitem} is set to true the reply will contain 
the \emph{search\_item} node and \emph{heading} attribute.
\emph{ use\_persistent\_ids } Do not use this unless told to do so as turnig it on will change the ids in the results in a way that they will not work if used in a request.

\subsection{POI Info Reply}

\begin{verbatim}
<!ELEMENT poi_info_reply ( info_item* | ( status_code, status_message, 
                                          status_code_extended? ) ) >
<!ATTLIST poi_info_reply transaction_id ID #REQUIRED>
<!ELEMENT info_item ( typeName, itemName, lat?, lon?, category_list?,
                      info_field*, search_item? )>
<!ATTLIST info_item numberfields %number; #REQUIRED
                    heading %number; #IMPLIED >
<!ELEMENT typeName ( #PCDATA )>
<!ELEMENT itemName ( #PCDATA )>
<!ELEMENT info_field ( fieldName, fieldValue ) >
<!ATTLIST info_field info_type %poi_info_t; #IMPLIED >
<!ELEMENT fieldName ( #PCDATA )>
<!ELEMENT fieldValue ( #PCDATA )>
\end{verbatim}
\index{poi\_info\_reply, element}
\index{poi\_info\_reply, attlist}
\index{info\_item, element}
\index{info\_item, attlist}
\index{typeName, element}
\index{itemName, element}
\index{info\_field, element}
\index{info\_type, attribute}
\index{fieldName, element}
\index{fieldValue, element}
% xxx to be explained
The reply to a \emph{poi\_info\_request} with the information about the POI(s) 
requested.

\begin{xmltable}
  \xmldesc{ typeName }{ string }{ The name of the type of item, such as,
    ``Petrol Station''. }
  \xmldesc{ itemName }{ string }{ The name of the item. }
  \xmldesc{ info\_field }{ }{ A list of pairs (\emph{info\_field} elements)
    giving additional information. One pair consists of a \emph{fieldName} and
    a \emph{fieldValue}. The type of field is in the \emph{info\_type}
    attribute. }
\end{xmltable}


\section{Simple POI Description}

\subsection{Simple POI Description Request}
\begin{verbatim}
<!ELEMENT simple_poi_desc_request EMPTY >
<!ATTLIST simple_poi_desc_request transaction_id ID #REQUIRED 
                                  crc %hex_t; #REQUIRED >
\end{verbatim}
\index{simple\_poi\_desc\_request, element}
\index{simple\_poi\_desc\_request, attlist}

Request for simple poi description.

\subsection{Simple POI Description Reply}
\begin{verbatim}
<!ELEMENT simple_poi_desc_reply ( simple_poi_desc_data | crc_ok ) >
<!ATTLIST simple_poi_desc_reply transaction_id ID #REQUIRED
                                crc %hex_t; #REQUIRED  > 

\end{verbatim}
\index{simple\_poi\_desc\_reply, element}
\index{simple\_poi\_desc\_reply, attlist}

Reply to \emph{simple\_poi\_desc\_request}. Will reply with \emph{crc\_ok} if
crc matches else it will reply with encoded data and crc.

\begin{verbatim}
<!ELEMENT simple_poi_desc_data (#PCDATA) >
\end{verbatim}
Contains encoded \emph{simple\_poi\_desc} data. The encoding is determined by
the \emph{te} variable.

\begin{verbatim}
<!ATTLIST simple_poi_desc_data te %te_t; #REQUIRED >
\end{verbatim}
The \emph{te} describes the encoding of the data.

\subsection{CRC OK}

\begin{verbatim}
<!ELEMENT crc_ok EMPTY >
\end{verbatim}
\index{crc\_ok, element}
A tag to indicate that crc for request matches reply.

\section{E-mail}

\subsection{E-mail Request}

\begin{verbatim}
<!ELEMENT email_request ( email_request_header, 
                          (route_message_data | local_map_data) ) >
<!ATTLIST email_request transaction_id ID #REQUIRED>
<!ELEMENT email_request_header ( email_address, subject, 
                                 return_email_address? ) >
<!ATTLIST email_request_header 
                           image_format %route_image_format_t; "png"
                           message_type %message_t; "html" 
                           route_turn_image_type %route_turn_image_t; "map"
                           max_message_size %size_t; "inf"
                           overview_image_width    %size_t; #IMPLIED
                           overview_image_height   %size_t; #IMPLIED
                           route_turn_image_width  %size_t; #IMPLIED
                           route_turn_image_height %size_t; #IMPLIED
                           abbreviate_route_names  %bool;   #IMPLIED
                           route_landmarks         %bool;   #IMPLIED
                           route_only_overview     %bool;   #IMPLIED 
                           invite_email            %bool;   #IMPLIED >
<!ELEMENT email_address ( #PCDATA )>
<!ELEMENT subject ( #PCDATA )>
<!ELEMENT return_email_address ( #PCDATA )>

<!ELEMENT local_map_data ( language, signature, boundingbox, 
                           local_map_string, map_symbol_list ) >
<!ELEMENT local_map_string ( #PCDATA ) >
\end{verbatim}
\index{email\_request, element}
\index{email\_request, attlist}
\index{email\_request\_header, element}
\index{email\_request\_header, attlist}
\index{email\_address, element}
\index{subject, element}
\index{return\_email\_address, element}
\index{local\_map\_data, element} \label{api:localmapdataelement}
\index{local\_map\_string, element}
A request for sending an HTML, WML or SMIL email containing a route 
description or a local map.

\begin{xmltable}
  \xmldesc{ email\_address }{ string }{ The address to send the e-mail to. }
  \xmldesc{ subject }{ string }{ The subject of the e-mail. }
  \xmldesc{ return\_email\_address }{ string }{ An optional return e-mail
    address. }
  \xmldesc{ message\_type }{ }{ Selects the type of markup language to use in
    the email, HTML, WML and SMIL is supported and HTML is default. }
  \xmldesc{ route\_turn\_image\_type }{ }{ Selects the type of images to show 
    route turn with either graphical maps or symbolic pictograms. Graphical
    maps is the default. This attribute is only used if the message contains
    a route. }
  \xmldesc{ max\_message\_size }{ }{ Sets the maximum size of a message in bytes.
    The message is split into a number of messages to fit this limit.
    The default value \emph{inf}, infinity, means that there is no limit to 
    the size of the message. The smallest \emph{max\_message\_size} is 30000
    bytes. }
  \xmldesc{ overview\_image\_width }{ integer }{ Route overview and local map
    image width. Default value depends on \emph{message\_type}  }
  \xmldesc{ overview\_image\_height }{ integer }{ Route overview and local
    map image height. Default value depends on \emph{message\_type}. }
  \xmldesc{ route\_turn\_image\_width }{ integer }{ Route turn image width. 
    Default value depends on \emph{message\_type}.  }
  \xmldesc{ route\_turn\_image\_height }{ integer }{ Route turn image height.
    Default value depends on \emph{message\_type}. }
  \xmldesc{ abbreviate\_route\_names }{  }{ Sets if street names in the
    route description should be abbreviated. Default is on. }
  \xmldesc{ route\_landmarks }{ }{ Sets if landmarks should be in the
    route description. Default is on. }
  \xmldesc{ route\_only\_overview }{ }{ Sets if only an overview image
    should be in the route description, no pictograms and no map images. 
    Default is off. }
\end{xmltable}

\subsection{E-mail Reply}

\begin{verbatim}
<!ELEMENT email_reply ( status_code, status_message, 
                        status_code_extended? ) >
<!ATTLIST email_reply transaction_id ID #REQUIRED>
\end{verbatim}
\index{email\_reply, element}
\index{email\_reply, attlist}
The reply to an \emph{email\_request} with the status of the request.



\section{SMS Format}

\subsection{SMS Format Request}

\begin{verbatim}
<!ENTITY % sms_version_t "(vicinity|eventfinder)">
<!ELEMENT invite_sms (name) >
<!ATTLIST invite_sms type %sms_version_t; #REQUIRED >
<!ELEMENT place_sms (position_item|(search_item,language)) >
<!ATTLIST place_sms type %sms_version_t; #REQUIRED >
<!ELEMENT sms_format_request ( (smsmessage, phone_manufacturer, phone_model) |
                               (route_sms_message, route_message_data) |
                               (wayfinder_destination_sms) |
                               (wayfinder_route_sms) |
                               (wayfinder_favourite_sms) | invite_sms | place_sms ) >
<!ATTLIST sms_format_request transaction_id ID #REQUIRED
                             wayfinder_sms_version CDATA "1">

\end{verbatim}
\index{sms\_format\_request, element}
\index{sms\_format\_request, attlist}
\index{invite\_sms, element}
\index{place\_sms, element}
A request for formatting a route description or any text for SMS.
This includes splitting the message into several SMSes.
The splitting uses SMS concatenation depending on whether the \emph{phone\_model} supports it.
This request can also make a \emph{Wayfinder} destination SMS.
If element \emph{invite\_sms} exist, then an invite sms will be created and
returned for the specific invite type.
If element \emph{place\_sms} exist, then a place sms will be create and
returned for the specific place type and position.
The \emph{search\_item} element is only valid for \emph{gigfinder}
\emph{type}.

\subsection{SMS Format Reply}

\begin{verbatim}
<!ELEMENT sms_format_reply ( (status_code, status_message, 
                              status_code_extended?) |
                             sms_list )>
<!ATTLIST sms_format_reply transaction_id ID #REQUIRED>
<!ELEMENT sms_list ( smsmessage )>
\end{verbatim}
\index{sms\_format\_reply, element}
\index{sms\_format\_reply, attlist}
\index{sms\_list, element}
The reply to an \emph{sms\_format\_request} with the formatted SMSes or a status message describing the error.




\section{Sort by Distance}

\subsection{Sort Dist Request}

\begin{verbatim}
<!ELEMENT sort_dist_request ( (position_item | search_item),
                              (routeable_item_list | all_favorites) ) >
<!ATTLIST sort_dist_request 
                       transaction_id ID #REQUIRED
                       max_number_reply_items %number; "1"
                       sort_distance %sort_distance_t; "radius"
                       route_cost %route_cost_t; "time"
                       position_system %position_system_t; "MC2"
                       route_vehicle %route_vehicle_t; "passengercar" >
<!ELEMENT all_favorites ( (user_id | 
                           (user_session_id, user_session_key) ) )>
\end{verbatim}
\index{sort\_dist\_request, element}
\index{sort\_dist\_request, attlist}
A request for sort a set of routeable items or all favorites for a user by
their distance from an origin. 

\begin{xmltable}
  \xmldesc{ position\_item \\ search\_item }{}{ The origin to count
    distances from. }
  \xmldesc{ routeable\_item\_list \\ all\_favorites }{}{ The 
    destination(s) to sort. Either a list of routeable items or all favorites
    for a user. }
  \xmldesc{ max\_number\_reply\_items }{ integer }{ The number of sorted 
    \emph{sort\_dist\_item}s in the reply. The number of items in the reply is
    never larger than this value or the number of items to sort. }
  \xmldesc{ sort\_distance }{ }{ The type of distance to sort by, see entity 
    definition Section \ref{sort_distance_t}. }
  \xmldesc{ route\_cost }{ }{ Used when \emph{sort\_distance} is \emph{route}
    to determine how to sort routes. }
  \xmldesc{ position\_system }{ }{ Determines the coordinate system to use in
    the reply. }
  \xmldesc{ route\_vehicle }{ }{ Used when \emph{sort\_distance} is 
    \emph{route} to select the vehicle type. }
\end{xmltable}


\subsection{Sort Dist Reply}

\begin{verbatim}
<!ELEMENT sort_dist_reply ( (sort_dist_list) |
                            ( status_code, status_message, 
                              status_code_extended? ) ) >
<!ATTLIST sort_dist_reply transaction_id ID #REQUIRED>
<!ELEMENT sort_dist_list ( sort_dist_item+ )>
<!ELEMENT sort_dist_item ( (position_item | search_item | favorite) ) >
<!ATTLIST sort_dist_item 
                      distance %number; #REQUIRED
                      estimated_time %number; #IMPLIED>
\end{verbatim}
\index{sort\_dist\_reply, element}
\index{sort\_dist\_reply, attlist}
\index{sort\_dist\_list, element}
\index{sort\_dist\_item, element}
The reply to an \emph{sort\_dist\_request} with the sorted items.

\begin{xmltable}
  \xmldesc{ sort\_dist\_list }{ }{ The list of sorted \emph{sort\_dist\_item}s. }
  \xmldesc{ sort\_dist\_item }{ }{ A sorted item containing the distance and
    the corresponding item from the request. }
\end{xmltable}


\section{Top Region}

\subsection{Top Region Request}

\begin{verbatim}
<!ELEMENT top_region_request ( top_region_request_header ) >
<!ATTLIST top_region_request transaction_id ID #REQUIRED >
<!ELEMENT top_region_request_header ( language ) >
<!ATTLIST top_region_request_header 
                     position_system %position_system_t; "MC2"
                     country             %bool; "true"
                     state               %bool; "false"
                     internationalRegion %bool; "false"
                     metaregion          %bool; "false" >
\end{verbatim}
\index{top\_region\_request, element}
\index{top\_region\_request, attlist}
\index{top\_region\_request\_header, element}
A request for getting all of the top regions.
The \emph{top\_region\_request\_header} contains the prefered language
of the top regions and the coordiante system to show boundingboxes in.

\begin{xmltable}
  \xmldesc{ country }{ boolean }{ Should countries be returned in reply. }
  \xmldesc{ state }{ boolean }{  Should states be returned in reply. }
  \xmldesc{ internationalRegion }{ boolean }{ Should international regions be
    returned in reply. }
  \xmldesc{ metaregion }{ boolean }{ Should meta regions be returned in reply. }
\end{xmltable}


\subsection{Top Region Reply}

\begin{verbatim}
<!ELEMENT top_region_reply ( top_region_list | 
                             ( status_code, status_message, 
                               status_code_extended? ) )>
<!ATTLIST top_region_reply transaction_id ID #REQUIRED>
<!ELEMENT top_region_list ( top_region* )>
<!ATTLIST top_region_list numberitems %number; #REQUIRED>
\end{verbatim}
\index{top\_region\_reply, element}
\index{top\_region\_reply, attlist}
\index{top\_region\_list, element}
\index{top\_region\_list, attlist}
The reply to an \emph{top\_region\_request} with the top regions.
If an error occurred then a \emph{status\_code} and 
\emph{status\_message} is returned.
A top region can be used in the \emph{search\_request} to select in
which top region to search.

\begin{xmltable}
  \xmldesc{ top\_region\_list }{ }{ The list of \emph{top\_region}s. }
\end{xmltable}


\section{Zoom Settings}
Lists zoom settings in the server.

\subsection{Zoom Settings Request}
\begin{verbatim}
<!ELEMENT zoom_settings_request EMPTY >
<!ATTLIST zoom_settings_request transaction_id ID #REQUIRED
                                crc %hex_t; #REQUIRED 
                                pixel_size %number; #IMPLIED >
\end{verbatim}
\index{zoom\_settings\_request, element}
\index{zoom\_settings\_request, attlist}
Requests zoom settings from the server.
\begin{xmltable}
  \xmldesc{ crc }{ }{ Hexadecimal checksum from a previous request, or empty }
  \xmldesc{ pixel\_size }{ integer }{ Request a specific projection
    tile size. Valid values are 180 or 256. Default is 180. }
\end{xmltable}

\subsection{Zoom Settings Reply}
\begin{verbatim}
<!ELEMENT zoom_settings_reply (zoom_levels | crc_ok ) >
<!ATTLIST zoom_settings_reply transaction_id ID #REQUIRED >
\end{verbatim}
\index{zoom\_settings\_reply, element}
\index{zoom\_settings\_reply, attlist}
The reply to an \emph{zoom\_settings\_request}. If crc matches server
zoom\_settings crc then the reply to this request is
\emph{crc\_ok} else there will be a list of \emph{zoom\_levels}.

\begin{verbatim}
<!ELEMENT zoom_levels (zoom_level+)>
<!ATTLIST zoom_levels crc %hex_t; #REQUIRED
                      nbr_zoom_levels %number; #REQUIRED
                      pixel_size %number; #REQUIRED>
\end{verbatim}
\index{zoom\_levels, element}
\index{zoom\_levels, attlist}
A list of \emph{zoom\_levels} and the corresponding crc.

\begin{verbatim}
<!ELEMENT zoom_level EMPTY>
<!ATTLIST zoom_level max_x %number; #REQUIRED 
                     max_y %number; #REQUIRED
                     min_x %number; #REQUIRED
                     min_y %number; #REQUIRED
                     zoom_level_nbr %number; #REQUIRED
                     zoom_j2me %bool; #IMPLIED>
\end{verbatim}
\index{zoom\_level, element}
\index{zoom\_level, attlist}
The zoom level with level number \emph{zoom\_level\_nbr} and its bounding box.

\begin{verbatim}
<!ELEMENT zoom_settings_crc_ok EMPTY >
\end{verbatim}
\index{zoom\_settings\_crc\_ok, element}
Answer to a \emph{zoom\_settings\_request} that has the the same crc as the
server \emph{zoom\_settings}.


\section{Phone manufacturer}

This request is a simple query for all phone manufacturers.

\subsection{Phone manufacturer Request}

\begin{verbatim}
<!ELEMENT phone_manufacturer_request EMPTY >
<!ATTLIST phone_manufacturer_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{phone\_manufacturer\_request, element}
\index{phone\_manufacturer\_request, attlist}
A request for all phone manufacturers.


\subsection{Phone manufacturer Reply}

A reply to a phone manufacturer request with all phone manufacturers.

\begin{verbatim}
<!ELEMENT phone_manufacturer_reply ( phone_manufacturer_list | 
                                     ( status_code, status_message, 
                                       status_code_extended? ) ) >
<!ATTLIST phone_manufacturer_reply transaction_id ID #REQUIRED>
<!ELEMENT phone_manufacturer_list ( phone_manufacturer* )>
\end{verbatim}
\index{phone\_manufacturer\_reply, element}
\index{phone\_manufacturer\_reply, attlist}
\index{phone\_manufacturer\_list, element}
The reply to an \emph{phone\_manufacturer\_request} with all phone 
manufacturers.
If an error occurred then a \emph{status\_code} and 
\emph{status\_message} is returned.



\section{Phone model}

This request is a simple query for all phone models.

\subsection{Phone model Request}

\begin{verbatim}
<!ELEMENT phone_model_request ( phone_manufacturer? ) >
<!ATTLIST phone_model_request transaction_id ID #REQUIRED>
\end{verbatim}
\index{phone\_model\_request, element}
\index{phone\_model\_request, attlist}
A request for all phone models. Optionally for a specific phone 
manufacturer.


\subsection{Phone model Reply}

A reply to a phone model request with all phone models.

\begin{verbatim}
<!ELEMENT phone_model_reply ( phone_model_list | 
                              ( status_code, status_message, 
                                status_code_extended? ) ) >
<!ATTLIST phone_model_reply transaction_id ID #REQUIRED>
<!ELEMENT phone_model_list ( phone_model* )>
\end{verbatim}
\index{phone\_model\_reply, element}
\index{phone\_model\_reply, attlist}
\index{phone\_model\_list, element}
The reply to an \emph{phone\_model\_request} with all phone 
requested models.
If an error occurred then a \emph{status\_code} and 
\emph{status\_message} is returned.


\section{User track}

This request is for tracking a person.

\subsection{User track Request}

\begin{verbatim}
<!ELEMENT user_track_request ( user_id | uin |
                               (user_session_id, user_session_key) ) >
<!ATTLIST user_track_request transaction_id ID #REQUIRED
                             start_time %time_t; #IMPLIED
                             end_time %time_t; #IMPLIED
                             max_nbr_tracks %size_t; "1"
                             position_system %position_system_t; "MC2" >
\end{verbatim}
\index{user\_track\_request, element}
\index{user\_track\_request, attlist}
A request for getting the track entries for a user between two times.
The \emph{user\_track\_request} attributes are start and end time for 
which to show log entries, the maximum number of track items to return and
the coordinate system to show coordinates in.
The user can be identified by \emph{user\_id}, \emph{uin} or by 
\emph{user\_session\_id} and \emph{user\_session\_key}.


\subsection{User track Reply}

\begin{verbatim}
<!ELEMENT user_track_reply ( ( user_track_item* ) |
                             ( status_code, status_message, 
                               status_code_extended? ) ) >
<!ATTLIST user_track_reply transaction_id ID #REQUIRED>
<!ELEMENT user_track_item ( position_item ) >
<!ATTLIST user_track_item 
                      time    %time_t;     #REQUIRED
                      dist    %number;     #IMPLIED
                      speed   %number;     #IMPLIED
                      source  CDATA        #REQUIRED >
\end{verbatim}
\index{user\_track\_reply, element}
\index{user\_track\_reply, attlist}
\index{user\_track\_item, element}
\index{user\_track\_item, attlist}
The reply to an \emph{user\_track\_request} with the track entries.
If an error occurred then a \emph{status\_code} and 
\emph{status\_message} is returned.
The \emph{dist} attribute is the number of centimeters traveled from the last
\emph{user\_track\_item}.
The \emph{speed} attribute is in meter per second times 32.
Time when Track point was made. If sent to server and < 100000000 then
used as time before now.


\section{User track add}

This request is for adding track points to a user.

\subsection{User track add Request}

\begin{verbatim}
<!ELEMENT user_track_add_request ( ( user_id | uin |
                                     (user_session_id, user_session_key) ), 
                                   user_track_item+ ) >
<!ATTLIST user_track_add_request transaction_id ID #REQUIRED >
\end{verbatim}
\index{user\_track\_add\_request, element}
\index{user\_track\_add\_request, attlist}
Request for adding one or more track points to a user.
The user can be identified by \emph{user\_id}, \emph{uin} or by 
\emph{user\_session\_id} and \emph{user\_session\_key}.


\subsection{User track add Reply}

Reply to a user track add request with the status of the operation.

\begin{verbatim}
<!ELEMENT user_track_add_reply ( status_code, status_message, 
                                 status_code_extended? ) >
<!ATTLIST user_track_add_reply transaction_id ID #REQUIRED >
\end{verbatim}
\index{user\_track\_reply, element}
\index{user\_track\_reply, attlist}
The reply to an \emph{user\_track\_add\_request} with the status of the
operation in \emph{status\_code} and \emph{status\_message}.



\section{User debit log}

This request is for showing a users debit log.

\subsection{User debit log request}

\begin{verbatim}
<!ELEMENT user_debit_log_request ( user_id | 
                                   (user_session_id, user_session_key) ) >
<!ATTLIST user_debit_log_request 
                                   transaction_id ID       #REQUIRED
                                   start_time     %time_t; #REQUIRED
                                   end_time       %time_t; #REQUIRED
                                   start_index    %size_t; "0"
                                   end_index      %size_t; "99" >
\end{verbatim}
\index{user\_debit\_log\_request, element}
\index{user\_debit\_log\_request, attlist}
A request for showing the debit log for a user between two times.
The \emph{user\_debit\_log\_request} attributes are start and end time for 
which to show log entries, the start and end index among the log entries.
The user can be identified by \emph{user\_id} or by 
\emph{user\_session\_id} and \emph{user\_session\_key}.


\subsection{User debit log reply}

\begin{verbatim}
<!ELEMENT user_debit_log_reply ( ( user_debit_log_element* ) |
                                   ( status_code, status_message, 
                                     status_code_extended? ) ) >
<!ATTLIST user_debit_log_reply transaction_id ID       #REQUIRED
                               start_index    %size_t; #REQUIRED
                               end_index      %size_t; #REQUIRED
                               total_number_elements %size_t; #REQUIRED >
<!ELEMENT user_debit_log_element EMPTY >
<!ATTLIST user_debit_log_element 
                                   message_id    %number; #REQUIRED
                                   debit_info    %number; #REQUIRED
                                   time          %time_t; #REQUIRED
                                   operationType %number; #REQUIRED
                                   sentSize      %size_t; #REQUIRED
                                   userOrigin    CDATA    #REQUIRED
                                   serverID      CDATA    #REQUIRED
                                   description   CDATA    #REQUIRED >
\end{verbatim}
\index{user\_debit\_log\_reply, element}
\index{user\_debit\_log\_reply, attlist}
\index{user\_debit\_log\_element, element}
\index{user\_debit\_log\_element, attlist}
The reply to an \emph{user\_debit\_log\_request} with the debit log
entries.
If an error occurred then a \emph{status\_code} and 
\emph{status\_message} is returned.




\section{User find}

This request is for finding users from a set of search parameters.

\subsection{User find request}

\begin{verbatim}
<!ELEMENT user_find_request ( user ) >
<!ATTLIST user_find_request transaction_id ID #REQUIRED >
\end{verbatim}
\index{user\_find\_request, element}
\index{user\_find\_request, attlist}
A request for finding users matching the values sent in the 
\texttt{user} element. The values in the \texttt{user} element is the
ones that the user should have to match. The password is not matched.
In a user's \texttt{phone} element only the \texttt{phone\_number} is
used when matching.



\subsection{User find reply}

The reply contains the \texttt{user\_id}s of the users that match the 
request.

\begin{verbatim}
<!ELEMENT user_find_reply ( (user_id,uin)* | 
                            (user_session_id, user_session_key) ) >
<!ATTLIST user_find_reply transaction_id ID #REQUIRED >
\end{verbatim}
\index{user\_find\_reply, element}
\index{user\_find\_reply, attlist}
The reply to an \emph{user\_find\_request} with the 
\texttt{user\_id} and \texttt{uin}s of the users that match the request.
If an error occurred then a \emph{status\_code} and 
\emph{status\_message} is returned.




\section{Transactions}

This request is for changing and showing a user's transactions count.

\subsection{Transactions request}

\begin{verbatim}
<!ELEMENT transactions_request ( (user_id | 
                                  (user_session_id, 
                                   user_session_key))? ) >
<!ATTLIST transactions_request 
                       transaction_id ID #REQUIRED
                       uin CDATA #IMPLIED
                       transaction_change %number; #IMPLIED >
\end{verbatim}
\index{transactions\_request, element}
\index{transactions\_request, attlist}
The user can be identified in three different ways. First using the
\emph{user\_id}, secondly using a \emph{user\_session\_id} and 
\emph{user\_session\_key} and thirdly from an \emph{uin}.

The \emph{transaction\_change} tells the amount of transactions to add or
remove if negative.



\subsection{Transactions reply}

The reply to an \emph{Transactions request} with the current amount of 
transactions.

\begin{verbatim}
<!ELEMENT transactions_reply ( status_code, status_message, 
                               status_code_extended? ) >
<!ATTLIST transactions_reply transaction_id ID #REQUIRED
                             nbr_transactions %number; #IMPLIED >
\end{verbatim}
\index{transactions\_reply, element}
\index{transactions\_reply, attlist}
The reply to an \emph{Transactions request} with the status of the 
operation and the current amount of transactions if ok.




\section{Transaction days}

This request is for changing and showing a user's transaction days.

\subsection{Transaction days request}

\begin{verbatim}
<!ELEMENT transaction_days_request ( 
   (user_id | (user_session_id, user_session_key))? ) >
<!ATTLIST transaction_days_request 
                      transaction_id     ID       #REQUIRED
                      uin                CDATA    #IMPLIED
                      check              %bool;   #IMPLIED
                      transaction_change %number; #IMPLIED >
\end{verbatim}
\index{transaction\_days\_request, element}
\index{transaction\_days\_request, attlist}
The user can be identified in three different ways. First using the
\emph{user\_id}, secondly using a \emph{user\_session\_id} and 
\emph{user\_session\_key} and thirdly from an \emph{uin}.

The \emph{transaction\_change} tells the amount of transaction days to add or
remove if negative.
The \emph{check} says if to check if a new transaction day is needed and
start it by setting a new \emph{current\_day} and decrease number of
transaction days left.



\subsection{Transaction days reply}

The reply to an \emph{Transaction days request} with the current amount of 
transaction days left and the start of \emph{current\_day}.

\begin{verbatim}
<!ELEMENT transaction_days_reply ( status_code, status_message, 
                                   status_code_extended? ) >
<!ATTLIST transaction_days_reply 
                      transaction_id       ID       #REQUIRED
                      nbr_transaction_days %number; #REQUIRED
                      current_day          %time_t; #REQUIRED >
\end{verbatim}
\index{transaction\_days\_reply, element}
\index{transaction\_days\_reply, attlist}
The reply to an \emph{Transaction days request} with the status of the 
operation and the current amount of transaction days left and 
\emph{current\_day} if ok.




\section{Activation}

This request is for using an activation code.

\subsection{Activation request}

\begin{verbatim}
<!ELEMENT activate_request ( phone_number?, new_password?, 
                             name?, email?, opt_in?,
                             (external_auth | server_auth_bob |
                              handle_me | hardware_id | hardware_key+ )? ) >
<!ATTLIST activate_request      transaction_id     ID       #REQUIRED
                                activation_code    CDATA    #IMPLIED 
                                uin                CDATA    #IMPLIED
                                may_use            %bool;   "true"
                                create_new_token   %bool;   "true"
                                top_region_id      %number; #IMPLIED >
<!ELEMENT email ( #PCDATA ) >
<!ELEMENT opt_in EMPTY>
<!ATTLIST opt_in name CDATA #REQUIRED>
<!ELEMENT external_auth EMPTY>
<!ATTLIST external_auth type CDATA #REQUIRED>
<!ELEMENT handle_me ( licence_key? ) >
<!ATTLIST handle_me >
<!ELEMENT licence_key EMPTY>
<!ATTLIST licence_key key CDATA #REQUIRED >
<!ELEMENT hardware_id ( #PCDATA ) >
<!ATTLIST hardware_id type %hardware_key_type_t; #REQUIRED >
<!ELEMENT hardware_key ( #PCDATA ) >
<!ATTLIST hardware_key type %hardware_key_type_t; #REQUIRED >
\end{verbatim}
\index{activate\_request, element}
\index{activate\_request, attlist}

\begin{xmltable}
  \xmldesc{ phone\_number }{ string }{ Added to user if not already present and
    not in other user. }
  \xmldesc{ new\_password }{ string }{ The new password for the user. }
  \xmldesc{ name }{ string }{ Name for the user. }
  \xmldesc{ email }{ string }{ Email address for the user. }
  \xmldesc{ opt\_in }{ }{ The optional thing the user has accepted, name
    specifies what the user has opt:ed in on. }
  \xmldesc{ external\_auth }{ }{ Used if client is authenticated via external
    entity. }
  \xmldesc{ activation\_code }{ string }{ The activation code to use. If left
    out some other method of authenticating must be sent, such as hardware\_id
    or external\_auth. }
  \xmldesc{ uin }{ integer }{ The uin of the user activating. May be left
    out. }
  \xmldesc{ may\_use }{ boolean }{ If the activation code may be used, default
    true. If \emph{may\_use} is set to false the server will not consume an
    unused activation code. }
  \xmldesc{ create\_new\_token }{ }{ If to create a new token for the user,
    default true. }
  \xmldesc{ top\_region\_id }{ integer }{ The selected region if activation
    code needs it, default not set. }
  \xmldesc{ handle\_me }{ }{  If to let the server create a user
    account. Errorcode -213 if server may not create an account. This is
    retained for existing clients but won't be used for new ones. }
  \xmldesc{ hardware\_id }{ string }{ A string representing some hardware
    unique key. There are no requirements on formatting and server may use
    normalized forms for storing and comparing. }
  \xmldesc{ hardware\_key }{ }{ Contains unique hardware keys identifying the
    device the client is on. }
\end{xmltable}

\begin{verbatim}
<!ENTITY % hardware_key_type_t "(imei|btmac|bbpin|imsi|esn|
                                 phone_msisdn|iphone_dev_id|
                                 customer_msisdn)">
\end{verbatim}
The type of hardware key.

\begin{valuetable}
  \valuedesc{ imei }{ IMEI of the terminal }
  \valuedesc{ btmac }{ Bluetooth MAC address. Used on non-blackberry 
    devices that have hardware bluetooth but no possibility for unsigned
    applications to retrieve IMEI. E.g. Nokia S40v3. }
  \valuedesc{ bbpin }{ On RIM Blackberry terminals the PIN is used. This
    is not the user's simcard PIN but a rather a IMEI for
    Blackberries. Blackberries in non-GSM-networks (e.g. IDEN) do not
    have IMEI but they always have a unique PIN. }
  \valuedesc{ imsi }{ International Mobile Subscriber Identity. }
  \valuedesc{ esn }{ Electronic Serial Number. CDMA's equivalent of IMEI.}
  \valuedesc{ phone\_msisdn }{ An MSISDN, could be entered by the user and thus may not be 100\%
    correct. }
  \valuedesc{ iphone\_dev\_id }{ iPhone hardware key. }
  \valuedesc{ customer\_msisdn }{ An MSISDN, ok to use for billing purposes etc. }
\end{valuetable}


\subsection{Activate reply}

The reply to an \emph{Activate request} with the result of the activation.
%
~\\
The status codes that may be returned in an activate reply:

\begin{statustable}
  \statusdesc{ -301 }{ Too short password. The new password is too short. }
  \statusdesc{ -302 }{ Bad activation code. The activation code does not exist. }
  \statusdesc{ -303 }{ Used activation code. The activation code is used. }
  \statusdesc{ -304 }{ Wrong phone number. The phonenumber is not valid. }
  \statusdesc{ -305 }{ Extension not allowed. Must have previous activation to be 
    able to extend. }
  \statusdesc{ -306 }{ Creation not allowed. May not create new user with this 
    activation code. }
  \statusdesc{ -307 }{ May not use activation code. Attribute \emph{may\_use} is
    false and activation code is not used. }
  \statusdesc{ -308 }{ Invalid email. Not valid email address. }
  \statusdesc{ -309 }{ Moving of license key prohibited. At least one of the
    users may not change license key. }
  \statusdesc{ -310 }{ Neither uin, activation\_code nor hardware\_id included in
    request. }
  \statusdesc{ -311 }{ License key owned by more than one user. The hardware\_id
    in the request is owned by several users and we cannot determine
    which to use. }
\end{statustable}


\begin{verbatim}
<!ELEMENT activate_reply ( ( user_id?, auth_token? ) |
                           ( status_code, status_message, 
                             status_code_extended? ) ) >
<!ATTLIST activate_reply  transaction_id       ID       #REQUIRED
                          uin                  CDATA    #IMPLIED >
<!ELEMENT auth_token ( #PCDATA ) >
\end{verbatim}
\index{activate\_reply, element}
\index{activate\_reply, attlist}

\begin{xmltable}
  \xmldesc{ user\_id }{  }{ The current user id of the user. }
  \xmldesc{ auth\_token }{ }{ The new authentication token. }
\end{xmltable}

\section{External Services}

\subsection{ External services request }

Request to be used e.g. on client startup to get the list of available
services.

\begin{verbatim}
<!ELEMENT ext_services_request EMPTY>
<!ATTLIST ext_services_request  transaction_id     ID           #REQUIRED
                                crc                CDATA        #IMPLIED
                                language           %language_t; #REQUIRED
                                new_client         %bool; "false" >
\end{verbatim}

The \emph{crc} is the crc that the client received the last time it
asked for the list of external services. If no list has been received
and empty crc should be ent.
The \emph{language} is the language as described elsewhere in this
document. It will affect the names of the services and the names of
the fields returned in the reply.
The \emph{new\_client} determines if the list should contain external search 
services which can return \emph{search\_area} hits and has more or less than
two icons in the icon list.

\subsection{External services reply}
\label{sec_ext_search_desc}
Reply to the \emph{ext\_services\_request}. Contains a list of external
services if the crc of the server list differs from the crc sent in
from the client in the request. If the crc matches, a single tag
\emph{ext\_service\_crc\_ok} will be returned.

\begin{verbatim}
<!ELEMENT ext_services_reply ( ext_services_crc_ok |  ext_service* |
                              ( status_code, status_message, 
                                status_code_extended? ) ) >
<!ATTLIST ext_services_reply   crc                  CDATA       #REQUIRED
                               transaction_id       ID          #REQUIRED
                               nbr_services         %number;    #REQUIRED >
\end{verbatim}


\subsection{ External services example }

\subsubsection{ Wrong or no crc in client list }
A client sends the following request.
\begin{verbatim}
<isab-mc2>
   <auth>
      <auth_user>xox</auth_user>
      <auth_passwd>xoxox</auth_passwd>
   </auth>

   <ext_services_request transaction_id="xox" 
                         language="swedish" crc="" />
</isab-mc2>
\end{verbatim}
The server replies with:
\begin{verbatim}
<isab-mc2>
   <ext_services_reply crc="E3870B7C" transaction_id="xox">
      <ext_service service_id="1" type="search">
         <name>Eniro WP Sverige</name>
         <field id="1" req="1" type="choice" nbr_choices="1">
            <field_name>Land</field_name>
            <field_option id="1">
               <field_option_name>Sverige</field_option_name>
            </field_option>
         </field>
         <field id="2" req="1" type="string">
            <field_name>Namn/Telefonnummer</field_name>
         </field>
         <field id="3" req="0" type="string">
            <field_name>Adress/Stad</field_name>
         </field>
      </ext_service>
   </ext_services_reply>
</isab-mc2>
\end{verbatim}

The field descriptions contain the type of the fields which can be
\emph{string}, \emph{number} or \emph{choice}. \emph{String} means any
string, \emph{number} means a positive integer. If the type is
\emph{choice}, the \emph{field} element will be followed by one or more
\emph{field\_option} elements which contain the name of the option and the
id to send back to the server when it has been selected.

The \emph{req} attribute of the \emph{field} elements is used to
describe when all necessary fields have been filled in. The
requirements should be checked by the client before sending an
incomplete request to the server. The algorithm to determine if all
necessary fields are filled in is as follows:
\begin{verbatim}
   ok = all bits set to 1
   foreach field with req != 0:
      if field filled in:
         ok = ok & field.req
      else:
         ok = ok & ^(field.req)
    if ok != 0:
       send_to_server
\end{verbatim}

\subsubsection{ Correct crc in client list }
A client sends the following request.
\begin{verbatim}
<isab-mc2>
   <auth>
      <auth_user>xox</auth_user>
      <auth_passwd>xoxox</auth_passwd>
   </auth>

   <ext_services_request transaction_id="xox2" 
                         language="swedish" crc="E3870B7C" />
</isab-mc2>
\end{verbatim}
The server replies with:
\begin{verbatim}
<isab-mc2>
   <ext_services_reply crc="E3870B7C" transaction_id="xox2">
      <ext_services_crc_ok/>
   </ext_services_reply>
</isab-mc2>
\end{verbatim}

\subsection{External search request}

This is an example of an \emph{external\_search\_request},
see~\ref{sec_dtd} for definition.

\begin{verbatim}
<isab-mc2>
   <auth>
      <auth_user>w</auth_user>
      <auth_passwd>y</auth_passwd>
   </auth>
   <ext_search_request language="swedish"
                       search_item_starting_index="0"
                       search_item_ending_index="10"
                       service_id = "1" 
                       transaction_id="xox4mati">
   <field_val id="1">1</field_val>
   <field_val id="2">2882200</field_val>
</ext_search_request>
</isab-mc2>
\end{verbatim}
The reply is an ordinary search reply or an error message if all
necessary fields weren't correctly filled
in. See~\ref{sec_ext_search_desc} for field information.

\section{Tunnel}

This request is for tunneling internet traffic through the server.

\subsection{Tunnel Request}

\begin{verbatim}
<!ELEMENT tunnel_request ( post_data? ) >
<!ATTLIST tunnel_request   transaction_id     ID       #REQUIRED
                           url                %HREF;   #REQUIRED  >
<!ELEMENT post_data ( #PCDATA ) >
<!ENTITY % te_t "(identity|base64)" >
<!ATTLIST post_data te %te_t; "identity">
\end{verbatim}
\index{tunnel\_request, element}
\index{tunnel\_request, attlist}
Request for retreiving an URL with optional post data.


\subsection{Tunnel Reply}

Reply to a tunnel request with the reply or error reply.

\begin{verbatim}
<!ELEMENT tunnel_reply ( ( header*, body? ) |
                           ( status_code, status_message, 
                             status_code_extended? ) ) >
<!ATTLIST tunnel_reply  transaction_id       ID       #REQUIRED
                        status_line          CDATA    #IMPLIED >
<!ELEMENT header EMPTY>
<!ATTLIST header field CDATA #REQUIRED
                 value CDATA #REQUIRED >
<!ELEMENT body ( #PCDATA ) >
<!ATTLIST body te %te_t; "base64">
\end{verbatim}
\index{tunnel\_reply, element}
\index{tunnel\_reply, attlist}
The reply to a \emph{tunnel\_request} with reply.

\section{POI Review}

The POI Review interfaces enables users to share their thoughts on
POIs delivered through the Wayfinder service. Each user may review and
grade each POI once. The user may change their review at a later time.
Users may see reviews posted by other users, but not change them.

\subsection{POI Review Request}
\begin{verbatim}
<!ELEMENT poi_review_requests ( poi_review_add_request | 
                                poi_review_delete_request |
                                poi_review_list_request )+ >
\end{verbatim}
\index{poi\_review\_request, element}
The POI review request is a container for more specific POI review
actions. Each of the actions is presented in some detail below.

\subsection{POI Review Reply}
\begin{verbatim}
<!ELEMENT poi_review_replies ( poi_review_add_reply | 
                               poi_review_delete_reply |
                               poi_review_list_reply )+ >
\end{verbatim}
\index{poi\_review\_reply, element}
The POI Review Reply is, like the POI Review Request, a container of
more specific replies to POI review actions. Each POI review action
must be answered by a POI review action reply, identified by the
proper transaction id.

Note that if the request document contained several
\emph{poi\_review\_request} elements, the server does not guarantee
that the individual replies are sent in corresponding
\emph{poi\_review\_reply} groups.


\subsection{POI Review Common Elements}
\begin{verbatim}
<!ENTITY % poi_grade "(0|1|2|3|4|5)" >
\end{verbatim}
\index{poi\_grade, entity}
The user may grade the POI while submitting his review. The grade is a
value from 1 to 5 inclusive where 1 is the lowest and 5 the highest.
\begin{verbatim}
<!ELEMENT poi_review_title ( #PCDATA ) >
\end{verbatim}
\index{poi\_review\_title, element}
Each review must have a title or abstract that can be presented in
list format.
\begin{verbatim}
<!ELEMENT poi_review_text ( #PCDATA ) >
\end{verbatim}
\index{poi\_review\_text, element}
The actual review text should be submitted in this element.

\subsection{POI Review Add Request}
\begin{verbatim}
<!ELEMENT poi_review_add_request ( ( user_id | uin | 
                                    ( user_session_id, user_session_key ) ) ,
                                  ( poi_review_title, poi_review_text )? ) >
<!ATTLIST poi_review_add_request transaction_id  ID           #REQUIRED
                                 poi_id          CDATA        #REQUIRED 
                                 grade           %poi_grade;  #REQUIRED 
                                 lang            %language_t; #IMPLIED
                                 review_id       CDATA        #IMPLIED >
\end{verbatim}
\index{poi\_review\_add\_request, element}
\index{poi\_review\_add\_request, attlist}
User reviews are added using the \emph{poi\_review\_add\_request} element. 

The \emph{user\_id}, \emph{uin}, or \emph{user\_session\_id} and
\emph{user\_session\_key} are used to identify the user that is
submitting this review.

If the user just wants to grade a POI, not write a review, the
\emph{poi\_review\_title} and \emph{poi\_review\_text} elements may be
excluded.

\begin{xmltable}
  \xmldesc{ poi\_review\_title }{ string }{ Shall hold the title or caption of
    the request. Note that the title should not be too long. }
  \xmldesc{ poi\_review\_text }{ string }{ Shall hold the review text. }
  \xmldesc{ transaction\_id }{ string }{ Arbitrary text string to identify this
    request. }
  \xmldesc{ poi\_id }{ string }{ Shall hold a string that uniquely identifies
    the POI that this review is for. }
  \xmldesc{ grade }{  }{ The number of 'stars' the user wants to give this
    POI. }
  \xmldesc{ lang }{ string }{ The language of the review. }
  \xmldesc{ review\_id }{ }{ The id of the review to modify. }
\end{xmltable}

status codes:

\begin{statustable}
  \statusdesc{ -600 }{ Not found. }
  \statusdesc{ -601 }{ Not allowed. }
\end{statustable}


\subsection{POI Review Add Reply}
\begin{verbatim}
<!ELEMENT poi_review_add_reply ( status_code, status_message, 
                                 status_code_extended? )? >
<!ATTLIST poi_review_add_reply transaction_id  ID     #REQUIRED
                               review_id       CDATA  #IMPLIED >
\end{verbatim}
\index{poi\_review\_add\_reply, element}
\index{poi\_review\_add\_reply, attlist}

If the request qould not be processed for some reason, the
\emph{status\_code}, \emph{status\_message}, and
\emph{status\_code\_extended} will be included to tell you why.


\begin{xmltable}
  \xmldesc{ transaction\_id }{ string }{ String that matches the \emph{transaction\_id}
    of the corresponding \emph{poi\_review\_add\_request}. }
  \xmldesc{ review\_id }{ string }{ String that uniquely identifies this review.  }
\end{xmltable}


\subsection{POI Review Delete Request}
\begin{verbatim}
<!ELEMENT poi_review_delete_request ( user_id | uin | 
                                    ( user_session_id, user_session_key ) ) >
<!ATTLIST poi_review_delete_request transaction_id  ID     #REQUIRED
                                    review_id       CDATA  #REQUIRED >
\end{verbatim}
\index{poi\_review\_delete\_request, element}
\index{poi\_review\_delete\_request, attlist}

Requests the removal of a review. The user identified by
\emph{user\_id}, \emph{uin}, or \emph{user\_session\_id} and
\emph{user\_session\_key} must match the user listed as the author of
the review.

\begin{xmltable}
  \xmldesc{ transaction\_id }{ string }{ Arbitrary string identifier that uniquely
    identifies this request whithin this document. }
  \xmldesc{ review\_id }{ string }{ String ID of the review that should be
    removed. }
\end{xmltable}


\subsection{POI Review Delete Reply}
\begin{verbatim}
<!ELEMENT poi_review_delete_reply ( status_code, status_message, 
                                    status_code_extended? )? >
<!ATTLIST poi_review_delete_reply transaction_id ID #REQUIRED >
\end{verbatim}
\index{poi\_review\_delete\_reply, element}
\index{poi\_review\_delete\_reply, attlist}

If the request qould not be processed for some reason, the
\emph{status\_code}, \emph{status\_message}, and
\emph{status\_code\_extended} will be included to tell you why.


\subsection{POI Review List Request}
\begin{verbatim}
<!ELEMENT poi_review_list_request ( user_id | uin | 
                                    ( user_session_id, user_session_key ) | 
                                    poi_review_poi | poi_review_id ) >
<!ATTLIST poi_review_list_request transaction_id  ID                   #REQUIRED
                                  details         %poi_review_details; "all" 
                                  lang            %language_t;         #IMPLIED >
<!ENTITY % poi_review_details "(none|some|all)" >
<!ELEMENT poi_review_poi EMPTY >
<!ATTLIST poi_review_poi poi_id CDATA #REQUIRED >
<!ELEMENT poi_review_id  EMPTY >
<!ATTLIST poi_review_id  review_id CDATA #REQUIRED >
\end{verbatim}
\index{poi\_review\_list\_request, element}
\index{poi\_review\_list\_request, attlist}
\index{poi\_review\_poi, element}
\index{poi\_review\_poi, attlist}
\index{poi\_review\_id, element}
\index{poi\_review\_id, attlist}
\index{poi\_review\_details, enitity}

Request a list of POI reviews. Which reviews should be listed is
indicated by the contained elements.

\begin{description}
\item[user\_id, uin, or user\_session\_id and user\_session\_key] All
  reviews by this user.
\item[poi\_review\_id] All POI reviews with the id encoded in the
  \emph{review\_id} attribute. This should only be one review.
\item[poi\_review\_poi] All POI reviews for the POI identified by the
  \emph{review\_id} attribute.
\end{description}

Some aspects of the list may be controlled using atributes.

\begin{description}
\item[transaction\_id] Arbitrary string that uniqely identifies this
  request whithin this document.
\item[details] Specifies how much details should be included in the
  \emph{poi\_review\_list\_reply}. 
  \begin{description}
  \item[none] Only overview information of each reveiwed POI will be listed.
  \item[some] Overview information and the user, grade, and title of
    each review will be listed.
  \item[all] All information will be listed.
  \end{description}
\item[lang] If the \emph{lang} attribute is set, only reviews of this
  language will be included in the list.
\end{description}


\subsection{POI Review List Reply}
\begin{verbatim}
<!ELEMENT poi_review_list_reply ( ( poi_review* ) | 
                                  ( status_code, status_message, 
                                    status_code_extended? ) ) >
<!ATTLIST poi_review_list_reply transaction_id  ID      #REQUIRED >

<!ELEMENT poi_review ( poi_review_detail* ) >
<!ATTLIST poi_review poi_id      CDATA        #REQUIRED
                     avg_grade   CDATA        #IMPLIED
                     grade_count %number;     #IMPLIED >

<!ELEMENT poi_review_detail ( user_id, poi_review_title, poi_review_text? ) >
<!ATTLIST poi_review_detail review_id  CDATA       #REQUIRED
                            date       CDATA       #REQUIRED
                            grade      %poi_grade; #REQUIRED
                            logonID    CDATA       #IMPLIED
                            firstname  CDATA       #IMPLIED
                            lastname   CDATA       #IMPLIED >
\end{verbatim}
\index{poi\_review\_list\_reply, element}
\index{poi\_review\_list\_reply, attlist}
\index{poi\_review, element}
\index{poi\_review, attlist}
\index{poi\_review\_detail, element}
\index{poi\_review\_detail, attlist}


If the request could not be processed for some reason, the
\emph{status\_code}, \emph{status\_message}, and
\emph{status\_code\_extended} will be included to tell you why.

Otherwise a number of \emph{poi\_review} elements will be listed, each
containing the reviews for one POI.

The \emph{transaction\_id} attribute will contain the string from the
corresponding \emph{poi\_review\_list\_request}.

Each POI that has any review and is included in the list is
represented by a \emph{poi\_review} element. 

\begin{xmltable}
  \xmldesc{ poi\_id }{ string }{ The POI ID. }
  \xmldesc{ avg\_grade }{ }{ The average grade calculated from all reviews for
    the POI, whether they are included in the list or not. }
  \xmldesc{ grade\_count }{ integer }{ The number of grades that have been used
    to calculate the average.  }
\end{xmltable}

If the \emph{detail} attribute of the \emph{poi\_review\_list\_request}
was set to ``none'' no \emph{poi\_review\_detail} elements will be
included, otherwise all reviews for the POI will be included unless
filtered by the \emph{lang} attribute.

The \emph{poi\_review\_detail} elements holds information about a
single review.

\begin{xmltable}
  \xmldesc{ user\_id }{ }{ The user that submitted the review. }
  \xmldesc{ poi\_review\_title }{ }{ The title of the review. }
  \xmldesc{ poi\_review\_text }{ }{ The review text. This element is only
    included if the \emph{details} attribute of the
    \emph{poi\_review\_list\_request} was set to ``all''. }
  \xmldesc{ review\_id }{ }{ The ID of the review. }
  \xmldesc{ date }{ }{ The time when the review was submitted. }
  \xmldesc{ grade }{ }{ The grade given to the POI in this review. }
  \xmldesc{ logonID }{ }{ The user name of the reviewer. }
  \xmldesc{ firstname }{ }{ The first name of the reviewer. }
  \xmldesc{ lastname }{ }{ The last name of the reviewer. }
\end{xmltable}


\section{Get client type information}

This request is for getting information about a client type.


\subsection{Get client type info Request}

\begin{verbatim}
<!ELEMENT client_type_info_request EMPTY >
<!ATTLIST client_type_info_request 
   transaction_id      ID           #REQUIRED
   client_type         CDATA        #REQUIRED
   client_type_options CDATA        #REQUIRED >
\end{verbatim}
\index{client\_type\_info\_request, element}
\index{client\_type\_info\_request, attlist}
Request for retreiving data for a client type.

\subsection{Get client type info Reply}

Reply to a get client type info request with the reply or error reply.

\begin{verbatim}
<!ELEMENT client_type_info_reply ( (status_code, status_message,
                                    status_code_extended?)? ) >
<!ATTLIST client_type_info_reply 
   transaction_id      ID           #REQUIRED
   phoneModel          CDATA        #REQUIRED
   imageExtension      CDATA        #REQUIRED
   extraRights         CDATA        #REQUIRED >
\end{verbatim}
\index{client\_type\_info\_reply, element}
\index{client\_type\_info\_reply, attlist}
The reply to a \emph{client\_type\_info\_request} with reply.

Status codes:

\begin{statustable}
  \statusdesc{ -700 }{ No such client type. }
\end{statustable}


\section{Get server list for client type}

This request is for getting server list for a client type.


\subsection{Get server list for client type Request}

\begin{verbatim}
<!ELEMENT server_list_for_client_type_request EMPTY >
<!ATTLIST server_list_for_client_type_request 
   transaction_id      ID           #REQUIRED
   client_type         CDATA        #REQUIRED
   client_type_options CDATA        #REQUIRED
   srvt                CDATA        #REQUIRED
   uin                 CDATA        #IMPLIED >
\end{verbatim}
\index{server\_list\_for\_client\_type\_request, element}
\index{server\_list\_for\_client\_type\_request, attlist}
Request for retreiving server list for a client type.

\subsection{Get server list for client type Reply}

Reply to a get server list for client type request with the reply
or error reply.

\begin{verbatim}
<!ELEMENT server_list_for_client_type_reply ( server_list | 
                                              (status_code, status_message,
                                               status_code_extended?) ) >
<!ATTLIST server_list_for_client_type_reply 
   transaction_id      ID           #REQUIRED >
\end{verbatim}
\index{server\_list\_for\_client\_type\_reply, element}
\index{server\_list\_for\_client\_type\_reply, attlist}
The reply to a \emph{server\_list\_for\_client\_type\_request} with reply.

Status codes:

\begin{statustable}
  \statusdesc{ -700 }{ No such client type. }
\end{statustable}

\section{Create Wayfinder User}

This request is for creating Wayfinder users.


\subsection{Create Wayfinder User Request}

\begin{verbatim}
<!ELEMENT create_wayfinder_user_request ( hardware_key+ ) >
<!ATTLIST create_wayfinder_user_request  
   transaction_id      ID           #REQUIRED
   client_type         CDATA        #REQUIRED
   client_type_options CDATA        #REQUIRED
   client_lang         %language_t; #REQUIRED
   logon               CDATA        #REQUIRED
   password            CDATA        #REQUIRED
   activation_code     CDATA        #IMPLIED
   top_region_id       %number;     #IMPLIED >
\end{verbatim}
\index{create\_wayfinder\_user\_request, element}
\index{create\_wayfinder\_user\_request, attlist}
Request for creating a new Wayfinder user.

\subsection{Create Wayfinder User Reply}

Reply to a create wayfinder user request with the reply
or error reply.

\begin{verbatim}
<!ELEMENT create_wayfinder_user_reply ( (status_code, status_message,
                                         status_code_extended?, 
                                         server_list?)? ) >
<!ATTLIST create_wayfinder_user_reply transaction_id ID    #REQUIRED
                                      uin            CDATA #IMPLIED >
\end{verbatim}
\index{create\_wayfinder\_user\_reply, element}
\index{create\_wayfinder\_user\_reply, attlist}
The reply to a \emph{create\_wayfinder\_user\_request} with reply.

Status codes:

\begin{statustable}
  \statusdesc{ -700 }{ No such client type. }
  \statusdesc{ -211 }{ Redirect code. The \emph{server\_list} element gives the
    server to use. }
  \statusdesc{ -302 }{ Problem with activation code. }
  \statusdesc{ -306 }{ Problem with activation code. }
\end{statustable}

\section{Update Hardware Keys}

This request is for changing licence keys for a user.


\subsection{Update Hardware Keys Request}

\begin{verbatim}
<!ELEMENT update_hardware_keys_request ( hardware_key+ ) >
<!ATTLIST update_hardware_keys_request  
   transaction_id      ID           #REQUIRED
   uin                 CDATA        #IMPLIED
   client_type         CDATA        #IMPLIED
   client_type_options CDATA        #IMPLIED >
\end{verbatim}
\index{update\_hardware\_keys\_request, element}
\index{update\_hardware\_keys\_request, attlist}
Request for updating a user with a set of licence keys.

\subsection{Update Hardware Keys Reply}

Reply to a update hardware keys request with the reply
or error reply.

\begin{verbatim}
<!ELEMENT update_hardware_keys_reply ( (status_code, status_message,
                                        status_code_extended?)? ) >
<!ATTLIST update_hardware_keys_reply transaction_id ID #REQUIRED >
\end{verbatim}
\index{update\_hardware\_keys\_reply, element}
\index{update\_hardware\_keys\_reply, attlist}
The reply to a \emph{update\_hardware\_keys\_request} with reply.


\section{Get Stored User Data}

This request and reply for getting user data such as i.e. getting the 
last currency conversion, the last weather searches etc.

\subsection{Get Stored User Data Request}
The get stored user data request will get a certain data for a specific user
defined by the \emph{uin} and \emph{key}.

\begin{verbatim}
<!ELEMENT get_stored_user_data_request EMPTY >
<!ATTLIST get_stored_user_data_request
   transaction_id       ID          #REQUIRED
   uin                  CDATA       #REQUIRED
   key                  CDATA       #REQUIRED >
\end{verbatim}
\index{get\_stored\_user\_data\_request, element}
\index{get\_stored\_user\_data\_request, attlist}

\begin{xmltable}
  \xmldesc{ key }{ string }{ The key for a certain value. }
\end{xmltable}

\subsection{Get Stored User Data Reply}
Is the reply to a get stored user data request reply or a error reply.

\begin{verbatim}
<!ELEMENT get_stored_user_data_reply ( ( stored_user_data ) | 
            ( status_code, status_message, status_code_extended? ) ) >
<!ATTLIST get_stored_user_data_reply
   transaction_id       ID          #REQUIRED >

<!ELEMENT stored_user_data EMPTY >
<!ATTLIST stored_user_data
   key                  CDATA       #REQUIRED
   value                CDATA       #REQUIRED >
\end{verbatim}
\index{get\_stored\_user\_data\_reply, element}
\index{get\_stored\_user\_data\_reply, attlist}
\index{stored\_user\_data, element}
\index{stored\_user\_data, attlist}

\begin{xmltable}
  \xmldesc{ key }{ string }{ The key for a certain value. }
  \xmldesc{ value }{ string }{ The value of a stored data specified by a key. }
\end{xmltable}

Status codes:

\begin{statustable}
  \statusdesc{ -800 }{ No such key in the database! }
\end{statustable}

\section{Set Stored User Data}

This request and reply for setting user data such as i.e. setting the 
last currency conversion, the last weather searches etc.

\subsection{Set Stored User Data Request}
The set stored user data request will set certain data for a specific user
defined by the \emph{uin} and \emph{stored\_user\_data}.

\begin{verbatim}
<!ELEMENT set_stored_user_data_request ( stored_user_data ) >
<!ATTLIST set_stored_user_data_request
   transaction_id       ID          #REQUIRED
   uin                  CDATA       #REQUIRED >
\end{verbatim}
\index{set\_stored\_user\_data\_request, element}
\index{set\_stored\_user\_data\_request, attlist}

\subsection{Set Stored User Data Reply}
Is the reply to a set stored user data request reply or a error reply.

\begin{verbatim}
<!ELEMENT set_stored_user_data_reply ( ( status_code, status_message, 
                                         status_code_extended? )? ) >
<!ATTLIST set_stored_user_data_reply
   transaction_id       ID          #REQUIRED >
\end{verbatim}
\index{set\_stored\_user\_data\_reply, element}
\index{set\_stored\_user\_data\_reply, attlist}


\section{One Search}

A new search which searches all, allowed, sources and returns a single 
sorted list of search matches.

\subsection{One Search Request}

The request just has the options needed right now and will get more when they 
are needed.\\
The location where the search should be performed is specified by either sending
a position\_item or a query\_location and a top\_region\_id.

\begin{verbatim}
<!ENTITY % sorting_t "(alfa_sort|distance_sort)">
<!ENTITY % search_for_type_t "(address|all)">
<!ELEMENT query_location ( #PCDATA )>

<!ELEMENT one_search_request ( search_match_query?, 
                               category_list?,
                               ( ( position_item, distance? ) | 
                               ( query_location, top_region_id ) ) ) >
<!ATTLIST one_search_request transaction_id    ID            #REQUIRED
                             max_number_matches %number;     #REQUIRED
                             language          %language_t;  #REQUIRED
                             round             %number;      #REQUIRED
                             version           %number;      #REQUIRED
                             include_detail_fields %bool;      #IMPLIED
                             position_system %position_system_t; "MC2"
                             sorting           %sorting_t;   #REQUIRED 
                             search_type      %search_for_type_t; "all">
<!ELEMENT search_match_query ( #PCDATA )>
\end{verbatim}
\index{one\_search\_request, element}
\index{one\_search\_request, attlist}

\begin{xmltable}
  \xmldesc{ search\_match\_query }{ string }{ String to match. }
  \xmldesc{ category\_list }{ element }{ Contains a set of category ids to 
    match. }
  \xmldesc{ position\_item }{}{ Coordinates for proximity search. }
  \xmldesc{ distance }{ integer }{ The radius in meters from position in
    \emph{position\_item}. }
  \xmldesc{ query\_location }{ element }{ The city or area to seach in. }
  \xmldesc{ top\_region\_id }{ element }{ A unique region to search in. }
  \xmldesc{ transaction\_id }{ string }{ Unique identifier for the request. }
  \xmldesc{ max\_number\_matches }{ integer }{ Maximum number of search 
    results in reply. }
  \xmldesc{ language }{ enumeration }{ Language used when there is a choice. }
  \xmldesc{ round }{ integer }{ Search round. Round 0 = Fast internal search,
    Round 1 = Slow external provider search. }
  \xmldesc{ version }{ integer }{ Version 0 is the initial version. }
  \xmldesc{ include\_detail\_fields }{ boolean }{ Whether to include info fields,
    default true. }
   \xmldesc{ position\_system }{ enumeration }{ Determines which coordinate
     system to use in the reply. }
   \xmldesc{ sorting }{ enumeration }{ How the results should be sorted. }
   \xmldesc{ search\_type }{ enumeration }{ What we are searching for. The 
     search type "address" is intended for round 0. }
\end{xmltable}

\subsection{One Search Reply}
Is the search result for an one search request or an error reply.

\begin{verbatim}
<!ENTITY % search_match_type_t "(street|pointofinterest|misc|person|
                                 other)">
<!ELEMENT search_match ( name, itemid,
                         location_name, lat?, lon?, category_list?,
                         search_area*, detail_item? )>
\end{verbatim}

The \emph{search\_match} is a fresh start for search replies.

\begin{xmltable}
  \xmldesc{ search\_match\_type\_t }{ entity }{ The type of match. }
  \xmldesc{ search\_match }{ element }{ Representing a search match. }
  \xmldesc{ name }{ string }{ Name of the \emph{search\_match}. }
  \xmldesc{ itemid }{ string }{ A unique id for this match. Not persistent do 
    not store permanently. }
  \xmldesc{ location\_name }{ string }{ String describing the location of the 
    match. }
  \xmldesc{ lat }{ element }{ Latitude coordinate. }
  \xmldesc{ lon }{ element }{ Longitude coordinate. }
  \xmldesc{ category\_list }{ element }{ The search categories the match 
    belongs to. }
  \xmldesc{ search\_area }{ element }{ The areas that this match belong to. 
    See \emph{search\_area}. }
  \xmldesc{ detail\_item }{ element }{ Detailed information for the match, is 
    added if \emph{include\_detail\_fields} is \emph{true}. }
\end{xmltable}

\begin{verbatim}
<!ATTLIST search_match search_match_type %search_match_type_t; #REQUIRED
                       category_image CDATA #REQUIRED
                       provider_image CDATA #REQUIRED
                       brand_image CDATA #REQUIRED
                       additional_info_exists %bool; #REQUIRED >
\end{verbatim}

\begin{xmltable}
  \xmldesc{ search\_match\_type }{ enumeration }{ The type of match. }
  \xmldesc{ category\_image }{ string }{ The category icon. }
  \xmldesc{ provider\_image }{ string }{ The provider icon. }
  \xmldesc{ brand\_image }{ string }{ The brand icon. }
  \xmldesc{ additional\_info\_exists }{ boolean }{ True if more information about this 
search match can be fetched. }
\end{xmltable}

Images are without file extension and are empty if there is no such image for
the \emph{search\_match}.

\begin{verbatim}
<!ELEMENT one_search_reply ( search_list |
                             ( status_code, status_message, 
                               status_uri? ) ) >
<!ATTLIST one_search_reply transaction_id  ID      #REQUIRED >

<!ELEMENT search_list ( search_match* )>
<!ATTLIST search_list number_matches       %number; #REQUIRED
                      total_number_matches %number; #REQUIRED >
\end{verbatim}
\index{one\_search\_reply, element}
\index{one\_search\_reply, attlist}

\begin{xmltable}
  \xmldesc{ search\_list }{ element }{ The result with the matches. }
  \xmldesc{ transaction\_id }{ string }{ Unique identifier for the request. }
  \xmldesc{ number\_matches }{ integer }{ The number of \emph{search\_match}es
    in the \emph{search\_list}. }
  \xmldesc{ total\_number\_matches }{ integer }{ The total number of matches. }
\end{xmltable}


\section{Server Info}

At the moment this request only handles new versions of client types. More 
information may be added when needed.

\subsection{Server Info Request}

The request just has the client type right now and will get more when they 
are needed.\\
This request should be sent to the server at client start up.

\begin{verbatim}

<!ELEMENT server_info_request EMPTY>
<!ATTLIST server_info_request transaction_id      ID            #REQUIRED
                              client_type         CDATA         #REQUIRED
                              client_type_options CDATA         #IMPLIED 
                              client_version      CDATA         #REQUIRED >

\end{verbatim}
\index{server\_info\_request, element}
\index{server\_info\_request, attlist}

\begin{xmltable}
  \xmldesc{ client\_type }{ string }{ The client type used. }
  \xmldesc{ client\_type\_options }{ string }{ Options string for the used client 
type. }
  \xmldesc{ client\_version }{ string }{ The current version of the client. }
\end{xmltable}

\subsection{Server Info Reply}
Is the result for an server info request or an error reply.

\begin{verbatim}
<!ELEMENT server_info_reply ( client_type_info |
                             ( status_code, status_message, 
                               status_uri? ) ) >
<!ATTLIST server_info_reply transaction_id  ID      #REQUIRED >

<!ELEMENT client_type_info EMPTY>
<!ATTLIST client_type_info  upgrade_available    %bool; #REGUIRED
                            latest_version       CDATA  #REQUIRED
                            force_upgrade        %bool: #REQUIRED
                            upgrade_id           CDATA  #IMPLIED >
\end{verbatim}
\index{server\_info\_reply, element}
\index{server\_info\_reply, attlist}
\index{client\_type\_info, element}
\index{client\_type\_info, attlist}

\begin{xmltable}
  \xmldesc{ upgrade\_available }{ boolean }{ True if a newer version exists for 
this client type. }
  \xmldesc{ latest\_version }{ string }{ The latest version available for this 
client type. Empty string if no version information is available for the requested
client type. }
  \xmldesc{ force\_upgrade }{ boolean }{ True if upgrade to the latest version 
should be forced. }
  \xmldesc{ upgrade\_id }{ string }{ String identifying the latest version in the 
    platform market. May be an URI, a package name, an id etc. }
\end{xmltable}


\section{Point of Interest - Details}

\subsection{POI Details Request}

\begin{verbatim}
<!ELEMENT poi_detail_request ( itemid ) >
<!ATTLIST poi_detail_request transaction_id ID           #REQUIRED 
                             language       %language_t; #REQUIRED>

\end{verbatim}
\index{poi\_detail\_request, element}
\index{poi\_detail\_request, attlist}
Request for information about a specific point of interest.

\subsection{POI Details Reply}

\begin{verbatim}
<!ELEMENT poi_detail_reply ( ( detail_item, resources? ) | 
                           ( status_code, status_message, 
                             status_code_extended? ) ) >
<!ATTLIST poi_detail_reply transaction_id ID #REQUIRED>
<!ELEMENT detail_item ( detail_field* )>
<!ATTLIST detail_item numberfields %number; #REQUIRED >

<!ELEMENT detail_field ( fieldName, fieldValue ) >
<!ATTLIST detail_field detail_type %poi_detail_t; #IMPLIED
                       detail_content %poi_detail_content_t; #IMPLIED >

<!ENTITY % poi_detail_t "(dont_show|text|street_address|full_address|phone_number|
                          url|email|poi_url|poi_thumb|average_rating|
                          description|open_hours|provider_info)" >
<!ENTITY % poi_detail_content_t "(text|phone_number|url|email_address|
                                  integer|float)" >

<!ELEMENT resources ( image_group*, review_group* ) >
<!ATTLIST resources number_image_groups %number; #REQUIRED
                    number_review_groups %number; #REQUIRED > 

<!ELEMENT image_group ( image* ) >
<!ATTLIST image_group number_images %number; #REQUIRED
                      provider_name  CDATA    #REQUIRED
                      provider_image CDATA    #REQUIRED >

<!ELEMENT image ( EMPTY ) >
<!ATTLIST image url CDATA #REQUIRED >

<!ELEMENT review_group ( review* ) >
<!ATTLIST review_group number_reviews %number; #REQUIRED
                       provider_name  CDATA    #REQUIRED 
                       provider_image CDATA    #REQUIRED >

<!ELEMENT review ( #PCDATA ) >
<!ATTLIST review rating   %number; #REQUIRED 
                 date     CDATA #REQUIRED 
                 reviewer CDATA #REQUIRED >

\end{verbatim}
\index{poi\_detail\_reply, element}
\index{poi\_detail\_reply, attlist}
\index{detail\_item, element}
\index{detail\_item, attlist}
\index{detail\_field, element}
\index{detail\_type, attribute}
% xxx to be explained
The reply to a \emph{poi\_detail\_request} with the information about the POI(s) 
requested. \\
\ \\
Description of elements:
\begin{xmltable}
    \xmldesc{ detail\_field }{ }{ A list of pairs (\emph{info\_field} elements)
    giving additional information. One pair consists of a \emph{fieldName} and
    a \emph{fieldValue}. The type of field is in the \emph{info\_type}
    attribute. }
    \xmldesc{ resources }{ }{ Contains images and reviews. The images and reviwes
    are grouped by provider. }
    \xmldesc{ image\_group }{ }{ Contains images from one provider. }
    \xmldesc{ review\_group }{ }{ Contains reviews from one provider. }
    \xmldesc{ image }{ }{ The url to an image. }
    \xmldesc{ review }{ }{ Contains a review including rating. }
\end{xmltable}
\ \\
Description of attributes:
\begin{xmltable}
    \xmldesc{ number\_image\_groups }{ integer }{ The number of image groups. }
    \xmldesc{ number\_review\_groups }{ integer }{ The number of review groups. }
    \xmldesc{ provider\_name }{ string }{ The name of the provider from where the 
      images or reviews are fetched. }
    \xmldesc{ provider\_image }{ string }{ The image of the provider from where the 
      images or reviews are fetched. }
    \xmldesc{ number\_images }{ integer }{ The number of images. }
    \xmldesc{ number\_reviews }{ integer }{ The number of reviews. }
    \xmldesc{ url }{ string }{ The url to an image. The url can be used to fetch 
      the image thru the MC2 server. }
    \xmldesc{ rating }{ integer }{ The rating given by the user. }
    \xmldesc{ date }{ string }{ Date of the review. }
    \xmldesc{ reviewer }{ string }{ The user who wrote the review. }
\end{xmltable}
\ \\
Description of enum poi\_detail\_t:
\begin{xmltable}
    \xmldesc{  dont\_show }{ text }{ Hidden field not to be visible for user.}
    \xmldesc{  text }{ text }{ A field containing text.}
    \xmldesc{  street\_address }{ text }{ The street address with house number.}
    \xmldesc{  full\_address }{ text }{ The address with street, 
    house number, zip code and zip area.}
    \xmldesc{  phone\_number }{ phone\_numer }{ The phone number.}
    \xmldesc{  url }{ url }{ URL to a web page.}
    \xmldesc{  email }{ email }{ E-mail address.}
    \xmldesc{  poi\_url }{ url }{ Link to providers POI information. }
    \xmldesc{  poi\_thumb }{ url }{ Thumb image information.}
    \xmldesc{  average\_rating }{ integer }{ Average rating. }
    \xmldesc{  description }{ text }{ Description of a POI }
    \xmldesc{  open\_hours }{ text }{ Open hours. }
    \xmldesc{  provider\_info }{ text }{ Provider info. Format <Link name>;<URL> }
\end{xmltable}
\ \\
Description of enum poi\_detail\_content\_t:
\begin{xmltable}
    \xmldesc{  text }{}{ The field shall be handled as text.}
    \xmldesc{  phone\_number }{}{ The field shall be handled as a phone number. }
    \xmldesc{  url }{}{ The field shall be handled as an url. }
    \xmldesc{  email\_address }{}{ The field shall be handled as an email address. }
    \xmldesc{  integer }{}{ The field shall be handled as an integer. }
    \xmldesc{  float }{}{ The field shall be handled as a float. }
\end{xmltable}


% xxx add index entries into the examples as well
% and the isab-mc2.dtd if they were not verbatim-input
\section{Document Type Definition}
\label{sec_dtd}
The formal definition of the XML documents that are sent to and from
the \mc-system.
\verbatiminput{../../Server/bin/isab-mc2.dtd}

\section{Direct image interface}

When making image URIs the Map Request is recommended, see Section
\ref{api:MapRequest}.
But if you can't use Map Request and want to use images only here is a direct way to images.\\
%
Beware that this direct image interface might change in the future.
We recommend using the Map Request if possible.\\
%
The URI is like Map.[ext]?[parameters] where [ext] is one of:
\begin{description}
   \item[png] Portable Network Graphics.
   \item[gif] Graphics Interchange Format.
   \item[wbmp] Wireless BitMaP, WAP image.
\end{description}
Other formats may be added in the future.\\
%
~\\
The parameters supported in [parameters] are:
\begin{description}
   \item[lla] Lower latitude, south latitude in MC2 units. Must be present.
   \item[llo] Lower longitude, west longitude in MC2 units. Must be present.
   \item[ula] Upper latitude, north latitude in MC2 units. Must be present.
   \item[ulo] Upper longitude, east longitude in MC2 units. Must be present.
   \item[w]   Width of image in pixels. Must be present.
   \item[h]   Height of image in pixels. Must be present.
   \item[s]   If greater than 4096 then text in image. Road names, cities lakes etc.  Must be present.
   \item[map] 1 then map stuff, roads, parks etc, in image. 0 no map data in image.
   \item[topomap] 1 then topograthical map data in image. NB! No topograthical data at present. 0 no topograthical map data in image.
   \item[poi] 1 then points of interest in image. Symbols added to image. 0 no pois.
   \item[scale] 1 then draw scale at lower right corner. 0 no scale.
   \item[traffic] 1 then draw traffic information in image. Traffic information from Swedish Vägverket. 0 no traffic information.
   \item[mt]  Map type, allowed values are "std" and "wap". Images with wap setting has more contrast in them. Default is ``std''.
   \item[ms] Map symbol to draw paramerer. Multiple ms parameters are allowed to make it possible to add many map symbols. The parameter value is \$1\_\$2\_\$3\_\$4\_\$5 where:
      \begin{description}
         \item[\$1] Is type of symbol:  0  PIN, \$5 ignored,
                                 1  USER\_DEFINED, \$5 used.
         \item[\$2] Is latitude for symbol in MC2 units
         \item[\$3] Is longitude for symbol in MC2 units.
         \item[\$4] Is name of symbol base64- and then url-encoded. Currently not used.
             Empty string is recommened.
         \item[\$5] Is image to draw base64- and then url-encoded. Empty string is recommended with \$1 = 0.
      \end{description}
   \item[r] Route ID, an id for a route to draw in image. See Section \ref{api:RouteReply} for more information about route id.
   \item[route] 1 then route identified by ``r'' parameter is shown. 0 disables route on map even if ``r'' parameter is present and valid.
   \item[turn] The turn index, in hexadecimal with capital letters, to draw a turn arrow for. Start is 0 first turn is 1.
   \item[auth] A authorization string received from Wayfinder Systems. Might be required in the future.
   \item[lang] Language code as ISO-639.
   \item[sesi] Session ID, used with Session Key.
   \item[si] Alias for sesi.
   \item[sesk] Session key.
   \item[sk] Alias for sesk.
   \item[uin] User Identification number, used with tok and hwd.
   \item[tok] Token, from token authentication.
   \item[hwd] Hardware key, used with hwdt to identify user.
   \item[hwdt] Hardware key type.
\end{description}
%
An example pinpointing the location of Wayfinder Systems in Lund, Sweden.
%\verb+Map.png?lla=664632208&llo=157172530&ula=664832208&ulo=157527596&w=500&h=500&s=31250&mt=std&map=1&topomap=1&poi=1&route=0&scale=1&traffic=1&ms=0_664732208_157350063__+
Map.png?lla=664632208\&\linebreak llo=157172530\&ula=664832208\&ulo=157527596\&w=500\&h=500\&s=31250\&mt=std\&\linebreak map=1\&topomap=1\&poi=1\&route=0\&scale=1\&traffic=1\&ms=0\_664732208\_157350063\_\_


\section{Examples}
Some examples of the usage of the API formally described above.

\subsection{User Request Example}\label{xml_user_request_example}
Please note that this example is quite unrealistic since each user
is modified in different transactions within the same document. But
it shows how it could have been done if the transactions was in 
different requests.
\verbatiminput{exampleuser.xml}

\subsection{User Reply Example}
An example of reply from the \mc-system to the example in 
\textit{\ref{xml_user_request_example} -- User request example}.
\verbatiminput{exampleuserstatus.xml}

\subsection{Search, Route and Expand Request Example}
\label{xml_search_route_expand_request_example}
A simple example of how to make a search, route or expand request.
\verbatiminput{examplesearchandrouterequest.xml}

\subsection{Search, Route and Expand Reply Example}

An example of reply from the \mc2-system to the examples in
\texttt{\ref{xml_search_route_expand_request_example} -- Search, route and expand request}.
\verbatiminput{examplesearchandroutereply.xml}

\subsection{Simple Search Request Example}

An example of a search request to send to the \mc2-system.
\verbatiminput{simplesearch.xml}

\subsection{Simple Route Request Example}

An example of a route request to send to the \mc2-system.
\verbatiminput{simpleroute.xml}


\subsection{Power Search}

Power Search has a two round search procedure.
The first round does a search within Wayfinders internal database, this is a fast search.
The second round searches in external providers, this might take some time.
So round 0 can be done first and display the results while round 1 search is beeing processed in the background for the clients.

The answer from Power Search is categoriesed into "headings". For example "Address", "POI", "YellowPages" etc.
Each heading has an ID. This ID can be matched to a name and an image name in
the search\_desc\_reply. 
The search\_desc\_reply is fetched using the search\_desc\_request with a language and a CRC. The CRC can either be empty or be a CRC from a previous search\_desc\_request.
This CRC is used to reduce bandwidth.

If CRC matches the search\_desc\_reply then the reply will simply be crc\_ok.

The search\_desc\_request is usually done by the client at start up.

Example Request:
\begin{verbatim}
<search_desc_request crc="" language="swe" transaction_id="id1"/>
\end{verbatim}

Reply:
\begin{verbatim}
<search_desc_reply crc="2c499646" length="23" transaction_id="id1">
     <search_hit_type heading="0" round="0">
         <name>Platser</name>
         <image_name>search_heading_places</image_name>
      </search_hit_type>
      <search_hit_type heading="1" round="0">
         <name>Adresser</name>
         <image_name>search_heading_addresses</image_name>
      </search_hit_type>

      ... etc ...

</search_desc_reply>
\end{verbatim}

To search with a position use the position\_item node. Example:

\begin{verbatim}
<compact_search_request end_index="30"
                          language="swe" max_hits="30"
                          round="0" start_index="0"
                          transaction_id="id2" version="1">
    <search_item_query>Amst</search_item_query>
    <position_item position_system="MC2">
      <lat>626629220</lat>
      <lon>160005406</lon>
      <angle>0</angle>
    </position_item>
</compact_search_request>
\end{verbatim}

and to fetch round 1 search do:
\begin{verbatim}
<compact_search_request end_index="30"
                          language="swe" max_hits="30"
                          round="1" start_index="0"
                          transaction_id="id2" version="1">
    <search_item_query>Amst</search_item_query>
    <position_item position_system="MC2">
      <lat>626629220</lat>
      <lon>160005406</lon>
      <angle>0</angle>
    </position_item>
 </compact_search_request>
\end{verbatim}
