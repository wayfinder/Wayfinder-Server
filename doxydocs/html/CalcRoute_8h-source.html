<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: CalcRoute.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">Server</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">Modules</a>&nbsp;/&nbsp;<a class="el" href="dir_000022.html">RouteModule</a>&nbsp;/&nbsp;<a class="el" href="dir_000023.html">include</a></div>
<h1>CalcRoute.h</h1><a href="CalcRoute_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef CALCROUTE_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define CALCROUTE_H</span>
00016 <span class="preprocessor"></span>
<a name="l00017"></a><a class="code" href="CalcRoute_8h.html#a0">00017</a> <span class="preprocessor">#define USE_RESET_THREAD_IN_CALCROUTE</span>
00018 <span class="preprocessor"></span>
00019 <span class="comment">// Define if the main priority queue should be the</span>
00020 <span class="comment">// bucket heap else RedBlackTree (which is stl multimap now).</span>
<a name="l00021"></a><a class="code" href="CalcRoute_8h.html#a1">00021</a> <span class="preprocessor">#define MAIN_PRIO_QUEUE_IN_RM_IS_BUCKET_HEAP</span>
00022 <span class="preprocessor"></span>
00023 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00024 
00025 <span class="preprocessor">#include "<a class="code" href="RMDriverPref_8h.html">RMDriverPref.h</a>"</span>
00026 <span class="preprocessor">#include "<a class="code" href="CCSet_8h.html">CCSet.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="OrigDestNodes_8h.html">OrigDestNodes.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="GfxConstants_8h.html">GfxConstants.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="IDPairVector_8h.html">IDPairVector.h</a>"</span>
00030 <span class="preprocessor">#include "<a class="code" href="Math_8h.html">Math.h</a>"</span>
00031 
00032 <span class="keyword">class </span><a class="code" href="classOrigDestInfoList.html">OrigDestInfoList</a>;
00033 
00034 <span class="preprocessor">#ifdef USE_RESET_THREAD_IN_CALCROUTE</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="ISABThread_8h.html">ISABThread.h</a>"</span>
00036 <span class="preprocessor">#endif</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#include &lt;set&gt;</span>
00039 
00040 <span class="keyword">class </span><a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>;
00041 <span class="keyword">class </span><a class="code" href="classBucketHeap.html">BucketHeap</a>;
00042 <span class="keyword">class </span><a class="code" href="classRedBlackTree.html">RedBlackTree</a>;
00043 <span class="keyword">class </span><a class="code" href="classRoutingNode.html">RoutingNode</a>;
00044 <span class="keyword">class </span><a class="code" href="classSubRoute.html">SubRoute</a>;
00045 <span class="keyword">class </span><a class="code" href="classSubRouteList.html">SubRouteList</a>;
00046 <span class="keyword">class </span><a class="code" href="classRMSubRoute.html">RMSubRoute</a>;
00047 <span class="keyword">class </span><a class="code" href="classCompleteRMSubRoute.html">CompleteRMSubRoute</a>;
00048 <span class="keyword">class </span><a class="code" href="classRoutingNode.html">RoutingNode</a>;
00049 <span class="keyword">class </span><a class="code" href="classRoutingConnection.html">RoutingConnection</a>;
00050 <span class="keyword">class </span><a class="code" href="classRoutingMap.html">RoutingMap</a>;
00051 
00052 
<a name="l00054"></a><a class="code" href="CalcRoute_8h.html#a2">00054</a> <span class="keyword">typedef</span> <a class="code" href="Types_8h.html#a21">uint32</a> dpCost_t;
00055 
<a name="l00068"></a><a class="code" href="classCalcRoute.html">00068</a> <span class="keyword">class </span><a class="code" href="classCalcRoute.html">CalcRoute</a>
00069 {
00070    <span class="keyword">public</span>:
00071    
00077       <a class="code" href="classCalcRoute.html">CalcRoute</a>(<a class="code" href="classRoutingMap.html">RoutingMap</a>* <a class="code" href="classmap.html">map</a>);
00078 
00082       ~<a class="code" href="classCalcRoute.html">CalcRoute</a>();
00083    
00110       <a class="code" href="Types_8h.html#a21">uint32</a> route(<a class="code" href="classHead.html">Head</a>* origin, 
00111                    <a class="code" href="classHead.html">Head</a>* destination,
00112                    <a class="code" href="classHead.html">Head</a>* allDestinations,
00113                    <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00114                    <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00115                    <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00116                    <span class="keywordtype">bool</span> originalRequest,
00117                    <span class="keywordtype">bool</span> routeToAll,
00118                    <span class="keyword">const</span> <a class="code" href="classDisturbanceVector.html">DisturbanceVector</a>* disturbances,
00119                    <span class="keywordtype">bool</span> calcCostSums,
00120                    <span class="keywordtype">bool</span> sendSubRoutes);
00121 
00137       <span class="keywordtype">void</span> getExternalNodesToLevel(<span class="keywordtype">int</span> level,
00138                                    <a class="code" href="classvector.html">vector&lt;uint32&gt;</a> &amp;externalNodes,
00139                                    <a class="code" href="classvector.html">vector&lt;int32&gt;</a>&amp; lats,
00140                                    <a class="code" href="classvector.html">vector&lt;int32&gt;</a>&amp; lons,
00141                                    <a class="code" href="classmap.html">map&lt;uint32,uint32&gt;</a>&amp; distances,
00142                                    <span class="keyword">const</span> <a class="code" href="classOrigDestInfoList.html">OrigDestInfoList</a>&amp; dests,
00143                                    <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>&amp; driverPrefs);
00144 
00150       <a class="code" href="Types_8h.html#a21">uint32</a> getHigherLevelMapID(<span class="keywordtype">int</span> higherlevel) <span class="keyword">const</span>;
00151 
00156       <span class="keywordtype">void</span> getNeighbourMapIDs(set&lt;uint32&gt; &amp;neigbourMapIDs);
00157 
00170       <span class="keywordtype">int</span> lookupNodesLowerToHigher( <a class="code" href="classvector.html">IDPairVector_t</a>&amp; higher,
00171                                     <span class="keyword">const</span> <a class="code" href="classvector.html">IDPairVector_t</a>&amp; lower);
00172 
00173 
00183       <span class="keywordtype">int</span> lookupNodesHigherToLower( <a class="code" href="classvector.html">IDPairVector_t</a>&amp; lower,
00184                                     <span class="keyword">const</span> <a class="code" href="classvector.html">IDPairVector_t</a>&amp; higher);
00185       
00191       <a class="code" href="Types_8h.html#a21">uint32</a> getMapID();
00192 
00198       <a class="code" href="classRoutingMap.html">RoutingMap</a>* getMap();
00199    
00200    <span class="keyword">private</span>:
00201 
00206       <span class="keywordtype">void</span> trickTheOptimizer(<a class="code" href="Types_8h.html#a21">uint32</a>&amp; inParam);
00207       
00214       <span class="keywordtype">int</span> removeDups(<a class="code" href="classHead.html">Head</a>* theList, <span class="keywordtype">bool</span> isDest);
00215       
00220 
00224         <span class="keywordtype">void</span> resetToStartState();
00225  
00231          <a class="code" href="Types_8h.html#a21">uint32</a> realRoute(<a class="code" href="classHead.html">Head</a>* origin, 
00232                           <a class="code" href="classHead.html">Head</a>* destination,
00233                           <a class="code" href="classHead.html">Head</a>* allDestinations,
00234                           <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00235                           <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00236                           <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00237                           <span class="keywordtype">bool</span> originalRequest,
00238                           <span class="keywordtype">bool</span> routeToAll,
00239                           <span class="keywordtype">bool</span> calcCostSums,
00240                           <span class="keywordtype">bool</span> sendSubRoutes);
00241    
00256          <a class="code" href="Types_8h.html#a21">uint32</a> initRoute( <span class="keywordtype">bool</span> original, 
00257                            <a class="code" href="classHead.html">Head</a>* origin,
00258                            <a class="code" href="classHead.html">Head</a>* destination,
00259                            <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00260                            <span class="keywordtype">bool</span> routeToHigherLevel,
00261                            <span class="keywordtype">bool</span> forward);
00262 
00280          <a class="code" href="Types_8h.html#a21">uint32</a> initRoute( <a class="code" href="classHead.html">Head</a>* startRoutingNodeList,
00281                            <a class="code" href="classHead.html">Head</a>* endRoutingNodeList,
00282                            <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00283                            <span class="keywordtype">bool</span> routeToHigherLevel,
00284                            <span class="keywordtype">bool</span> forward );
00285 
00312          <a class="code" href="Types_8h.html#a21">uint32</a> initRouteFirstTime( <a class="code" href="classHead.html">Head</a>* startRoutingNodeList,
00313                                     <a class="code" href="classHead.html">Head</a>* endRoutingNodeList,
00314                                     <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00315                                     <span class="keywordtype">bool</span> routeToHigherLevel,
00316                                     <span class="keywordtype">bool</span> forward,
00317                                     <span class="keywordtype">bool</span> secondTime = <span class="keyword">false</span>);
00318 
00329          <a class="code" href="Types_8h.html#a21">uint32</a> initRouteBus( <a class="code" href="classHead.html">Head</a>* origin,
00330                               <a class="code" href="classHead.html">Head</a>* dest,
00331                               <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00332                               <span class="keywordtype">bool</span> forward );
00333 
00343          <a class="code" href="Types_8h.html#a21">uint32</a> initRouteWalking( <a class="code" href="classHead.html">Head</a>* origin,
00344                                   <a class="code" href="classHead.html">Head</a>* dest,
00345                                   <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00346                                   <span class="keywordtype">bool</span> forward );
00347             
00360          <a class="code" href="Types_8h.html#a21">uint32</a> initRouteOnHigherLevel( <a class="code" href="classHead.html">Head</a>* startRoutingNodeList,
00361                                         <a class="code" href="classHead.html">Head</a>* endRoutingNodeList,
00362                                         <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam );
00364 
00376       <span class="keywordtype">bool</span> checkVehicleRestrictions( <a class="code" href="classRoutingNode.html">RoutingNode</a>* curNode,
00377                                      <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00378                                      <span class="keywordtype">bool</span> forward );
00379 
00389       <span class="keywordtype">void</span> expandNonValidNodes( <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00390                                 <span class="keywordtype">bool</span> forward );
00391 
00401       <span class="keywordtype">void</span> expandThroughfareNodes( <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00402                                    <span class="keywordtype">bool</span> forward );
00403 
00428          <span class="keyword">inline</span> <span class="keywordtype">void</span> calcCostDijkstra(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00429                                       <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00430                                       <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00431                                       <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00432                                       <a class="code" href="classHead.html">Head</a>* destination,
00433                                       <span class="keywordtype">bool</span> forward,
00434                                       <span class="keywordtype">bool</span> routeToAll,
00435                                       <span class="keywordtype">bool</span> estimate,
00436                                       <span class="keywordtype">bool</span> walking,
00437                                       <span class="keywordtype">bool</span> throughfareOK = <span class="keyword">false</span>);
00444          <span class="keyword">inline</span> <span class="keywordtype">void</span> calcCostDijkstra(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00445                                       <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00446                                       <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00447                                       <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00448                                       <a class="code" href="classHead.html">Head</a>* destination,
00449                                       <span class="keywordtype">bool</span> forward,
00450                                       <span class="keywordtype">bool</span> routeToAll);
00466          <span class="keyword">inline</span> <span class="keywordtype">void</span> calcCostDijkstra(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00467                                       <a class="code" href="classHead.html">Head</a>* destination,
00468                                       <span class="keywordtype">bool</span> forward,
00469                                       <span class="keywordtype">bool</span> routeToAll = <span class="keyword">false</span>);
00470 
00483          <span class="keyword">inline</span> <span class="keywordtype">void</span> calcCostExternalDijkstra(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00484                                               <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00485                                               <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00486                                               <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00487                                               <span class="keywordtype">bool</span> routeToHigherLevel,
00488                                               <span class="keywordtype">bool</span> forward,
00489                                               <span class="keywordtype">bool</span> estimate,
00490                                               <a class="code" href="classHead.html">Head</a>* allDestinations);
00491          
00496          <span class="keyword">inline</span> <span class="keywordtype">void</span> calcCostExternalDijkstra(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00497                                               <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00498                                               <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00499                                               <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00500                                               <span class="keywordtype">bool</span> routeToHigherLevel,
00501                                               <span class="keywordtype">bool</span> forward,
00502                                               <a class="code" href="classHead.html">Head</a>* allDestinations);
00503          
00508          <span class="keyword">inline</span> <span class="keywordtype">void</span> calcCostExternalDijkstra(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00509                                               <span class="keywordtype">bool</span> routeToHigherLevel,
00510                                               <span class="keywordtype">bool</span> forward,
00511                                               <a class="code" href="classHead.html">Head</a>* allDestinations);
00513 
00514          
00536          <a class="code" href="Types_8h.html#a21">uint32</a> readResult(<a class="code" href="classHead.html">Head</a>* origin,
00537                            <a class="code" href="classHead.html">Head</a>* destination,
00538                            <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00539                            <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00540                            <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00541                            <span class="keywordtype">bool</span> forward,
00542                            <span class="keywordtype">bool</span> calcCostSums,
00543                            <span class="keywordtype">bool</span> readToExternal = <span class="keyword">true</span>);
00544 
00556          <a class="code" href="Types_8h.html#a21">uint32</a> readResultToAll(<a class="code" href="classHead.html">Head</a>* origin,
00557                                 <a class="code" href="classHead.html">Head</a>* destination,
00558                                 <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00559                                 <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00560                                 <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00561                                 <span class="keywordtype">bool</span> forward,
00562                                 <span class="keywordtype">bool</span> calcCostSums);
00563          
00576          <a class="code" href="Types_8h.html#a21">uint32</a> readResultWalk(<a class="code" href="classHead.html">Head</a>* origin,
00577                                <a class="code" href="classHead.html">Head</a>* destination,
00578                                <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00579                                <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00580                                <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00581                                <span class="keywordtype">bool</span> forward,
00582                                <span class="keywordtype">bool</span> calcCostSums);
00583 
00588          <a class="code" href="Types_8h.html#a21">uint32</a> readResultBus( <a class="code" href="classHead.html">Head</a>* origin,
00589                                <a class="code" href="classHead.html">Head</a>* destination,
00590                                <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00591                                <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00592                                <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00593                                <span class="keywordtype">bool</span> forward );
00594 
00595       
00611          <a class="code" href="Types_8h.html#a21">uint32</a>
00612             readResultToExternalConnection( <a class="code" href="classSubRouteList.html">SubRouteList</a>* incoming,
00613                                             <a class="code" href="classSubRouteList.html">SubRouteList</a>* result,
00614                                             <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00615                                             <a class="code" href="classHead.html">Head</a>* dest,
00616                                             <a class="code" href="classHead.html">Head</a>* origin,
00617                                             <span class="keywordtype">bool</span> forward,
00618                                             <span class="keywordtype">bool</span> calcCostSums);
00619 
00631          <a class="code" href="Types_8h.html#a21">uint32</a> readResultOnHigherLevel( <a class="code" href="classHead.html">Head</a>* origin,
00632                                          <a class="code" href="classHead.html">Head</a>* destination,
00633                                          <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00634                                          <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00635                                          <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00636                                          <span class="keywordtype">bool</span> calcCostSums);
00637 
00647          <a class="code" href="Types_8h.html#a21">uint32</a> readResultToBestOnHigherLevel( <a class="code" href="classHead.html">Head</a>* origin,
00648                                                <a class="code" href="classHead.html">Head</a>* destination,
00649                                                <a class="code" href="classSubRouteList.html">SubRouteList</a>* incomingList,
00650                                                <a class="code" href="classSubRouteList.html">SubRouteList</a>* resultList,
00651                                             <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00652                                                <span class="keywordtype">bool</span> calcCostSums);
00653 
00654          
00655       
00670          <a class="code" href="classCompleteRMSubRoute.html">CompleteRMSubRoute</a>*
00671             readResultFromDestination( <a class="code" href="classSubRouteList.html">SubRouteList</a>* incoming,
00672                                        <a class="code" href="classSubRouteList.html">SubRouteList</a>* result,
00673                                        <a class="code" href="classRoutingNode.html">RoutingNode</a>* dest,
00674                                        <a class="code" href="classRoutingNode.html">RoutingNode</a>* external,
00675                                        <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00676                                        <span class="keywordtype">bool</span> forward,
00677                                        <a class="code" href="Types_8h.html#a19">uint16</a> offset,
00678                                        <span class="keywordtype">bool</span> calcCostSums);      
00680 
00694       <span class="keywordtype">void</span> expandNonValidNodesResult( <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* resetHeapNonValid,
00695                                       <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* resetHeapThroughfare,
00696                                       <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00697                                       <span class="keywordtype">bool</span> forward  );
00698 
00701       <span class="keywordtype">void</span> expandThrougfareNodesResult( <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* resetHeapThroughfare,
00702                                         <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00703                                         <span class="keywordtype">bool</span> forward  );
00704 
00708       <span class="keywordtype">void</span> expandNodesResult( <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00709                               <span class="keywordtype">bool</span> forward );
00710       
00719       <a class="code" href="Types_8h.html#a21">uint32</a> getMinCost( <a class="code" href="classRoutingNode.html">RoutingNode</a>* curNode,
00720                          <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00721                          <span class="keywordtype">bool</span> forward = <span class="keyword">true</span>);
00722                          
00723 
00732       <a class="code" href="Types_8h.html#a21">uint32</a> getMinCost( <a class="code" href="classRoutingNode.html">RoutingNode</a>* curNode,
00733                          <a class="code" href="Types_8h.html#a21">uint32</a> vehRes,
00734                          <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00735                          <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00736                          <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC);
00737 
00742       <a class="code" href="Types_8h.html#a21">uint32</a> getMinCostWalk( <a class="code" href="classRoutingNode.html">RoutingNode</a>* curNode,
00743                              <a class="code" href="Types_8h.html#a21">uint32</a> vehRes,
00744                              <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00745                              <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00746                              <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC );
00747 
00752       <a class="code" href="Types_8h.html#a21">uint32</a> getMinCostWalk( <a class="code" href="classRoutingNode.html">RoutingNode</a>* curNode,
00753                              <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam);
00754 
00757       <span class="keywordtype">void</span> insertStateElement( <a class="code" href="classCompleteRMSubRoute.html">CompleteRMSubRoute</a>* completeSubRoute,
00758                                <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00759                                <span class="keywordtype">bool</span> forward );
00760 
00772       <a class="code" href="Types_8h.html#a21">uint32</a> estimateDistToDest(<a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00773                                 <a class="code" href="classHead.html">Head</a>* dest,
00774                                 <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverPref);
00775 
00776       <a class="code" href="Types_8h.html#a21">uint32</a> estimateDistToDest(<a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00777                                 <a class="code" href="classHead.html">Head</a>* dest,
00778                                 <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00779                                 <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00780                                 <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00781                                 <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costD);
00782 
00783 
00790       <span class="keyword">static</span> <a class="code" href="classOrigDestNode.html">OrigDestNode</a>* getOrigDestNode( <a class="code" href="classHead.html">Head</a>* origDests,
00791                                             <a class="code" href="Types_8h.html#a21">uint32</a> nodeID );
00792       
00800       <span class="keyword">static</span> <a class="code" href="classOrigDestNode.html">OrigDestNode</a>* getOrigDestNode( <a class="code" href="classHead.html">Head</a>* origDests,
00801                                             <span class="keyword">const</span> <a class="code" href="classRoutingNode.html">RoutingNode</a>* realNode );
00802 
00803       
00816       <a class="code" href="Types_8h.html#a21">uint32</a> calcOffsetCost(<a class="code" href="classHead.html">Head</a>* destination,
00817                             <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00818                             <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00819                             <span class="keywordtype">bool</span> forward = <span class="keyword">true</span>);
00820 
00825       <a class="code" href="Types_8h.html#a21">uint32</a> calcOffsetCostWalk(  <a class="code" href="classHead.html">Head</a>* destinations,
00826                                   <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00827                                   <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00828                                   <span class="keywordtype">bool</span> forward );
00829       
00837       <span class="keywordtype">void</span> tracePath(<a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00838                      <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam);
00839 
00844       <span class="keywordtype">void</span> printNbrExternalNodesVisited();
00845 
00853       <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a> checkOrigDests(<a class="code" href="classHead.html">Head</a>* origins,
00854                                    <a class="code" href="classHead.html">Head</a>* dests);
00855       
00868       <span class="keyword">static</span>
00869       <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a> calcConnectionCost(<a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00870                                        <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00871                                        <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00872                                        <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costD,
00873                                        <a class="code" href="Types_8h.html#a21">uint32</a> vehicleRest,
00874                                        <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>* data);
00875 
00881       <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a> getWalkingCostBFromA( <a class="code" href="Types_8h.html#a21">uint32</a> costA );
00882       
00892       <span class="keyword">static</span> <span class="keyword">inline</span>
00893          <a class="code" href="Types_8h.html#a21">uint32</a> calcConnectionCostWalk(<a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costA,
00894                                        <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costB,
00895                                        <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costC,
00896                                        <a class="code" href="CalcRoute_8h.html#a2">dpCost_t</a> costD,
00897                                        <a class="code" href="Types_8h.html#a21">uint32</a> vehicleRest,
00898                                        <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>* data);
00899 
00908       <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> canDriveOnSegment(<span class="keyword">const</span> <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00909                                            <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* pref,
00910                                            <span class="keywordtype">bool</span> forward,
00911                                            <span class="keywordtype">bool</span> onlyFrom = <span class="keyword">false</span>);
00912 
00921       <span class="keyword">inline</span> <span class="keywordtype">bool</span> couldDriveIntoSegment(<span class="keyword">const</span> <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00922                                         <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* pref,
00923                                         <span class="keywordtype">bool</span> forward);
00924       
00932       <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a>
00933          calcConnectionCostWalk(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00934                                 <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>* data);
00935       
00941       <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a>
00942          calcConnectionCost(<span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* driverParam,
00943                             <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>* data);
00944 
00954       <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a> checkAdditionalCosts(<a class="code" href="classRoutingNode.html">RoutingNode</a>* fromNode,
00955                                          <a class="code" href="classRoutingNode.html">RoutingNode</a>* toNode);
00956 
00957 
00975       <span class="keyword">inline</span> <a class="code" href="classCompleteRMSubRoute.html">CompleteRMSubRoute</a>* fillSubRouteFromDestination(<a class="code" href="classRoutingNode.html">RoutingNode</a>* dest,
00976                                                              <span class="keywordtype">bool</span> forward,
00977                                                              <a class="code" href="Types_8h.html#a21">uint32</a>&amp; extID,
00978                                                              <span class="keywordtype">bool</span> calcCostSums,
00979                                                              <a class="code" href="Types_8h.html#a21">uint32</a>&amp; costASum,
00980                                                              <a class="code" href="Types_8h.html#a21">uint32</a>&amp; costBSum,
00981                                                              <a class="code" href="Types_8h.html#a21">uint32</a>&amp; costCSum
00982                                                              );
00987       <span class="keywordtype">void</span> sumCostsForConnection(<a class="code" href="classRoutingNode.html">RoutingNode</a>* fromNode,
00988                                  <a class="code" href="classRoutingNode.html">RoutingNode</a>* toNode,
00989                                  <a class="code" href="Types_8h.html#a21">uint32</a>&amp; costASum,
00990                                  <a class="code" href="Types_8h.html#a21">uint32</a>&amp; costBSum,
00991                                  <a class="code" href="Types_8h.html#a21">uint32</a>&amp; costCSum);
00992             
01003       <span class="keyword">inline</span> <span class="keywordtype">bool</span> shouldIncludeNode(<span class="keyword">const</span> <a class="code" href="classRoutingNode.html">RoutingNode</a>* nextNode,
01004                                     <span class="keywordtype">bool</span> curNodeOnLowerLevel,
01005                                     <span class="keywordtype">bool</span> routeToHigher);
01006 
01013       <span class="keyword">inline</span> <a class="code" href="classHead.html">Head</a>* removeUnreachable(<a class="code" href="classHead.html">Head</a>* origDest,
01014                                      <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* prefs,
01015                                      <span class="keywordtype">bool</span> forward);
01016 
01017       <span class="keyword">inline</span> <span class="keywordtype">int</span> routeOnOneSegment(<a class="code" href="classHead.html">Head</a>* origs,
01018                                    <a class="code" href="classHead.html">Head</a>* dests,
01019                                    <span class="keyword">const</span> <a class="code" href="classRMDriverPref.html">RMDriverPref</a>* pref,
01020                                    <span class="keywordtype">bool</span> forward,
01021                                    <a class="code" href="classSubRouteList.html">SubRouteList</a>* incoming,
01022                                    <a class="code" href="classSubRouteList.html">SubRouteList</a>* result,
01023                                    <span class="keywordtype">bool</span> routeToAll,
01024                                    <span class="keywordtype">bool</span> calcCostSums);
01025       
01032       <span class="keyword">inline</span> <span class="keywordtype">void</span> updateLowerLevelBBox(<a class="code" href="classHead.html">Head</a>* origins);
01033       
01037       <span class="keyword">static</span> <span class="keywordtype">bool</span> printVersion();
01038 
<a name="l01042"></a><a class="code" href="classCalcRoute.html#v0">01042</a>       <span class="keyword">static</span> <span class="keywordtype">bool</span> versionPrinted;
01043 
01054       <span class="keywordtype">bool</span> isOnLevel(uint32 level,
01055                      <span class="keyword">const</span> <a class="code" href="classRoutingNode.html">RoutingNode</a>&amp; nodeToCheck);
01056 
01057       
01058 
01059 <span class="comment">// ========================================================================</span>
01060 <span class="comment">//                                                       Member variables =</span>
01061       
<a name="l01065"></a><a class="code" href="classCalcRoute.html#r0">01065</a>    <a class="code" href="classRoutingMap.html">RoutingMap</a>* m_map;
01066    
<a name="l01071"></a><a class="code" href="classCalcRoute.html#r1">01071</a>    <a class="code" href="Types_8h.html#a26">float32</a> m_cosLat;
01072 
01077 <span class="preprocessor">#ifdef  MAIN_PRIO_QUEUE_IN_RM_IS_BUCKET_HEAP</span>
<a name="l01078"></a><a class="code" href="classCalcRoute.html#r2">01078</a> <span class="preprocessor"></span>   <a class="code" href="classBucketHeap.html">BucketHeap</a>* m_priorityQueue;
01079 <span class="preprocessor">#else</span>
01080 <span class="preprocessor"></span>   <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* m_priorityQueue;
01081 <span class="preprocessor">#endif</span>
01082 <span class="preprocessor"></span>
<a name="l01086"></a><a class="code" href="classCalcRoute.html#r3">01086</a>    <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* m_throughfarePriorityQueue;
01087 
<a name="l01092"></a><a class="code" href="classCalcRoute.html#r4">01092</a>    <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* m_outsideHeap;
01093    
<a name="l01099"></a><a class="code" href="classCalcRoute.html#r5">01099</a>    <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* m_notValidPriorityQueue;
01100 
<a name="l01103"></a><a class="code" href="classCalcRoute.html#r6">01103</a>    <a class="code" href="classRedBlackTree.html">RedBlackTree</a>* m_normalPriorityQueue;
01104 
<a name="l01108"></a><a class="code" href="classCalcRoute.html#r7">01108</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_cutOff;
01109 
<a name="l01114"></a><a class="code" href="classCalcRoute.html#r8">01114</a>    <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>* m_lowerLevelBBox;
01115 
<a name="l01120"></a><a class="code" href="classCalcRoute.html#r9">01120</a>    <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>* m_outerLowerLevelBBox;
01121    
01122 <span class="preprocessor">#ifdef USE_RESET_THREAD_IN_CALCROUTE</span>
01123 <span class="preprocessor"></span>
01125    <span class="keywordtype">void</span> startResetThread();
01126 
01128    <span class="keywordtype">void</span> waitForResetThread();
01129 
01131    <span class="keywordtype">void</span> resetThreadHasFinished();
01132    
<a name="l01137"></a><a class="code" href="classCalcRoute.html#r10">01137</a>    <a class="code" href="classISABMonitor.html">ISABMonitor</a> m_resetMonitor;
01138 
<a name="l01142"></a><a class="code" href="classCalcRoute.html#r11">01142</a>    <span class="keywordtype">bool</span> m_resetThreadRunning;
01143 
01147    <a class="code" href="classvector.html">vector</a>&lt;pair&lt;<span class="keyword">const</span> <a class="code" href="classRoutingConnection.html">RoutingConnection</a>*,
<a name="l01148"></a><a class="code" href="classCalcRoute.html#r12">01148</a>                <a class="code" href="classRoutingNode.html">RoutingNode</a>*&gt; &gt; m_invalidNodeVector;
01149    
<a name="l01151"></a><a class="code" href="classCalcRoute.html#n0">01151</a>    <span class="keyword">friend</span> <span class="keyword">class </span>ResetThread;
01152 <span class="preprocessor">#endif</span>
01153 <span class="preprocessor"></span>   
01154 }; <span class="comment">// CalcRoute</span>
01155 
01156 <span class="comment">// ========================================================================</span>
01157 <span class="comment">//                                                       Inline functions =</span>
01158 
01159 <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a> 
<a name="l01160"></a><a class="code" href="classCalcRoute.html#d14">01160</a> <a class="code" href="classCalcRoute.html#d13">CalcRoute::estimateDistToDest</a>( <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
01161                                <a class="code" href="classHead.html">Head</a>* dest,
01162                                dpCost_t incostA,
01163                                dpCost_t incostB,
01164                                dpCost_t incostC,
01165                                dpCost_t incostD)
01166                                
01167 {
01168    <a class="code" href="Types_8h.html#a21">uint32</a> driverA = incostA;
01169    <a class="code" href="Types_8h.html#a21">uint32</a> driverB = incostB;
01170    <a class="code" href="Types_8h.html#a21">uint32</a> driverC = incostC;
01171    <span class="comment">//int32 tmpCost;</span>
01172    <span class="comment">//int32 cost = MAX_INT32;</span>
01173    <span class="comment">//int32 deltaX, deltaY;</span>
01174    <span class="keywordtype">double</span> cost = MAX_INT64;
01175    <span class="comment">//uint32 z = 0;   </span>
01176 
01177    <a class="code" href="classOrigDestNode.html">OrigDestNode</a>* tempNode = static_cast&lt;OrigDestNode*&gt;(dest-&gt;<a class="code" href="classHead.html#a2">first</a>());
01178    
01179    
01180    <span class="keywordflow">while</span>( tempNode != NULL ){
01181       <a class="code" href="Types_8h.html#a22">int32</a> meanLat = ((node-&gt;<a class="code" href="classRoutingNode.html#a19">getLat</a>() &gt;&gt; 1) + (tempNode-&gt;<a class="code" href="classRoutingNode.html#a19">getLat</a>() &gt;&gt; 1));
01182       <span class="keywordtype">double</span> deltaX = ((double)node-&gt;<a class="code" href="classRoutingNode.html#a21">getLong</a>() - (double)tempNode-&gt;<a class="code" href="classRoutingNode.html#a21">getLong</a>());
01183       
01184       <span class="keywordtype">double</span> cosLat = cos( meanLat * GfxConstants::invRadianFactor );
01185       <span class="keywordtype">double</span> deltaY = (double)node-&gt;<a class="code" href="classRoutingNode.html#a19">getLat</a>()  - (double)tempNode-&gt;<a class="code" href="classRoutingNode.html#a19">getLat</a>();
01186       deltaX *= cosLat;
01187       <span class="comment">// &lt;= sqrt(deltaX²+deltaY²), at most 2% error</span>
01188       <span class="comment">// int32 z = deltaX + deltaY;</span>
01189       <span class="comment">// tmpCost = z - 6*deltaX*deltaY/(5*z);</span>
01190       <span class="comment">// Testing old version again.</span>
01191       <span class="keywordtype">double</span> tmpCost = deltaX*deltaX + deltaY * deltaY;
01192       <span class="comment">// Testing manhattan distance / sqrt(2)</span>
01193       <span class="comment">//double tmpCost = (fabs(deltaX) + fabs(deltaY)) / 1.4;</span>
01194       <span class="comment">// Testing the longest of x and y</span>
01195       <span class="comment">// double tmpCost = MAX(deltaX, deltaY);</span>
01196       <span class="keywordflow">if</span>(tmpCost &lt; cost )
01197          cost = tmpCost;
01198       tempNode = static_cast&lt;OrigDestNode*&gt;(tempNode-&gt;<a class="code" href="classLink.html#a2">suc</a>());
01199    }
01200    <span class="keywordflow">if</span>( cost &gt;= (<a class="code" href="Types_8h.html#a14">MAX_INT64</a> * 0.9) ) {
01201       <span class="keywordflow">return</span> 0;
01202    } <span class="keywordflow">else</span> {
01203       <span class="comment">// Calculate the distance in meters.</span>
01204       <span class="keywordtype">double</span> distance = sqrt(cost) * GfxConstants::MC2SCALE_TO_METER;
01205 
01206       <span class="comment">// Trying with 120 km/h for now.</span>
01207       <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> invSpeed = 1.0 / (Math::KMH_TO_MS * 120.0);
01208 
01209       <span class="keywordtype">double</span> time = distance * invSpeed;
01210       <span class="comment">// CostB is calculated as centimeters when driving</span>
01211       <span class="comment">// in "normal speed".</span>
01212       <span class="keywordtype">double</span> costB = <a class="code" href="classConnection.html#z521_1">Connection::secToTimeCost</a>(time);
01213       
01214       <span class="comment">// Cost A is in centimetres.</span>
01215       <span class="keywordtype">double</span> costA = <a class="code" href="classConnection.html#z521_3">Connection::metersToDistCost</a>(distance);
01216       
01217       <span class="keywordflow">return</span> <a class="code" href="Types_8h.html#a21">uint32</a>(costA * driverA) + <a class="code" href="Types_8h.html#a21">uint32</a>(costB * driverB)
01218          + <a class="code" href="Types_8h.html#a21">uint32</a>(costB * driverC);
01219       
01220    }
01221 }
01222 
01223 
01224 <span class="preprocessor">#endif // CALCROUTE_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:45 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
